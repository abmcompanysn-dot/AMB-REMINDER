

<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>ABM Reminder (version internationale)</title>
    
    <!-- SEO Meta Tags -->
    <meta name="description" content="Système de rappels intelligent international avec IA et CallMeBot pour une gestion de temps efficace.">
    <meta name="keywords" content="rappel, reminder, ABM, gestion de temps, productivité, assistant personnel, CallMeBot, WhatsApp, PWA, organisation, agenda">

    <!-- Open Graph / Facebook -->
    <meta property="og:type" content="website">
    <meta property="og:title" content="ABM Reminder (version internationale)">
    <meta property="og:description" content="Système de rappels intelligent international avec IA et CallMeBot.">
    <meta property="og:image" content="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI1MTIiIGhlaWdodD0iNTEyIj48Y2lyY2xlIGN4PSIyNTYiIGN5PSIyNTYiIHI9IjIxMy4zIiBmaWxsPSIjNjM2NmYxIi8+PHRleHQgeD0iMjU2IiB5PSIyNjYiIGZpbGw9IiNmZmZmZmYiIGZvbnQtc2l6ZT0iODAiIHRleHQtYW5jaG9yPSJtaWRkbGUiPuKaoTwvdGV4dD48L3N2Zz4=">

    <!-- Twitter -->
    <meta property="twitter:card" content="summary_large_image">
    <meta property="twitter:title" content="ABM Reminder (version internationale)">
    <meta property="twitter:description" content="Système de rappels intelligent international avec IA et CallMeBot.">
    <meta property="twitter:image" content="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI1MTIiIGhlaWdodD0iNTEyIj48Y2lyY2xlIGN4PSIyNTYiIGN5PSIyNTYiIHI9IjIxMy4zIiBmaWxsPSIjNjM2NmYxIi8+PHRleHQgeD0iMjU2IiB5PSIyNjYiIGZpbGw9IiNmZmZmZmYiIGZvbnQtc2l6ZT0iODAiIHRleHQtYW5jaG9yPSJtaWRkbGUiPuKaoTwvdGV4dD48L3N2Zz4=">

    <!-- PWA Configuration -->
    <link rel="manifest" href="data:application/json;base64,ewogICJuYW1lIjogIkFCTSBSZW1pbmRlciAodmVyc2lvbiBpbnRlcm5hdGlvbmFsZSkiLAogICJzaG9ydF9uYW1lIjogIkFCTSBSZW1pbmRlciIsCiAgImRlc2NyaXB0aW9uIjogIlN5c3TDqG1lIGRlIHJhcHBlbHMgaW50ZWxsaWdlbnQgaW50ZXJuYXRpb25hbCBhdmVjIElBIGV0IENhbGxNZUJvdCIsCiAgInN0YXJ0X3VybCI6ICIvIiwKICAiZGlzcGxheSI6ICJzdGFuZGFsb25lIiwKICAiYmFja2dyb3VuZF9jb2xvciI6ICIjNjY3ZWVhIiwKICAidGhlbWVfY29sb3IiOiAiIzYzNjZmMSIsCiAgIm9yaWVudGF0aW9uIjogInBvcnRyYWl0IiwKICAiaWNvbnMiOiBbCiAgICB7CiAgICAgICJzcmMiOiAiZGF0YTppbWFnZS9zdmcreG1sO2Jhc2U2NCxQSE4yWnlCNGJXeHVjejBpYUhSMGNEb3ZMM2QzZHk1M015NXZjbWN2TWpBd01DOXpkbWNpSUhkcFpIUm9QU0l4TWpBaUlHaGxhV2RvZEQwaU1USXdJajQ4WTJseVkyeGxJR040UFNJMU1DSWdZM2s5SWpVd0lpQnlQU0kwTUNJZ1ptbHNiRDBpSXpZek5qWm1NU0l2UGp4MFpYaDBJSGc5SWpVd0lpQjVQU0kyTUNJZ1ptbHNiRDBpSXpkbVptWm1abVlpSUdadmJuUXRjMmw2WlQwaU1qQWlJSFJsZUhRdFlXNWphRzl5UFNKdGFXUmtiR1VpUGlCQlFrMDhMM1JsZUhRK1BDOXpkbWMrIiwKICAgICAgInNpemVzIjogIjEyMHgxMjAiLAogICAgICAidHlwZSI6ICJpbWFnZS9zdmcreG1sIgogICAgfSwKICAgIHsKICAgICAgInNyYyI6ICJkYXRhOmltYWdlL3N2Zyt4bWw7YmFzZTY0LFBITjJaeUI0Yld4dWN6MGlhSFIwY0RvdkwzZDNkeTUzTXk1dmNtY3ZNakF3TUM5emRtY2lJSGRwWkhSb1BTSXhPVElpSUdobGFXZG9kRDBpTVRreUlqNDhZMmx5WTJ4bElHTjRQU0k1TmlJZ1kza2lQU0k1TmlJZ2NqMGlOekFpSUdacGJHdzlJaU0yTXpZMlpqRWlMejQ4ZEdWNGRDQjRQU0k1TmlJZ2VUMGlNVEF3SWlCbWFXeHNQU0lqTjJabVptWm1ZaUlnWm05dWRDMXphWHBsUFNJek1DSWdkR1Y0ZEMxaGJtTm9iM0k5SW0xcFpHUnNaU0lQaUZCQ1RUd3ZkR1Y0ZEQ0OEwzTjJaejQrIiwKICAgICAgInNpemVzIjogIjE5MngxOTIiLAogICAgICAidHlwZSI6ICJpbWFnZS9zdmcreG1sIgogICAgfSwKICAgIHsKICAgICAgInNyYyI6ICJkYXRhOmltYWdlL3N2Zyt4bWw7YmFzZTY0LFBITjJaeUI0Yld4dWN6MGlhSFIwY0RvdkwzZDNkeTUzTXk1dmNtY3ZNakF3TUM5emRtY2lJSGRwWkhSb1BTSTFNVElpSUdobGFXZG9kRDBpTlRFeUlqNDhZMmx5WTJ4bElHTjRQU0kxTlRZaUlHTjVQU0kxTlRZaUlISTlJakl3TUNJZ1ptbHNiRDBpSXpZek5qWm1NU0l2UGp4eVpXTjBJSGc5SWpFd01DSWdlVDBpTVRBd0lpQjNhV1IwYUQwaU16RXlJaUJvWldsbmFIUTlJak14TWlJZ1ptbHNiRDBpSXpZM04yVmxZU0l2UGp4MFpYaDBJSGc5SWpJMU5pSWdlVDBpTWpVMklpQm1hV3hzUFNJak4yWm1abVptWWlJZ1ptOXVkQzF6YVhwbFBTSTBNQ0lnZEdWNGRDMWhibU5vYjNJOUltMXBaR1JzWlNJUGlGQkNUVHd2ZEdWNGRENDhMM04yWno0KyIsCiAgICAgICJzaXplcyI6ICI1MTJ4NTEyIiwKICAgICAgInR5cGUiOiAiaW1hZ2Uvc3ZnK3htbCIKICAgIH0KICA0Cn0=">
    <meta name="theme-color" content="#6366f1">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="default">
    <meta name="apple-mobile-web-app-title" content="RemindPro Max">
    <link rel="apple-touch-icon" href="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIxOTIiIGhlaWdodD0iMTkyIj48Y2lyY2xlIGN4PSI5NiIgY3k9Ijk2IiByPSI4MCIgZmlsbD0iIzYzNjZmMSIvPjx0ZXh0IHg9Ijk2IiB5PSIxMDAiIGZpbGw9IiM3ZmZmZmYiIGZvbnQtc2l6ZT0iMzAiIHRleHQtYW5jaG9yPSJtaWRkbGUiPuKaoeKaoeKaoTwvdGV4dD48L3N2Zz4=">
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        primary: '#6366f1',
                        secondary: '#8b5cf6',
                        accent: '#06b6d4',
                        dark: '#0f172a',
                        light: '#f8fafc'
                    }
                }
            }
        }
    </script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800;900&display=swap');
        
        * {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
            -webkit-tap-highlight-color: transparent;
        }
        
        html {
            scroll-behavior: smooth;
        }

        body {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            overflow-x: hidden;
            -webkit-overflow-scrolling: touch;
        }
        
        .mobile-card {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(20px);
            border-radius: 20px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.2);
        }
        
        .reminder-card {
            background: linear-gradient(135deg, rgba(255,255,255,0.9), rgba(255,255,255,0.8));
            backdrop-filter: blur(10px);
            border-radius: 16px;
            border: 1px solid rgba(255,255,255,0.3);
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }
        
        .reminder-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 4px;
            background: linear-gradient(90deg, #6366f1, #8b5cf6, #06b6d4);
            opacity: 0;
            transition: opacity 0.3s ease;
        }
        
        .reminder-card:active::before {
            opacity: 1;
        }
        
        .reminder-card:active {
            transform: scale(0.98);
            box-shadow: 0 4px 20px rgba(0,0,0,0.15);
        }
        
        .priority-urgent { border-left: 4px solid #ef4444; }
        .priority-high { border-left: 4px solid #f97316; }
        .priority-normal { border-left: 4px solid #3b82f6; }
        .priority-low { border-left: 4px solid #10b981; }
        
        .mobile-input {
            background: rgba(255, 255, 255, 0.9);
            border: 2px solid transparent;
            border-radius: 12px;
            transition: all 0.3s ease;
            font-size: 16px; /* Prevent zoom on iOS */
        }
        
        .mobile-input:focus {
            background: rgba(255, 255, 255, 1);
            border-color: #6366f1;
            box-shadow: 0 0 0 4px rgba(99, 102, 241, 0.1);
        }
        
        .mobile-btn {
            background: linear-gradient(135deg, #6366f1, #8b5cf6);
            border: none;
            border-radius: 12px;
            color: white;
            font-weight: 600;
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
            min-height: 48px; /* Touch-friendly */
        }
        
        .mobile-btn:active {
            transform: scale(0.95);
        }
        
        .floating-add {
            position: fixed;
            bottom: 95px;
            right: 20px;
            width: 60px;
            height: 60px;
            background: linear-gradient(135deg, #6366f1, #8b5cf6);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 24px;
            box-shadow: 0 8px 25px rgba(99, 102, 241, 0.4);
            transition: all 0.3s ease;
            z-index: 1000;
        }
        
        .floating-add:active {
            transform: scale(0.9);
        }
        
        .bottom-nav {
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(20px);
            border-top: 1px solid rgba(255, 255, 255, 0.2);
            padding: 8px 0 calc(8px + env(safe-area-inset-bottom));
            z-index: 100;
        }
        
        .nav-item {
            flex: 1;
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 8px;
            color: #6b7280;
            transition: all 0.3s ease;
            min-height: 48px;
        }
        
        .nav-item.active {
            color: #6366f1;
            background: rgba(99, 102, 241, 0.1);
            border-radius: 12px;
        }
        
        .nav-item:active {
            transform: scale(0.95);
        }
        
        .modal {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.5);
            display: flex;
            align-items: flex-end;
            z-index: 1000;
            opacity: 0;
            visibility: hidden;
            transition: all 0.3s ease;
        }
        
        .modal.active {
            opacity: 1;
            visibility: visible;
        }
        
        .modal-content {
            background: white;
            border-radius: 20px 20px 0 0;
            padding: 20px;
            width: 100%;
            max-height: 90vh;
            overflow-y: auto;
            transform: translateY(100%);
            transition: transform 0.3s ease;
        }
        
        .modal.active .modal-content {
            transform: translateY(0);
        }
        
        .notification {
            position: fixed;
            top: 20px;
            left: 20px;
            right: 20px;
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(20px);
            border-radius: 12px;
            padding: 16px;
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.1);
            z-index: 2000;
            transform: translateY(-100px);
            opacity: 0;
            transition: all 0.3s ease;
        }
        
        .notification.show {
            transform: translateY(0);
            opacity: 1;
        }
        
        .swipe-actions {
            position: absolute;
            top: 0;
            right: 0;
            bottom: 0;
            display: flex;
            align-items: center;
            background: linear-gradient(90deg, #10b981, #ef4444);
            border-radius: 0 16px 16px 0;
            transform: translateX(100%);
            transition: transform 0.3s ease;
        }
        
        .reminder-card.swiped .swipe-actions {
            transform: translateX(0);
        }
        
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 12px;
            margin-bottom: 20px;
        }
        
        .stat-card {
            background: rgba(255, 255, 255, 0.2);
            backdrop-filter: blur(20px);
            border-radius: 16px;
            padding: 16px;
            text-align: center;
            border: 1px solid rgba(255, 255, 255, 0.3);
        }
        
        .category-icon {
            width: 32px;
            height: 32px;
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 16px;
            margin-right: 8px;
        }
        
        .category-tache .category-icon { background: linear-gradient(135deg, #3b82f6, #1d4ed8); }
        .category-rendez-vous .category-icon { background: linear-gradient(135deg, #10b981, #047857); }
        .category-priere .category-icon { background: linear-gradient(135deg, #8b5cf6, #7c3aed); }
        .category-messe .category-icon { background: linear-gradient(135deg, #d97706, #92400e); }
        .category-appel .category-icon { background: linear-gradient(135deg, #f59e0b, #d97706); }
        .category-sante .category-icon { background: linear-gradient(135deg, #ef4444, #dc2626); }
        .category-travail .category-icon { background: linear-gradient(135deg, #6366f1, #4f46e5); }
        .category-famille .category-icon { background: linear-gradient(135deg, #ec4899, #db2777); }
        .category-sport .category-icon { background: linear-gradient(135deg, #06b6d4, #0891b2); }
        
        /* Styles pour catégories personnalisées */
        .color-option {
            transition: all 0.3s ease;
            border: 3px solid transparent;
        }
        
        .color-option.selected {
            border-color: #374151;
            transform: scale(1.1);
            box-shadow: 0 4px 12px rgba(0,0,0,0.3);
        }
        
        .category-item {
            background: rgba(255, 255, 255, 0.9);
            border-radius: 12px;
            padding: 12px;
            border: 1px solid rgba(255, 255, 255, 0.3);
            transition: all 0.3s ease;
        }
        
        .category-item:hover {
            background: rgba(255, 255, 255, 1);
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
        }
        
        .category-delete-btn {
            background: linear-gradient(135deg, #ef4444, #dc2626);
            color: white;
            border: none;
            border-radius: 8px;
            padding: 6px 12px;
            font-size: 12px;
            font-weight: 600;
            transition: all 0.3s ease;
        }
        
        .category-delete-btn:hover {
            background: linear-gradient(135deg, #dc2626, #b91c1c);
            transform: scale(1.05);
        }
        
        .category-delete-btn:active {
            transform: scale(0.95);
        }
        
        /* iOS Safe Area */
        .safe-top {
            padding-top: env(safe-area-inset-top);
        }
        
        .safe-bottom {
            padding-bottom: calc(80px + env(safe-area-inset-bottom));
        }
        
        /* Footer styles */
        footer {
            margin-bottom: 80px; /* Espace pour la navigation bottom */
        }
        
        @media (max-width: 768px) {
            footer {
                margin-bottom: 90px; /* Plus d'espace sur mobile */
            }
        }
        
        /* Haptic feedback simulation */
        .haptic:active {
            animation: haptic 0.1s ease;
        }
        
        @keyframes haptic {
            0% { transform: scale(1); }
            50% { transform: scale(0.98); }
            100% { transform: scale(1); }
        }
        
        /* Quick actions */
        .quick-action {
            background: rgba(255, 255, 255, 0.2);
            backdrop-filter: blur(20px);
            border-radius: 12px;
            padding: 12px;
            margin: 4px;
            border: 1px solid rgba(255, 255, 255, 0.3);
            transition: all 0.3s ease;
        }
        
        .quick-action:active {
            transform: scale(0.95);
            background: rgba(255, 255, 255, 0.3);
        }
    </style>
</head>
<body class="safe-top">
    <!-- Header - Version Professionnelle -->
    <div class="px-4 py-6 text-center">
        <div class="inline-flex items-center justify-center w-16 h-16 rounded-full mobile-card mb-4 bg-gradient-to-br from-white/20 to-white/10 backdrop-blur-sm border border-white/30">
            <svg width="32" height="32" viewBox="0 0 24 24" fill="currentColor" class="text-white">
                <path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm-2 15l-5-5 1.41-1.41L10 14.17l7.59-7.59L19 8l-9 9z"/>
                <circle cx="12" cy="12" r="3" fill="currentColor" opacity="0.7"/>
                <path d="M12 1l3.09 6.26L22 9l-5 4.87L18.18 21 12 17.77 5.82 21 7 13.87 2 9l6.91-1.74L12 1z" opacity="0.3"/>
            </svg>
        </div>
        <h1 class="text-3xl font-black text-white mb-2 flex items-center justify-center space-x-2">
            <span>ABM Reminder</span>
            <svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor" class="text-yellow-300">
                <path d="M12 2l3.09 6.26L22 9l-5 4.87L18.18 21 12 17.77 5.82 21 7 13.87 2 9l6.91-1.74L12 2z"/>
            </svg>
        </h1>
        <p class="text-white/80 text-sm font-medium">Version Internationale Professionnelle</p>
        
        <!-- Horloge en temps réel -->
        <div class="mt-2 p-2 bg-white/20 rounded-lg backdrop-blur-sm">
            <div class="current-time text-white font-mono text-lg font-bold"></div>
            <div class="text-white/70 text-xs" id="refreshStatus">🔄 Actualisation ultra-rapide active (10ms)</div>
        </div>
        
        <!-- Panneau de monitoring arrière-plan -->
        <div class="mt-2 p-2 bg-white/10 rounded-lg backdrop-blur-sm">
            <div class="text-white/90 text-xs font-semibold mb-1">🚀 Système Arrière-Plan</div>
            <div class="grid grid-cols-2 gap-2 text-xs">
                <div class="bg-white/10 rounded px-2 py-1">
                    <div class="text-white/70">Vérifications</div>
                    <div class="text-white font-bold" id="backgroundChecks">0</div>
                </div>
                <div class="bg-white/10 rounded px-2 py-1">
                    <div class="text-white/70">Queue</div>
                    <div class="text-white font-bold" id="backgroundQueue">0</div>
                </div>
                <div class="bg-white/10 rounded px-2 py-1">
                    <div class="text-white/70">Envois OK</div>
                    <div class="text-green-300 font-bold" id="backgroundSuccess">0</div>
                </div>
                <div class="bg-white/10 rounded px-2 py-1">
                    <div class="text-white/70">Échecs</div>
                    <div class="text-red-300 font-bold" id="backgroundFails">0</div>
                </div>
            </div>
            <div class="mt-1 text-xs text-white/60" id="backgroundStatus">🟢 Tous les workers actifs</div>
        </div>
        
        <!-- Install App Button - Version Professionnelle -->
        <div id="installPrompt" class="mt-4">
            <div class="bg-white/20 backdrop-blur-sm rounded-2xl p-4 border border-white/30">
                <div class="text-center mb-3">
                    <div class="text-4xl mb-2">📱</div>
                    <h3 class="text-white font-bold text-lg">Installer ABM Reminder</h3>
                    <p class="text-white/80 text-sm">Accès rapide depuis votre écran d'accueil</p>
                </div>
                <button id="installButton" class="mobile-btn w-full py-4 text-lg font-bold haptic bg-gradient-to-r from-green-500 to-blue-500 shadow-lg">
                    <div class="flex items-center justify-center space-x-2">
                        <svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor" class="text-white">
                            <path d="M19 9h-4V3H9v6H5l7 7 7-7zM5 18v2h14v-2H5z"/>
                        </svg>
                        <span>Installer sur l'Écran d'Accueil</span>
                    </div>
                </button>
                <div class="mt-3 text-center">
                    <div class="flex items-center justify-center space-x-4 text-white/70 text-xs">
                        <div class="flex items-center space-x-1">
                            <svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor">
                                <path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm-2 15l-5-5 1.41-1.41L10 14.17l7.59-7.59L19 8l-9 9z"/>
                            </svg>
                            <span>Accès rapide</span>
                        </div>
                        <div class="flex items-center space-x-1">
                            <svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor">
                                <path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm-2 15l-5-5 1.41-1.41L10 14.17l7.59-7.59L19 8l-9 9z"/>
                            </svg>
                            <span>Hors ligne</span>
                        </div>
                        <div class="flex items-center space-x-1">
                            <svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor">
                                <path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm-2 15l-5-5 1.41-1.41L10 14.17l7.59-7.59L19 8l-9 9z"/>
                            </svg>
                            <span>Notifications</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Quick Stats -->
        <div class="stats-grid mt-6">
            <div class="stat-card">
                <div class="text-2xl font-bold text-white" id="totalReminders">0</div>
                <div class="text-white/80 text-xs">Actifs</div>
            </div>
            <div class="stat-card">
                <div class="text-2xl font-bold text-white" id="todayCount">0</div>
                <div class="text-white/80 text-xs">Aujourd'hui</div>
            </div>
            <div class="stat-card">
                <div class="text-2xl font-bold text-white" id="callMeBotSent">0</div>
                <div class="text-white/80 text-xs">📲 CallMeBot</div>
            </div>
            <div class="stat-card">
                <div class="text-2xl font-bold text-white" id="totalSent">0</div>
                <div class="text-white/80 text-xs">📊 Total Envoyés</div>
            </div>
        </div>
    </div>

    <!-- AI Assistant Panel -->
    <div class="px-4 mb-6">
        <div class="mobile-card p-4">
            <div class="flex items-center justify-between mb-3">
                <h3 class="text-lg font-bold text-gray-800 flex items-center">
                    <svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor" class="text-blue-600 mr-2">
                        <path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm-1 17.93c-3.94-.49-7-3.85-7-7.93 0-.62.08-1.21.21-1.79L9 15v1c0 1.1.9 2 2 2v1.93zm6.9-2.54c-.26-.81-1-1.39-1.9-1.39h-1v-3c0-.55-.45-1-1-1H8v-2h2c.55 0 1-.45 1-1V7h2c1.1 0 2-.9 2-2v-.41c2.93 1.19 5 4.06 5 7.41 0 2.08-.8 3.97-2.1 5.39z"/>
                    </svg>
                    <span>Assistant IA Intelligent</span>
                </h3>
                <button id="aiToggle" class="p-2 rounded-full bg-blue-100 hover:bg-blue-200 transition-colors haptic" onclick="toggleAI()">
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="currentColor" class="text-blue-600">
                        <path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm0 3c1.66 0 3 1.34 3 3s-1.34 3-3 3-3-1.34-3-3 1.34-3 3-3zm0 14.2c-2.5 0-4.71-1.28-6-3.22.03-1.99 4-3.08 6-3.08 1.99 0 5.97 1.09 6 3.08-1.29 1.94-3.5 3.22-6 3.22z"/>
                    </svg>
                </button>
            </div>
            
            <div id="aiPanel" class="space-y-3">
                <!-- AI Suggestions -->
                <div id="aiSuggestions" class="space-y-2">
                    <!-- Dynamic suggestions will appear here -->
                </div>
                
                <!-- Quick Actions -->
                <div class="flex space-x-2">
                    <button class="mobile-btn flex-1 py-3 haptic" onclick="showSmartScheduler()">
                        <div class="flex items-center justify-center space-x-2">
                            <svg width="20" height="20" viewBox="0 0 24 24" fill="currentColor" class="text-white">
                                <path d="M13 3c-4.97 0-9 4.03-9 9H1l3.89 3.89.07.14L9 12H6c0-3.87 3.13-7 7-7s7 3.13 7 7-3.13 7-7 7c-1.93 0-3.68-.79-4.94-2.06l-1.42 1.42C8.27 19.99 10.51 21 13 21c4.97 0 9-4.03 9-9s-4.03-9-9-9zm-1 5v5l4.28 2.54.72-1.21-3.5-2.08V8H12z"/>
                            </svg>
                            <span>Programmation Rapide</span>
                        </div>
                    </button>
                </div>
                
                <!-- Smart Input -->
                <div class="relative">
                    <div class="absolute left-3 top-1/2 transform -translate-y-1/2">
                        <svg width="20" height="20" viewBox="0 0 24 24" fill="currentColor" class="text-gray-400">
                            <path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm-1 17.93c-3.94-.49-7-3.85-7-7.93 0-.62.08-1.21.21-1.79L9 15v1c0 1.1.9 2 2 2v1.93zm6.9-2.54c-.26-.81-1-1.39-1.9-1.39h-1v-3c0-.55-.45-1-1-1H8v-2h2c.55 0 1-.45 1-1V7h2c1.1 0 2-.9 2-2v-.41c2.93 1.19 5 4.06 5 7.41 0 2.08-.8 3.97-2.1 5.39z"/>
                        </svg>
                    </div>
                    <input type="text" id="aiInput" placeholder="Écrivez ce que vous voulez programmer..." 
                           class="mobile-input w-full pl-12 pr-12 py-3" onkeypress="handleAIInput(event)">
                    <button class="absolute right-3 top-1/2 transform -translate-y-1/2 p-1 rounded-full bg-blue-500 hover:bg-blue-600 transition-colors haptic" onclick="processAIInput()">
                        <svg width="20" height="20" viewBox="0 0 24 24" fill="currentColor" class="text-white">
                            <path d="M2.01 21L23 12 2.01 3 2 10l15 2-15 2z"/>
                        </svg>
                    </button>
                </div>
                
                <!-- Smart Patterns -->
                <div class="grid grid-cols-2 gap-2">
                    <button class="quick-action text-xs py-2 haptic" onclick="applySmartPattern('morning')">
                        🌅 Routine Matinale
                    </button>
                    <button class="quick-action text-xs py-2 haptic" onclick="applySmartPattern('work')">
                        💼 Journée Travail
                    </button>
                    <button class="quick-action text-xs py-2 haptic" onclick="applySmartPattern('health')">
                        🏥 Suivi Santé
                    </button>
                    <button class="quick-action text-xs py-2 haptic" onclick="applySmartPattern('spiritual')">
                        🙏 Vie Spirituelle
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Quick Actions -->
    <div class="px-4 mb-6">
        <div class="flex space-x-2 overflow-x-auto pb-2">
            <button class="quick-action flex items-center space-x-2 whitespace-nowrap haptic" onclick="showAddModal('priere')">
                <span>🙏</span>
                <span class="text-white text-sm font-medium">Prière</span>
            </button>
            <button class="quick-action flex items-center space-x-2 whitespace-nowrap haptic" onclick="showAddModal('messe')">
                <span>⛪</span>
                <span class="text-white text-sm font-medium">Messe</span>
            </button>
            <button class="quick-action flex items-center space-x-2 whitespace-nowrap haptic" onclick="showAddModal('sante')">
                <span>🏥</span>
                <span class="text-white text-sm font-medium">Santé</span>
            </button>
            <button class="quick-action flex items-center space-x-2 whitespace-nowrap haptic" onclick="showAddModal('travail')">
                <span>💼</span>
                <span class="text-white text-sm font-medium">Travail</span>
            </button>
            <button class="quick-action flex items-center space-x-2 whitespace-nowrap haptic" onclick="showAddModal('famille')">
                <span>👨‍👩‍👧‍👦</span>
                <span class="text-white text-sm font-medium">Famille</span>
            </button>
            <button class="quick-action flex items-center space-x-2 whitespace-nowrap haptic" onclick="showAddModal('sport')">
                <span>🏃‍♂️</span>
                <span class="text-white text-sm font-medium">Sport</span>
            </button>
        </div>
    </div>

    <!-- Main Content -->
    <div class="px-4 safe-bottom">
        <!-- Search Bar - Version Professionnelle -->
        <div class="mobile-card p-4 mb-6">
            <div class="relative">
                <div class="absolute left-3 top-1/2 transform -translate-y-1/2">
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="currentColor" class="text-gray-400">
                        <path d="M15.5 14h-.79l-.28-.27C15.41 12.59 16 11.11 16 9.5 16 5.91 13.09 3 9.5 3S3 5.91 3 9.5 5.91 16 9.5 16c1.61 0 3.09-.59 4.23-1.57l.27.28v.79l5 4.99L20.49 19l-4.99-5zm-6 0C7.01 14 5 11.99 5 9.5S7.01 5 9.5 5 14 7.01 14 9.5 11.99 14 9.5 14z"/>
                    </svg>
                </div>
                <input type="text" id="searchInput" placeholder="Rechercher vos rappels..." 
                       class="mobile-input w-full pl-12 pr-12 py-3">
                <button class="absolute right-3 top-1/2 transform -translate-y-1/2 p-1 rounded-full hover:bg-gray-100 transition-colors">
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="currentColor" class="text-gray-400">
                        <path d="M12 2l3.09 6.26L22 9l-5 4.87L18.18 21 12 17.77 5.82 21 7 13.87 2 9l6.91-1.74L12 2z"/>
                    </svg>
                </button>
            </div>
        </div>

        <!-- Reminders List -->
        <div id="remindersList" class="space-y-4">
            <!-- Reminders will be added here -->
        </div>

        <!-- Empty State - Version Professionnelle -->
        <div id="emptyState" class="text-center py-12 hidden">
            <div class="w-24 h-24 mx-auto mb-4 rounded-full mobile-card flex items-center justify-center bg-gradient-to-br from-white/20 to-white/10 backdrop-blur-sm border border-white/30">
                <svg width="48" height="48" viewBox="0 0 24 24" fill="currentColor" class="text-white">
                    <path d="M12 2l3.09 6.26L22 9l-5 4.87L18.18 21 12 17.77 5.82 21 7 13.87 2 9l6.91-1.74L12 2z"/>
                </svg>
            </div>
            <h3 class="text-xl font-bold text-white mb-2">Prêt à commencer ?</h3>
            <p class="text-white/80 mb-6">Créez votre premier rappel intelligent avec l'IA</p>
            <button class="mobile-btn px-6 py-3 haptic" onclick="showAddModal()">
                <div class="flex items-center justify-center space-x-2">
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="currentColor" class="text-white">
                        <path d="M19 13h-6v6h-2v-6H5v-2h6V5h2v6h6v2z"/>
                    </svg>
                    <span>Nouveau Rappel</span>
                </div>
            </button>
        </div>

        <!-- Stats Page -->
        <div id="statsPage" class="hidden">
            <div class="mobile-card p-6 mb-6">
                <h2 class="text-xl font-bold text-gray-800 mb-4 flex items-center">
                    <span class="mr-2">📊</span>
                    Statistiques Détaillées
                </h2>
                
                <!-- Résumé Global -->
                <div class="grid grid-cols-2 gap-4 mb-6">
                    <div class="bg-gradient-to-r from-blue-500 to-blue-600 rounded-lg p-4 text-white">
                        <div class="text-2xl font-bold" id="statsTotal">0</div>
                        <div class="text-sm opacity-90">Total Rappels</div>
                    </div>
                    <div class="bg-gradient-to-r from-green-500 to-green-600 rounded-lg p-4 text-white">
                        <div class="text-2xl font-bold" id="statsSent">0</div>
                        <div class="text-sm opacity-90">Envoyés</div>
                    </div>
                    <div class="bg-gradient-to-r from-orange-500 to-orange-600 rounded-lg p-4 text-white">
                        <div class="text-2xl font-bold" id="statsPending">0</div>
                        <div class="text-sm opacity-90">En Attente</div>
                    </div>
                    <div class="bg-gradient-to-r from-purple-500 to-purple-600 rounded-lg p-4 text-white">
                        <div class="text-2xl font-bold" id="statsCompleted">0</div>
                        <div class="text-sm opacity-90">Terminés</div>
                    </div>
                </div>
                
                <!-- Filtres -->
                <div class="mb-4">
                    <div class="flex space-x-2 overflow-x-auto pb-2">
                        <button onclick="filterStats('all')" class="stats-filter-btn active px-4 py-2 bg-blue-500 text-white rounded-lg text-sm whitespace-nowrap haptic">
                            📊 Tous
                        </button>
                        <button onclick="filterStats('sent')" class="stats-filter-btn px-4 py-2 bg-gray-200 text-gray-700 rounded-lg text-sm whitespace-nowrap haptic">
                            ✅ Envoyés
                        </button>
                        <button onclick="filterStats('pending')" class="stats-filter-btn px-4 py-2 bg-gray-200 text-gray-700 rounded-lg text-sm whitespace-nowrap haptic">
                            ⏳ En Attente
                        </button>
                        <button onclick="filterStats('completed')" class="stats-filter-btn px-4 py-2 bg-gray-200 text-gray-700 rounded-lg text-sm whitespace-nowrap haptic">
                            🎉 Terminés
                        </button>
                        <button onclick="filterStats('callmebot')" class="stats-filter-btn px-4 py-2 bg-gray-200 text-gray-700 rounded-lg text-sm whitespace-nowrap haptic">
                            📲 CallMeBot
                        </button>
                    </div>
                </div>
                
                <!-- Tableau des Rappels -->
                <div class="bg-white rounded-lg border border-gray-200 overflow-hidden">
                    <div class="overflow-x-auto">
                        <table class="w-full text-sm">
                            <thead class="bg-gray-50">
                                <tr>
                                    <th class="px-3 py-3 text-left font-semibold text-gray-700">📋 Rappel</th>
                                    <th class="px-3 py-3 text-left font-semibold text-gray-700">📅 Date/Heure</th>
                                    <th class="px-3 py-3 text-left font-semibold text-gray-700">🎯 Catégorie</th>
                                    <th class="px-3 py-3 text-left font-semibold text-gray-700">⚡ Priorité</th>
                                    <th class="px-3 py-3 text-left font-semibold text-gray-700">📤 Statut Envoi</th>
                                    <th class="px-3 py-3 text-left font-semibold text-gray-700">📲 Mode</th>
                                    <th class="px-3 py-3 text-left font-semibold text-gray-700">✅ État</th>
                                </tr>
                            </thead>
                            <tbody id="statsTableBody">
                                <!-- Les données seront insérées ici -->
                            </tbody>
                        </table>
                    </div>
                </div>
                
                <!-- Statistiques par Catégorie -->
                <div class="mt-6">
                    <h3 class="text-lg font-semibold text-gray-700 mb-3">📊 Répartition par Catégorie</h3>
                    <div id="categoryStats" class="space-y-2">
                        <!-- Les stats par catégorie seront insérées ici -->
                    </div>
                </div>
                
                <!-- Statistiques par Mode d'Envoi -->
                <div class="mt-6">
                    <h3 class="text-lg font-semibold text-gray-700 mb-3">📤 Modes d'Envoi</h3>
                    <div class="grid grid-cols-2 gap-4">
                        <div class="bg-green-50 border border-green-200 rounded-lg p-4">
                            <div class="flex items-center justify-between">
                                <div>
                                    <div class="text-lg font-bold text-green-700" id="callmebotCount">0</div>
                                    <div class="text-sm text-green-600">📲 CallMeBot WhatsApp</div>
                                </div>
                                <div class="text-2xl">📲</div>
                            </div>
                        </div>
                        <div class="bg-blue-50 border border-blue-200 rounded-lg p-4">
                            <div class="flex items-center justify-between">
                                <div>
                                    <div class="text-lg font-bold text-blue-700" id="browserCount">0</div>
                                    <div class="text-sm text-blue-600">🌐 Navigateur</div>
                                </div>
                                <div class="text-2xl">🌐</div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Actions Rapides -->
                <div class="mt-6">
                    <h3 class="text-lg font-semibold text-gray-700 mb-3">🔧 Actions Rapides</h3>
                    <div class="grid grid-cols-2 gap-3">
                        <button onclick="exportStats()" class="mobile-btn py-3 haptic bg-blue-500">
                            📊 Exporter Stats
                        </button>
                        <button onclick="resetStats()" class="mobile-btn py-3 haptic bg-red-500">
                            🗑️ Reset Stats
                        </button>
                        <button onclick="refreshStats()" class="mobile-btn py-3 haptic bg-green-500">
                            🔄 Actualiser
                        </button>
                        <button onclick="printStats()" class="mobile-btn py-3 haptic bg-purple-500">
                            🖨️ Imprimer
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Settings Page -->
        <div id="settingsPage" class="hidden">
            <div class="mobile-card p-6 mb-6">
                <h2 class="text-xl font-bold text-gray-800 mb-4 flex items-center">
                    <span class="mr-2">📲</span>
                    Configuration CallMeBot WhatsApp (GRATUIT)
                </h2>
                
                <!-- CallMeBot Configuration -->
                <div class="space-y-4 mb-6">
                    <h3 class="text-lg font-semibold text-gray-700 flex items-center">
                        <span class="mr-2">📲</span>
                        Configuration CallMeBot WhatsApp (GRATUIT)
                    </h3>
                    
                    <!-- Instructions d'installation CallMeBot -->
                    <div class="bg-green-50 border border-green-200 rounded-lg p-4 mb-4">
                        <h4 class="font-bold text-green-800 mb-3 flex items-center">
                            <span class="mr-2">📋</span>
                            Instructions d'installation CallMeBot :
                        </h4>
                        
                        <div class="space-y-4 text-sm text-green-700">
                            <div class="bg-white rounded-lg p-3 border border-green-100">
                                <h5 class="font-semibold mb-2">✅ 1. Autoriser CallMeBot à t'envoyer des messages</h5>
                                <ul class="space-y-2">
                                    <li class="flex items-start">
                                        <span class="mr-2">📱</span>
                                        <div>
                                            <strong>Ajoute ce numéro à tes contacts WhatsApp :</strong><br>
                                            <span class="bg-green-100 px-2 py-1 rounded font-mono text-lg">+34 694 26 48 06</span><br>
                                            <em>(Nom suggéré : CallMeBot WhatsApp)</em>
                                        </div>
                                    </li>
                                    <li class="flex items-start">
                                        <span class="mr-2">💬</span>
                                        <div>
                                            <strong>Envoie ce message à ce contact :</strong><br>
                                            <span class="bg-green-100 px-2 py-1 rounded font-mono">I allow callmebot to send me messages</span>
                                        </div>
                                    </li>
                                    <li class="flex items-start">
                                        <span class="mr-2">📩</span>
                                        <div>
                                            <strong>Tu recevras automatiquement ton API Key personnelle en retour</strong><br>
                                            <em>Copie cette clé et colle-la dans le champ ci-dessous</em>
                                        </div>
                                    </li>
                                </ul>
                            </div>
                            
                            <div class="bg-blue-50 border border-blue-200 rounded-lg p-3">
                                <h5 class="font-semibold text-blue-800 mb-2">💡 Pourquoi CallMeBot ?</h5>
                                <ul class="list-disc list-inside space-y-1 text-blue-700">
                                    <li>✅ Complètement GRATUIT</li>
                                    <li>✅ Aucune inscription complexe</li>
                                    <li>✅ Envoi automatique de rappels WhatsApp</li>
                                    <li>✅ Fonctionne immédiatement</li>
                                    <li>✅ Pas de limite de messages</li>
                                </ul>
                            </div>
                        </div>
                    </div>
                    
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">📞 Votre numéro WhatsApp</label>
                        <input type="tel" id="callMeBotNumber" placeholder="+33 6 12 34 56 78" 
                               class="mobile-input w-full px-4 py-3">
                        <p class="text-xs text-gray-500 mt-1">Format international avec indicatif pays (ex: +33 pour France)</p>
                    </div>
                    
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">🔑 API Key CallMeBot</label>
                        <input type="text" id="callMeBotApiKey" placeholder="Collez ici votre API Key reçue par WhatsApp" 
                               class="mobile-input w-full px-4 py-3">
                        <p class="text-xs text-gray-500 mt-1">Clé reçue automatiquement après avoir envoyé le message d'autorisation</p>
                    </div>
                    
                    <div class="flex items-center space-x-3">
                        <input type="checkbox" id="enableCallMeBot" class="w-5 h-5 text-primary rounded">
                        <label for="enableCallMeBot" class="text-sm font-medium text-gray-700">
                            Activer les rappels WhatsApp automatiques via CallMeBot
                        </label>
                    </div>
                </div>
                
                <!-- Notification Preferences -->
                <div class="space-y-4 mb-6">
                    <h3 class="text-lg font-semibold text-gray-700 flex items-center">
                        <span class="mr-2">🔔</span>
                        Préférences de Notification
                    </h3>
                    
                    <div class="space-y-3">
                        <label class="flex items-center space-x-3">
                            <input type="checkbox" id="notifyCallMeBot" class="w-5 h-5 text-primary rounded" checked>
                            <span class="text-sm">📲 Envoyer sur WhatsApp via CallMeBot</span>
                        </label>
                        
                        <label class="flex items-center space-x-3">
                            <input type="checkbox" id="notifyBrowser" class="w-5 h-5 text-primary rounded" checked>
                            <span class="text-sm">🌐 Notification navigateur</span>
                        </label>
                    </div>
                </div>
                
                <!-- Message Templates -->
                <div class="space-y-4 mb-6">
                    <h3 class="text-lg font-semibold text-gray-700 flex items-center">
                        <span class="mr-2">📝</span>
                        Message Personnalisé CallMeBot
                    </h3>
                    
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">📲 Message WhatsApp CallMeBot</label>
                        <textarea id="callMeBotTemplate" rows="4" 
                                  class="mobile-input w-full px-4 py-3 resize-none"
                                  placeholder="🔔 Rappel ABM Reminder&#10;📋 {titre}&#10;📅 Prévu pour: {heure}&#10;📍 Lieu: {lieu}&#10;⚡ Envoyé automatiquement">🔔 Rappel ABM Reminder
📋 {titre}
📅 Prévu pour: {heure}
📍 Lieu: {lieu}
⚡ Envoyé automatiquement</textarea>
                        <p class="text-xs text-gray-500 mt-1">Variables disponibles: {titre}, {heure}, {lieu}</p>
                    </div>
                </div>
                
                <!-- Save Button -->
                <button onclick="saveSettings()" class="mobile-btn w-full py-4 text-lg font-bold haptic">
                    💾 Sauvegarder la Configuration
                </button>
                
                <!-- Test Button -->
                <div class="mt-4">
                    <button onclick="testCallMeBot()" class="mobile-btn w-full py-4 haptic bg-green-500 text-lg font-bold">
                        📲 Test CallMeBot WhatsApp
                    </button>
                </div>
            </div>
            
            <!-- Gestion des Catégories -->
            <div class="mobile-card p-6 mb-6">
                <h2 class="text-xl font-bold text-gray-800 mb-4 flex items-center">
                    <span class="mr-2">🗂️</span>
                    Gestion des Catégories
                </h2>
                
                <div class="space-y-4">
                    <!-- Ajouter une nouvelle catégorie -->
                    <div>
                        <h3 class="text-lg font-semibold text-gray-700 mb-3">➕ Ajouter une Catégorie</h3>
                        <div class="space-y-3">
                            <div class="grid grid-cols-2 gap-4">
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-2">📝 Nom de la catégorie</label>
                                    <input type="text" id="newCategoryName" placeholder="Ex: Loisirs, Études..." 
                                           class="mobile-input w-full px-4 py-3">
                                </div>
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-2">🎨 Emoji/Icône</label>
                                    <input type="text" id="newCategoryIcon" placeholder="🎮" maxlength="2"
                                           class="mobile-input w-full px-4 py-3 text-center text-xl">
                                </div>
                            </div>
                            
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">🌈 Couleur</label>
                                <div class="grid grid-cols-6 gap-2">
                                    <button type="button" class="color-option w-10 h-10 rounded-lg bg-red-500" data-color="red" onclick="selectCategoryColor('red')"></button>
                                    <button type="button" class="color-option w-10 h-10 rounded-lg bg-blue-500" data-color="blue" onclick="selectCategoryColor('blue')"></button>
                                    <button type="button" class="color-option w-10 h-10 rounded-lg bg-green-500" data-color="green" onclick="selectCategoryColor('green')"></button>
                                    <button type="button" class="color-option w-10 h-10 rounded-lg bg-yellow-500" data-color="yellow" onclick="selectCategoryColor('yellow')"></button>
                                    <button type="button" class="color-option w-10 h-10 rounded-lg bg-purple-500" data-color="purple" onclick="selectCategoryColor('purple')"></button>
                                    <button type="button" class="color-option w-10 h-10 rounded-lg bg-pink-500" data-color="pink" onclick="selectCategoryColor('pink')"></button>
                                    <button type="button" class="color-option w-10 h-10 rounded-lg bg-indigo-500" data-color="indigo" onclick="selectCategoryColor('indigo')"></button>
                                    <button type="button" class="color-option w-10 h-10 rounded-lg bg-orange-500" data-color="orange" onclick="selectCategoryColor('orange')"></button>
                                    <button type="button" class="color-option w-10 h-10 rounded-lg bg-teal-500" data-color="teal" onclick="selectCategoryColor('teal')"></button>
                                    <button type="button" class="color-option w-10 h-10 rounded-lg bg-cyan-500" data-color="cyan" onclick="selectCategoryColor('cyan')"></button>
                                    <button type="button" class="color-option w-10 h-10 rounded-lg bg-gray-500" data-color="gray" onclick="selectCategoryColor('gray')"></button>
                                    <button type="button" class="color-option w-10 h-10 rounded-lg bg-emerald-500" data-color="emerald" onclick="selectCategoryColor('emerald')"></button>
                                </div>
                                <input type="hidden" id="selectedCategoryColor" value="blue">
                            </div>
                            
                            <button onclick="addCustomCategory()" class="mobile-btn w-full py-3 haptic bg-green-500">
                                ➕ Créer la Catégorie
                            </button>
                        </div>
                    </div>
                    
                    <!-- Liste des catégories existantes -->
                    <div>
                        <h3 class="text-lg font-semibold text-gray-700 mb-3">📋 Catégories Existantes</h3>
                        <div id="categoriesList" class="space-y-2">
                            <!-- Les catégories seront affichées ici -->
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Gestion des Rappels -->
            <div class="mobile-card p-6 mb-6">
                <h2 class="text-xl font-bold text-gray-800 mb-4 flex items-center">
                    <span class="mr-2">🗑️</span>
                    Gestion des Rappels
                </h2>
                
                <div class="space-y-4">
                    <!-- Suppression par catégorie -->
                    <div>
                        <h3 class="text-lg font-semibold text-gray-700 mb-3">🗂️ Supprimer par Catégorie</h3>
                        <div class="grid grid-cols-2 gap-2">
                            <button onclick="mobileSystem.bulkDeleteByCategory('priere')" class="quick-action text-xs py-2 haptic bg-purple-100 text-purple-700">
                                🙏 Prières
                            </button>
                            <button onclick="mobileSystem.bulkDeleteByCategory('messe')" class="quick-action text-xs py-2 haptic bg-orange-100 text-orange-700">
                                ⛪ Messes
                            </button>
                            <button onclick="mobileSystem.bulkDeleteByCategory('sante')" class="quick-action text-xs py-2 haptic bg-red-100 text-red-700">
                                🏥 Santé
                            </button>
                            <button onclick="mobileSystem.bulkDeleteByCategory('travail')" class="quick-action text-xs py-2 haptic bg-blue-100 text-blue-700">
                                💼 Travail
                            </button>
                            <button onclick="mobileSystem.bulkDeleteByCategory('famille')" class="quick-action text-xs py-2 haptic bg-pink-100 text-pink-700">
                                👨‍👩‍👧‍👦 Famille
                            </button>
                            <button onclick="mobileSystem.bulkDeleteByCategory('sport')" class="quick-action text-xs py-2 haptic bg-cyan-100 text-cyan-700">
                                🏃‍♂️ Sport
                            </button>
                        </div>
                    </div>
                    
                    <!-- Suppression par priorité -->
                    <div>
                        <h3 class="text-lg font-semibold text-gray-700 mb-3">⚡ Supprimer par Priorité</h3>
                        <div class="grid grid-cols-2 gap-2">
                            <button onclick="mobileSystem.bulkDeleteByPriority('basse')" class="quick-action text-xs py-2 haptic bg-green-100 text-green-700">
                                🟢 Priorité Basse
                            </button>
                            <button onclick="mobileSystem.bulkDeleteByPriority('normale')" class="quick-action text-xs py-2 haptic bg-yellow-100 text-yellow-700">
                                🟡 Priorité Normale
                            </button>
                            <button onclick="mobileSystem.bulkDeleteByPriority('haute')" class="quick-action text-xs py-2 haptic bg-orange-100 text-orange-700">
                                🔴 Priorité Haute
                            </button>
                            <button onclick="mobileSystem.bulkDeleteByPriority('urgente')" class="quick-action text-xs py-2 haptic bg-red-100 text-red-700">
                                🚨 Priorité Urgente
                            </button>
                        </div>
                    </div>
                    
                    <!-- Nettoyage général -->
                    <div>
                        <h3 class="text-lg font-semibold text-gray-700 mb-3">🧹 Nettoyage Général</h3>
                        <div class="space-y-2">
                            <button onclick="mobileSystem.deleteCompletedReminders()" class="mobile-btn w-full py-3 haptic bg-blue-500">
                                🧹 Supprimer les Rappels Terminés
                            </button>
                            <button onclick="mobileSystem.deleteAllReminders()" class="mobile-btn w-full py-3 haptic bg-red-500">
                                ⚠️ SUPPRIMER TOUS LES RAPPELS
                            </button>
                        </div>
                        
                        <div class="mt-4 p-3 bg-yellow-50 border border-yellow-200 rounded-lg">
                            <p class="text-xs text-yellow-700">
                                ⚠️ <strong>Attention :</strong> Les suppressions sont définitives et ne peuvent pas être annulées. 
                                Assurez-vous de bien vouloir supprimer les rappels avant de confirmer.
                            </p>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Connection Status -->
            <div class="mobile-card p-4">
                <h3 class="text-lg font-semibold text-gray-700 mb-3 flex items-center">
                    <span class="mr-2">📊</span>
                    État des Connexions
                </h3>
                
                <div class="space-y-3">
                    <div class="flex items-center justify-between">
                        <span class="text-sm text-gray-600">CallMeBot WhatsApp</span>
                        <span id="callMeBotStatus" class="px-3 py-1 bg-gray-100 text-gray-600 text-xs rounded-full">
                            Non configuré
                        </span>
                    </div>
                    
                    <div class="flex items-center justify-between">
                        <span class="text-sm text-gray-600">Stockage Local</span>
                        <span class="px-3 py-1 bg-green-100 text-green-600 text-xs rounded-full">
                            ✅ Actif
                        </span>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Footer Professionnel -->
    <footer class="bg-gradient-to-r from-gray-900 to-gray-800 text-white py-8 mt-12">
        <div class="max-w-6xl mx-auto px-4">
            <div class="grid grid-cols-1 md:grid-cols-3 gap-8">
                <!-- Informations Entreprise -->
                <div class="text-center md:text-left">
                    <div class="flex items-center justify-center md:justify-start mb-4">
                        <div class="w-12 h-12 bg-gradient-to-r from-blue-500 to-purple-600 rounded-full flex items-center justify-center mr-3">
                            <span class="text-xl font-bold">🏢</span>
                        </div>
                        <div>
                            <h3 class="text-xl font-bold text-white">Africa Business Manager</h3>
                            <p class="text-blue-300 text-sm font-medium">COMPANY</p>
                        </div>
                    </div>
                    <p class="text-gray-300 text-sm leading-relaxed">
                        Solutions technologiques innovantes pour l'Afrique moderne. 
                        Développement d'applications mobiles et systèmes de gestion intelligents.
                    </p>
                </div>
                
                <!-- Services -->
                <div class="text-center md:text-left">
                    <h4 class="text-lg font-semibold text-white mb-4 flex items-center justify-center md:justify-start">
                        <span class="mr-2">🚀</span>
                        Nos Services
                    </h4>
                    <ul class="space-y-2 text-gray-300 text-sm">
                        <li class="flex items-center justify-center md:justify-start">
                            <span class="mr-2">📱</span>
                            Applications Mobiles
                        </li>
                        <li class="flex items-center justify-center md:justify-start">
                            <span class="mr-2">💼</span>
                            Gestion d'Entreprise
                        </li>
                        <li class="flex items-center justify-center md:justify-start">
                            <span class="mr-2">🤖</span>
                            Intelligence Artificielle
                        </li>
                        <li class="flex items-center justify-center md:justify-start">
                            <span class="mr-2">☁️</span>
                            Solutions Cloud
                        </li>
                    </ul>
                </div>
                
                <!-- Contact -->
                <div class="text-center md:text-left">
                    <h4 class="text-lg font-semibold text-white mb-4 flex items-center justify-center md:justify-start">
                        <span class="mr-2">📞</span>
                        Contact & Réseaux
                    </h4>
                    <div class="space-y-3 text-gray-300 text-sm">
                        <div class="flex items-center justify-center md:justify-start">
                            <span class="mr-2">🌍</span>
                            <span>Sénégal - Solutions Globales</span>
                        </div>
                        <div class="flex items-center justify-center md:justify-start">
                            <span class="mr-2">📧</span>
                            <span>abmcompanysn@gmail.com</span>
                        </div>
                        <div class="flex items-center justify-center md:justify-start">
                            <span class="mr-2">📱</span>
                            <span>+221 76 904 79 99</span>
                        </div>
                        <div class="flex items-center justify-center md:justify-start">
                            <span class="mr-2">💬</span>
                            <span>WhatsApp Business</span>
                        </div>
                        <div class="flex items-center justify-center md:justify-start">
                            <span class="mr-2">📺</span>
                            <span>Chaîne YouTube Officielle</span>
                        </div>
                        <div class="flex items-center justify-center md:justify-start">
                            <span class="mr-2">🎵</span>
                            <span>TikTok @tech_sn_abmcompany</span>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Séparateur -->
            <div class="border-t border-gray-700 mt-8 pt-6">
                <div class="flex flex-col md:flex-row justify-between items-center">
                    <div class="text-center md:text-left mb-4 md:mb-0">
                        <p class="text-gray-400 text-sm">
                            © 2024 <strong class="text-white">Africa Business Manager COMPANY</strong>. 
                            Tous droits réservés.
                        </p>
                        <p class="text-gray-500 text-xs mt-1">
                            ABM Reminder - Système de Rappels International v2.0
                        </p>
                    </div>
                    
                    <!-- Réseaux Sociaux -->
                    <div class="flex flex-wrap gap-3 justify-center md:justify-end">
                        <a href="https://www.facebook.com/share/p/175J3K475H/" target="_blank" class="w-12 h-12 bg-blue-600 hover:bg-blue-700 rounded-full flex items-center justify-center transition-all duration-300 hover:scale-110">
                            <svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor" class="text-white">
                                <path d="M24 12.073c0-6.627-5.373-12-12-12s-12 5.373-12 12c0 5.99 4.388 10.954 10.125 11.854v-8.385H7.078v-3.47h3.047V9.43c0-3.007 1.792-4.669 4.533-4.669 1.312 0 2.686.235 2.686.235v2.953H15.83c-1.491 0-1.956.925-1.956 1.874v2.25h3.328l-.532 3.47h-2.796v8.385C19.612 23.027 24 18.062 24 12.073z"/>
                            </svg>
                        </a>
                        <a href="https://www.tiktok.com/@tech_sn_abmcompany" target="_blank" class="w-12 h-12 bg-black hover:bg-gray-800 rounded-full flex items-center justify-center transition-all duration-300 hover:scale-110">
                            <svg width="20" height="20" viewBox="0 0 24 24" fill="currentColor" class="text-white">
                                <path d="M12.525.02c1.31-.02 2.61-.01 3.91-.02.08 1.53.63 3.09 1.75 4.17 1.12 1.11 2.7 1.62 4.24 1.79v4.03c-1.44-.05-2.89-.35-4.2-.97-.57-.26-1.1-.59-1.62-.93-.01 2.92.01 5.84-.02 8.75-.08 1.4-.54 2.79-1.35 3.94-1.31 1.92-3.58 3.17-5.91 3.21-1.43.08-2.86-.31-4.08-1.03-2.02-1.19-3.44-3.37-3.65-5.71-.02-.5-.03-1-.01-1.49.18-1.9 1.12-3.72 2.58-4.96 1.66-1.44 3.98-2.13 6.15-1.72.02 1.48-.04 2.96-.04 4.44-.99-.32-2.15-.23-3.02.37-.63.41-1.11 1.04-1.36 1.75-.21.51-.15 1.07-.14 1.61.24 1.64 1.82 3.02 3.5 2.87 1.12-.01 2.19-.66 2.77-1.61.19-.33.4-.67.41-1.06.1-1.79.06-3.57.07-5.36.01-4.03-.01-8.05.02-12.07z"/>
                            </svg>
                        </a>
                        <a href="https://www.youtube.com/@CompanyABM" target="_blank" class="w-12 h-12 bg-red-600 hover:bg-red-700 rounded-full flex items-center justify-center transition-all duration-300 hover:scale-110">
                            <svg width="20" height="20" viewBox="0 0 24 24" fill="currentColor" class="text-white">
                                <path d="M23.498 6.186a3.016 3.016 0 0 0-2.122-2.136C19.505 3.545 12 3.545 12 3.545s-7.505 0-9.377.505A3.017 3.017 0 0 0 .502 6.186C0 8.07 0 12 0 12s0 3.93.502 5.814a3.016 3.016 0 0 0 2.122 2.136c1.871.505 9.376.505 9.376.505s7.505 0 9.377-.505a3.015 3.015 0 0 0 2.122-2.136C24 15.93 24 12 24 12s0-3.93-.502-5.814zM9.545 15.568V8.432L15.818 12l-6.273 3.568z"/>
                            </svg>
                        </a>
                        <a href="https://wa.me/221769047999" target="_blank" class="w-12 h-12 bg-green-600 hover:bg-green-700 rounded-full flex items-center justify-center transition-all duration-300 hover:scale-110">
                            <svg width="20" height="20" viewBox="0 0 24 24" fill="currentColor" class="text-white">
                                <path d="M17.472 14.382c-.297-.149-1.758-.867-2.03-.967-.273-.099-.471-.148-.67.15-.197.297-.767.966-.94 1.164-.173.199-.347.223-.644.075-.297-.15-1.255-.463-2.39-1.475-.883-.788-1.48-1.761-1.653-2.059-.173-.297-.018-.458.13-.606.134-.133.298-.347.446-.52.149-.174.198-.298.298-.497.099-.198.05-.371-.025-.52-.075-.149-.669-1.612-.916-2.207-.242-.579-.487-.5-.669-.51-.173-.008-.371-.01-.57-.01-.198 0-.52.074-.792.372-.272.297-1.04 1.016-1.04 2.479 0 1.462 1.065 2.875 1.213 3.074.149.198 2.096 3.2 5.077 4.487.709.306 1.262.489 1.694.625.712.227 1.36.195 1.871.118.571-.085 1.758-.719 2.006-1.413.248-.694.248-1.289.173-1.413-.074-.124-.272-.198-.57-.347m-5.421 7.403h-.004a9.87 9.87 0 01-5.031-1.378l-.361-.214-3.741.982.998-3.648-.235-.374a9.86 9.86 0 01-1.51-5.26c.001-5.45 4.436-9.884 9.888-9.884 2.64 0 5.122 1.03 6.988 2.898a9.825 9.825 0 012.893 6.994c-.003 5.45-4.437 9.884-9.885 9.884m8.413-18.297A11.815 11.815 0 0012.05 0C5.495 0 .16 5.335.157 11.892c0 2.096.547 4.142 1.588 5.945L.057 24l6.305-1.654a11.882 11.882 0 005.683 1.448h.005c6.554 0 11.89-5.335 11.893-11.893A11.821 11.821 0 0020.465 3.516"/>
                            </svg>
                        </a>
                        <a href="mailto:abmcompanysn@gmail.com" class="w-12 h-12 bg-purple-600 hover:bg-purple-700 rounded-full flex items-center justify-center transition-all duration-300 hover:scale-110">
                            <svg width="20" height="20" viewBox="0 0 24 24" fill="currentColor" class="text-white">
                                <path d="M24 5.457v13.909c0 .904-.732 1.636-1.636 1.636h-3.819V11.73L12 16.64l-6.545-4.91v9.273H1.636A1.636 1.636 0 0 1 0 19.366V5.457c0-.904.732-1.636 1.636-1.636h.91L12 10.09l9.455-6.269h.909c.904 0 1.636.732 1.636 1.636z"/>
                            </svg>
                        </a>
                    </div>
                </div>
            </div>
            
            <!-- Section Réseaux Sociaux Spéciale -->
            <div class="text-center mt-8 mb-6">
                <h3 class="text-xl font-bold text-white mb-4">🌐 Rejoignez Notre Communauté</h3>
                <div class="bg-white/10 backdrop-blur-sm rounded-2xl p-6 max-w-4xl mx-auto">
                    <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
                        <!-- WhatsApp Business -->
                        <div class="bg-green-500/20 rounded-xl p-4 border border-green-400/30">
                            <div class="text-4xl mb-3">
                                <svg width="40" height="40" viewBox="0 0 24 24" fill="currentColor" class="text-green-400">
                                    <path d="M17.472 14.382c-.297-.149-1.758-.867-2.03-.967-.273-.099-.471-.148-.67.15-.197.297-.767.966-.94 1.164-.173.199-.347.223-.644.075-.297-.15-1.255-.463-2.39-1.475-.883-.788-1.48-1.761-1.653-2.059-.173-.297-.018-.458.13-.606.134-.133.298-.347.446-.52.149-.174.198-.298.298-.497.099-.198.05-.371-.025-.52-.075-.149-.669-1.612-.916-2.207-.242-.579-.487-.5-.669-.51-.173-.008-.371-.01-.57-.01-.198 0-.52.074-.792.372-.272.297-1.04 1.016-1.04 2.479 0 1.462 1.065 2.875 1.213 3.074.149.198 2.096 3.2 5.077 4.487.709.306 1.262.489 1.694.625.712.227 1.36.195 1.871.118.571-.085 1.758-.719 2.006-1.413.248-.694.248-1.289.173-1.413-.074-.124-.272-.198-.57-.347m-5.421 7.403h-.004a9.87 9.87 0 01-5.031-1.378l-.361-.214-3.741.982.998-3.648-.235-.374a9.86 9.86 0 01-1.51-5.26c.001-5.45 4.436-9.884 9.888-9.884 2.64 0 5.122 1.03 6.988 2.898a9.825 9.825 0 012.893 6.994c-.003 5.45-4.437 9.884-9.885 9.884m8.413-18.297A11.815 11.815 0 0012.05 0C5.495 0 .16 5.335.157 11.892c0 2.096.547 4.142 1.588 5.945L.057 24l6.305-1.654a11.882 11.882 0 005.683 1.448h.005c6.554 0 11.89-5.335 11.893-11.893A11.821 11.821 0 0020.465 3.516"/>
                                </svg>
                            </div>
                            <h4 class="font-bold text-white mb-2">WhatsApp Business</h4>
                            <p class="text-green-200 text-sm mb-3">Rejoignez notre chaîne officielle</p>
                            <a href="https://whatsapp.com/channel/0029VbAwuPc5kg6yWk69Ij0v" target="_blank" 
                               class="inline-block bg-green-600 hover:bg-green-700 text-white px-4 py-2 rounded-lg text-sm font-medium transition-all duration-300 hover:scale-105">
                                📱 Notre Chaîne WhatsApp
                            </a>
                        </div>
                        
                        <!-- YouTube -->
                        <div class="bg-red-500/20 rounded-xl p-4 border border-red-400/30">
                            <div class="text-4xl mb-3">
                                <svg width="40" height="40" viewBox="0 0 24 24" fill="currentColor" class="text-red-400">
                                    <path d="M23.498 6.186a3.016 3.016 0 0 0-2.122-2.136C19.505 3.545 12 3.545 12 3.545s-7.505 0-9.377.505A3.017 3.017 0 0 0 .502 6.186C0 8.07 0 12 0 12s0 3.93.502 5.814a3.016 3.016 0 0 0 2.122 2.136c1.871.505 9.376.505 9.376.505s7.505 0 9.377-.505a3.015 3.015 0 0 0 2.122-2.136C24 15.93 24 12 24 12s0-3.93-.502-5.814zM9.545 15.568V8.432L15.818 12l-6.273 3.568z"/>
                                </svg>
                            </div>
                            <h4 class="font-bold text-white mb-2">YouTube</h4>
                            <p class="text-red-200 text-sm mb-3">Tutoriels et démonstrations</p>
                            <a href="https://www.youtube.com/@CompanyABM" target="_blank" 
                               class="inline-block bg-red-600 hover:bg-red-700 text-white px-4 py-2 rounded-lg text-sm font-medium transition-all duration-300 hover:scale-105">
                                🎬 Notre Chaîne
                            </a>
                        </div>
                        
                        <!-- TikTok -->
                        <div class="bg-gray-800/40 rounded-xl p-4 border border-gray-600/30">
                            <div class="text-4xl mb-3">
                                <svg width="40" height="40" viewBox="0 0 24 24" fill="currentColor" class="text-white">
                                    <path d="M12.525.02c1.31-.02 2.61-.01 3.91-.02.08 1.53.63 3.09 1.75 4.17 1.12 1.11 2.7 1.62 4.24 1.79v4.03c-1.44-.05-2.89-.35-4.2-.97-.57-.26-1.1-.59-1.62-.93-.01 2.92.01 5.84-.02 8.75-.08 1.4-.54 2.79-1.35 3.94-1.31 1.92-3.58 3.17-5.91 3.21-1.43.08-2.86-.31-4.08-1.03-2.02-1.19-3.44-3.37-3.65-5.71-.02-.5-.03-1-.01-1.49.18-1.9 1.12-3.72 2.58-4.96 1.66-1.44 3.98-2.13 6.15-1.72.02 1.48-.04 2.96-.04 4.44-.99-.32-2.15-.23-3.02.37-.63.41-1.11 1.04-1.36 1.75-.21.51-.15 1.07-.14 1.61.24 1.64 1.82 3.02 3.5 2.87 1.12-.01 2.19-.66 2.77-1.61.19-.33.4-.67.41-1.06.1-1.79.06-3.57.07-5.36.01-4.03-.01-8.05.02-12.07z"/>
                                </svg>
                            </div>
                            <h4 class="font-bold text-white mb-2">TikTok</h4>
                            <p class="text-gray-200 text-sm mb-3">Contenus tech et innovations</p>
                            <a href="https://www.tiktok.com/@tech_sn_abmcompany" target="_blank" 
                               class="inline-block bg-gray-800 hover:bg-gray-900 text-white px-4 py-2 rounded-lg text-sm font-medium transition-all duration-300 hover:scale-105">
                                🎭 @tech_sn_abmcompany
                            </a>
                        </div>
                    </div>
                    
                    <!-- Contact Email -->
                    <div class="mt-6 p-4 bg-purple-500/20 rounded-xl border border-purple-400/30">
                        <div class="flex items-center justify-center space-x-4">
                            <span class="text-3xl">📧</span>
                            <div class="text-center">
                                <h4 class="font-bold text-white">Contact Professionnel</h4>
                                <a href="mailto:abmcompanysn@gmail.com" 
                                   class="text-purple-200 hover:text-white transition-colors duration-300 font-medium">
                                    abmcompanysn@gmail.com
                                </a>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Badge de Qualité -->
            <div class="text-center mt-6">
                <div class="inline-flex items-center bg-gradient-to-r from-green-500 to-blue-500 text-white px-4 py-2 rounded-full text-sm font-medium">
                    <span class="mr-2">🏆</span>
                    Technologie Sénégalaise de Qualité Internationale
                    <span class="ml-2">⭐</span>
                </div>
            </div>
        </div>
    </footer>

    <!-- Bottom Navigation - Version Professionnelle -->
    <div class="bottom-nav">
        <div class="flex">
            <button class="nav-item active haptic" onclick="switchTab('home')">
                <svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor" class="mb-1">
                    <path d="M10 20v-6h4v6h5v-8h3L12 3 2 12h3v8z"/>
                </svg>
                <span class="text-xs font-medium">Accueil</span>
            </button>
            <button class="nav-item haptic" onclick="switchTab('today')">
                <svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor" class="mb-1">
                    <path d="M19 3h-1V1h-2v2H8V1H6v2H5c-1.11 0-1.99.9-1.99 2L3 19c0 1.1.89 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zm0 16H5V8h14v11zM7 10h5v5H7z"/>
                </svg>
                <span class="text-xs font-medium">Aujourd'hui</span>
            </button>
            <button class="nav-item haptic" onclick="switchTab('stats')">
                <svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor" class="mb-1">
                    <path d="M3.5 18.49l6-6.01 4 4L22 6.92l-1.41-1.41-7.09 7.97-4-4L2 16.99z"/>
                </svg>
                <span class="text-xs font-medium">Statistiques</span>
            </button>
            <button class="nav-item haptic" onclick="switchTab('settings')">
                <svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor" class="mb-1">
                    <path d="M19.14,12.94c0.04-0.3,0.06-0.61,0.06-0.94c0-0.32-0.02-0.64-0.07-0.94l2.03-1.58c0.18-0.14,0.23-0.41,0.12-0.61 l-1.92-3.32c-0.12-0.22-0.37-0.29-0.59-0.22l-2.39,0.96c-0.5-0.38-1.03-0.7-1.62-0.94L14.4,2.81c-0.04-0.24-0.24-0.41-0.48-0.41 h-3.84c-0.24,0-0.43,0.17-0.47,0.41L9.25,5.35C8.66,5.59,8.12,5.92,7.63,6.29L5.24,5.33c-0.22-0.08-0.47,0-0.59,0.22L2.74,8.87 C2.62,9.08,2.66,9.34,2.86,9.48l2.03,1.58C4.84,11.36,4.8,11.69,4.8,12s0.02,0.64,0.07,0.94l-2.03,1.58 c-0.18,0.14-0.23,0.41-0.12,0.61l1.92,3.32c0.12,0.22,0.37,0.29,0.59,0.22l2.39-0.96c0.5,0.38,1.03,0.7,1.62,0.94l0.36,2.54 c0.05,0.24,0.24,0.41,0.48,0.41h3.84c0.24,0,0.44-0.17,0.47-0.41l0.36-2.54c0.59-0.24,1.13-0.56,1.62-0.94l2.39,0.96 c0.22,0.08,0.47,0,0.59-0.22l1.92-3.32c0.12-0.22,0.07-0.47-0.12-0.61L19.14,12.94z M12,15.6c-1.98,0-3.6-1.62-3.6-3.6 s1.62-3.6,3.6-3.6s3.6,1.62,3.6,3.6S13.98,15.6,12,15.6z"/>
                </svg>
                <span class="text-xs font-medium">Paramètres</span>
            </button>
        </div>
    </div>

    <!-- Floating Add Button - Version Professionnelle -->
    <button class="floating-add haptic" onclick="showAddModal()">
        <svg width="28" height="28" viewBox="0 0 24 24" fill="currentColor" class="text-white">
            <path d="M19 13h-6v6h-2v-6H5v-2h6V5h2v6h6v2z"/>
        </svg>
    </button>

    <!-- Smart Scheduler Modal -->
    <div id="smartSchedulerModal" class="modal">
        <div class="modal-content">
            <div class="flex items-center justify-between mb-6">
                <h2 class="text-xl font-bold flex items-center">
                    <span class="mr-2">⚡</span>
                    Programmation Intelligente
                </h2>
                <button onclick="hideSmartScheduler()" class="w-8 h-8 rounded-full bg-gray-100 flex items-center justify-center haptic">
                    ✕
                </button>
            </div>
            
            <!-- AI Analysis -->
            <div id="aiAnalysis" class="bg-gradient-to-r from-blue-50 to-purple-50 rounded-lg p-4 mb-6">
                <h3 class="font-semibold text-gray-800 mb-2 flex items-center">
                    <span class="mr-2">🧠</span>
                    Analyse IA de votre demande
                </h3>
                <div id="analysisResult" class="text-sm text-gray-600">
                    L'IA analysera votre demande ici...
                </div>
            </div>
            
            <!-- Smart Suggestions -->
            <div id="smartSuggestions" class="space-y-3 mb-6">
                <!-- Dynamic suggestions will be populated here -->
            </div>
            
            <!-- Bulk Actions -->
            <div class="flex space-x-2 mb-4">
                <button onclick="acceptAllSuggestions()" class="mobile-btn flex-1 py-3 haptic bg-green-500">
                    ✅ Tout Accepter
                </button>
                <button onclick="customizeSchedule()" class="mobile-btn flex-1 py-3 haptic bg-blue-500">
                    ⚙️ Personnaliser
                </button>
            </div>
        </div>
    </div>

    <!-- Add Reminder Modal -->
    <div id="addModal" class="modal">
        <div class="modal-content">
            <div class="flex items-center justify-between mb-6">
                <h2 class="text-xl font-bold">Nouveau Rappel</h2>
                <button onclick="hideAddModal()" class="w-8 h-8 rounded-full bg-gray-100 flex items-center justify-center haptic">
                    ✕
                </button>
            </div>
            
            <form id="reminderForm" class="space-y-4">
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">💭 Description</label>
                    <input type="text" id="reminderText" placeholder="Que voulez-vous vous rappeler ?" 
                           class="mobile-input w-full px-4 py-3">
                </div>
                
                <div class="grid grid-cols-2 gap-4">
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">📅 Date</label>
                        <input type="date" id="reminderDate" class="mobile-input w-full px-4 py-3">
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">⏰ Heure</label>
                        <input type="time" id="reminderTime" class="mobile-input w-full px-4 py-3">
                    </div>
                </div>
                
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">🎯 Catégorie</label>
                    <select id="reminderCategory" class="mobile-input w-full px-4 py-3">
                        <option value="tache">📋 Tâche</option>
                        <option value="rendez-vous">📅 Rendez-vous</option>
                        <option value="priere">🙏 Prière Chrétienne</option>
                        <option value="messe">⛪ Messe/Culte</option>
                        <option value="appel">📞 Appel</option>
                        <option value="sante">🏥 Santé</option>
                        <option value="travail">💼 Travail</option>
                        <option value="famille">👨‍👩‍👧‍👦 Famille</option>
                        <option value="sport">🏃‍♂️ Sport</option>
                    </select>
                </div>
                
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">⚡ Priorité</label>
                    <select id="reminderPriority" class="mobile-input w-full px-4 py-3">
                        <option value="basse">🟢 Basse</option>
                        <option value="normale" selected>🟡 Normale</option>
                        <option value="haute">🔴 Haute</option>
                        <option value="urgente">🚨 Urgente</option>
                    </select>
                </div>
                
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">📍 Lieu (optionnel)</label>
                    <div class="flex space-x-2">
                        <input type="text" id="reminderLocation" placeholder="Où ?" 
                               class="mobile-input flex-1 px-4 py-3">
                        <button type="button" onclick="getLocation()" 
                                class="mobile-btn px-4 py-3 haptic">📍</button>
                    </div>
                </div>
                
                <!-- Programmation Récurrente -->
                <div class="space-y-4">
                    <div class="flex items-center space-x-3">
                        <input type="checkbox" id="isRecurring" class="w-5 h-5 text-primary rounded" onchange="toggleRecurringOptions()">
                        <label for="isRecurring" class="text-sm font-medium text-gray-700">
                            🔄 Rappel récurrent (répétition automatique)
                        </label>
                    </div>
                    
                    <div id="recurringOptions" class="space-y-4 hidden">
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">🔁 Fréquence</label>
                            <select id="recurringType" class="mobile-input w-full px-4 py-3" onchange="updateRecurringOptions()">
                                <option value="daily">📅 Tous les jours</option>
                                <option value="weekly">📆 Chaque semaine</option>
                                <option value="monthly">🗓️ Chaque mois</option>
                                <option value="yearly">📅 Chaque année</option>
                                <option value="custom">⚙️ Personnalisé</option>
                            </select>
                        </div>
                        
                        <!-- Options pour récurrence hebdomadaire -->
                        <div id="weeklyOptions" class="hidden">
                            <label class="block text-sm font-medium text-gray-700 mb-2">📅 Jours de la semaine</label>
                            <div class="grid grid-cols-7 gap-2">
                                <label class="flex flex-col items-center">
                                    <input type="checkbox" value="1" class="recurring-days mb-1">
                                    <span class="text-xs">Lun</span>
                                </label>

                                <label class="flex flex-col items-center">
                                    <input type="checkbox" value="2" class="recurring-days mb-1">
                                    <span class="text-xs">Mar</span>
                                </label>
                                <label class="flex flex-col items-center">
                                    <input type="checkbox" value="3" class="recurring-days mb-1">
                                    <span class="text-xs">Mer</span>
                                </label>
                                <label class="flex flex-col items-center">
                                    <input type="checkbox" value="4" class="recurring-days mb-1">
                                    <span class="text-xs">Jeu</span>
                                </label>
                                <label class="flex flex-col items-center">
                                    <input type="checkbox" value="5" class="recurring-days mb-1">
                                    <span class="text-xs">Ven</span>
                                </label>
                                <label class="flex flex-col items-center">
                                    <input type="checkbox" value="6" class="recurring-days mb-1">
                                    <span class="text-xs">Sam</span>
                                </label>
                                <label class="flex flex-col items-center">
                                    <input type="checkbox" value="0" class="recurring-days mb-1">
                                    <span class="text-xs">Dim</span>
                                </label>
                            </div>
                        </div>
                        
                        <!-- Options personnalisées -->
                        <div id="customOptions" class="hidden space-y-3">
                            <div class="grid grid-cols-2 gap-4">
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-2">🔢 Répéter tous les</label>
                                    <input type="number" id="customInterval" min="1" max="365" value="1" 
                                           class="mobile-input w-full px-4 py-3">
                                </div>
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-2">📊 Unité</label>
                                    <select id="customUnit" class="mobile-input w-full px-4 py-3">
                                        <option value="days">Jour(s)</option>
                                        <option value="weeks">Semaine(s)</option>
                                        <option value="months">Mois</option>
                                        <option value="years">Année(s)</option>
                                    </select>
                                </div>
                            </div>
                        </div>
                        
                        <div class="grid grid-cols-2 gap-4">
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">📅 Date de fin</label>
                                <input type="date" id="recurringEndDate" class="mobile-input w-full px-4 py-3">
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">🔢 Ou nombre max</label>
                                <input type="number" id="maxOccurrences" min="1" max="1000" placeholder="∞" 
                                       class="mobile-input w-full px-4 py-3">
                            </div>
                        </div>
                        
                        <!-- Aperçu des prochaines occurrences -->
                        <div id="recurringPreview" class="bg-gray-50 rounded-lg p-3">
                            <h4 class="text-sm font-medium text-gray-700 mb-2">👀 Aperçu des prochains rappels :</h4>
                            <div id="previewList" class="text-xs text-gray-600 space-y-1">
                                <!-- Preview will be generated here -->
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Options avancées WhatsApp -->
                <div class="space-y-4">
                    <div class="flex items-center space-x-3">
                        <input type="checkbox" id="sendToWhatsApp" class="w-5 h-5 text-primary rounded">
                        <label for="sendToWhatsApp" class="text-sm font-medium text-gray-700">
                            📱 Envoyer automatiquement sur WhatsApp
                        </label>
                    </div>
                    
                    <div class="flex items-center space-x-3">
                        <input type="checkbox" id="advanceNotice" class="w-5 h-5 text-primary rounded" onchange="toggleAdvanceOptions()">
                        <label for="advanceNotice" class="text-sm font-medium text-gray-700">
                            ⏰ Rappel à l'avance
                        </label>
                    </div>
                    
                    <div id="advanceOptions" class="hidden space-y-3">
                        <div class="grid grid-cols-2 gap-4">
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">⏱️ Temps avant</label>
                                <input type="number" id="advanceTime" min="1" max="1440" value="15" 
                                       class="mobile-input w-full px-4 py-3">
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">📊 Unité</label>
                                <select id="advanceUnit" class="mobile-input w-full px-4 py-3">
                                    <option value="minutes">Minutes</option>
                                    <option value="hours">Heures</option>
                                    <option value="days">Jours</option>
                                </select>
                            </div>
                        </div>
                    </div>
                </div>
                
                <button type="submit" class="mobile-btn w-full py-4 text-lg font-bold haptic">
                    🚀 Créer le Rappel Programmé
                </button>
            </form>
        </div>
    </div>

    <!-- Notification -->
    <div id="notification" class="notification">
        <div class="flex items-center space-x-3">
            <span id="notificationIcon" class="text-xl"></span>
            <div class="flex-1">
                <div id="notificationTitle" class="font-medium"></div>
                <div id="notificationMessage" class="text-sm text-gray-600"></div>
            </div>
            <button onclick="hideNotification()" class="text-gray-400 haptic">✕</button>
        </div>
    </div>

    <script>
        class MobileRemindSystem {
            constructor() {
                this.reminders = JSON.parse(localStorage.getItem('mobile_reminders')) || [];
                this.completedReminders = JSON.parse(localStorage.getItem('mobile_completed')) || [];
                this.currentTab = 'home';
                this.currentFilter = '';
                
                this.christianVerses = [
                    "Je puis tout par celui qui me fortifie. (Philippiens 4:13)",
                    "L'Éternel est mon berger: je ne manquerai de rien. (Psaume 23:1)",
                    "Venez à moi, vous tous qui êtes fatigués et chargés, et je vous donnerai du repos. (Matthieu 11:28)",
                    "Car je connais les projets que j'ai formés sur vous, dit l'Éternel, projets de paix et non de malheur. (Jérémie 29:11)",
                    "Ne vous inquiétez de rien; mais en toute chose faites connaître vos besoins à Dieu par des prières. (Philippiens 4:6)",
                    "Celui qui demeure sous l'abri du Très-Haut repose à l'ombre du Tout-Puissant. (Psaume 91:1)",
                    "Car Dieu n'est pas un Dieu de désordre, mais de paix. (1 Corinthiens 14:33)",
                    "Remets ton sort à l'Éternel, et il te soutiendra. (Psaume 55:22)"
                ];
                
                this.settings = JSON.parse(localStorage.getItem('mobile_settings')) || {
                    callMeBotNumber: '',
                    callMeBotApiKey: '',
                    enableCallMeBot: false,
                    notifyCallMeBot: true,
                    notifyBrowser: true,
                    callMeBotTemplate: '🔔 Rappel ABM Reminder\n📋 {titre}\n📅 Prévu pour: {heure}\n📍 Lieu: {lieu}\n⚡ Envoyé automatiquement'
                };
                
                // Système de catégories personnalisées
                this.customCategories = JSON.parse(localStorage.getItem('mobile_custom_categories')) || [];
                this.defaultCategories = [
                    { id: 'tache', name: 'Tâche', icon: '📋', color: 'blue', deletable: false },
                    { id: 'rendez-vous', name: 'Rendez-vous', icon: '📅', color: 'green', deletable: false },
                    { id: 'priere', name: 'Prière Chrétienne', icon: '🙏', color: 'purple', deletable: false },
                    { id: 'messe', name: 'Messe/Culte', icon: '⛪', color: 'orange', deletable: false },
                    { id: 'appel', name: 'Appel', icon: '📞', color: 'yellow', deletable: false },
                    { id: 'sante', name: 'Santé', icon: '🏥', color: 'red', deletable: false },
                    { id: 'travail', name: 'Travail', icon: '💼', color: 'indigo', deletable: false },
                    { id: 'famille', name: 'Famille', icon: '👨‍👩‍👧‍👦', color: 'pink', deletable: false },
                    { id: 'sport', name: 'Sport', icon: '🏃‍♂️', color: 'cyan', deletable: false }
                ];
                
                this.messageStats = JSON.parse(localStorage.getItem('mobile_message_stats')) || {
                    callMeBotSent: 0,
                    totalSent: 0
                };
                
                this.init();
            }
            
            init() {
                this.setupEventListeners();
                this.setDefaultDateTime();
                this.renderReminders();
                this.updateStats();
                this.startNotificationChecker();
                this.createDemoData();
                this.loadSettings();
                this.initializeAI();
                this.renderCategoriesList();
                
                // Show welcome message
                setTimeout(() => {
                    this.showNotification('⚡', 'ABM Reminder', 'Système international activé avec succès!');
                    this.generateAISuggestions();
                }, 1000);
            }
            
            initializeAI() {
                this.aiPatterns = {
                    morning: {
                        name: 'Routine Matinale Complète',
                        icon: '🌅',
                        reminders: [
                            { text: 'Réveil et prière du matin', time: '06:30', category: 'priere', priority: 'haute' },
                            { text: 'Exercices physiques', time: '07:00', category: 'sport', priority: 'normale' },
                            { text: 'Petit-déjeuner équilibré', time: '07:30', category: 'sante', priority: 'normale' },
                            { text: 'Lecture spirituelle', time: '08:00', category: 'priere', priority: 'normale' },
                            { text: 'Préparation pour le travail', time: '08:30', category: 'travail', priority: 'normale' }
                        ]
                    },
                    work: {
                        name: 'Journée de Travail Optimisée',
                        icon: '💼',
                        reminders: [
                            { text: 'Planification de la journée', time: '09:00', category: 'travail', priority: 'haute' },
                            { text: 'Pause et hydratation', time: '10:30', category: 'sante', priority: 'normale' },
                            { text: 'Déjeuner et repos', time: '12:30', category: 'sante', priority: 'normale' },
                            { text: 'Point équipe', time: '14:00', category: 'travail', priority: 'normale' },
                            { text: 'Bilan de la journée', time: '17:30', category: 'travail', priority: 'normale' }
                        ]
                    },
                    health: {
                        name: 'Suivi Santé Complet',
                        icon: '🏥',
                        reminders: [
                            { text: 'Prise de médicaments', time: '08:00', category: 'sante', priority: 'urgente' },
                            { text: 'Mesure tension artérielle', time: '09:00', category: 'sante', priority: 'haute' },
                            { text: 'Exercices de respiration', time: '12:00', category: 'sante', priority: 'normale' },
                            { text: 'Marche de 30 minutes', time: '16:00', category: 'sport', priority: 'normale' },
                            { text: 'Prise de médicaments du soir', time: '20:00', category: 'sante', priority: 'urgente' }
                        ]
                    },
                    spiritual: {
                        name: 'Vie Spirituelle Enrichie',
                        icon: '🙏',
                        reminders: [
                            { text: 'Prière du matin avec gratitude', time: '06:00', category: 'priere', priority: 'haute' },
                            { text: 'Lecture biblique quotidienne', time: '07:00', category: 'priere', priority: 'normale' },
                            { text: 'Prière de midi', time: '12:00', category: 'priere', priority: 'normale' },
                            { text: 'Temps de méditation', time: '18:00', category: 'priere', priority: 'normale' },
                            { text: 'Prière du soir et examen de conscience', time: '21:00', category: 'priere', priority: 'haute' }
                        ]
                    }
                };
                
                this.aiKeywords = {
                    'prière': ['priere', 'prier', 'dieu', 'jesus', 'christ', 'spirituel', 'meditation', 'bible'],
                    'messe': ['messe', 'eglise', 'culte', 'service', 'communion', 'eucharistie'],
                    'sante': ['medecin', 'docteur', 'hopital', 'medicament', 'sante', 'rendez-vous medical', 'pharmacie'],
                    'travail': ['travail', 'bureau', 'reunion', 'projet', 'deadline', 'presentation', 'client'],
                    'famille': ['famille', 'enfants', 'parents', 'appeler', 'visite', 'anniversaire'],
                    'sport': ['sport', 'gym', 'course', 'exercice', 'fitness', 'entrainement'],
                    'tache': ['faire', 'acheter', 'nettoyer', 'ranger', 'courses', 'menage']
                };
                
                this.currentAISuggestions = [];
            }
            
            generateAISuggestions() {
                const suggestions = document.getElementById('aiSuggestions');
                const now = new Date();
                const hour = now.getHours();
                
                let smartSuggestions = [];
                
                // Time-based suggestions
                if (hour >= 6 && hour < 9) {
                    smartSuggestions.push({
                        icon: '🌅',
                        text: 'Routine matinale complète',
                        action: () => this.applySmartPattern('morning')
                    });
                } else if (hour >= 9 && hour < 17) {
                    smartSuggestions.push({
                        icon: '💼',
                        text: 'Optimiser votre journée de travail',
                        action: () => this.applySmartPattern('work')
                    });
                } else if (hour >= 17 && hour < 21) {
                    smartSuggestions.push({
                        icon: '👨‍👩‍👧‍👦',
                        text: 'Temps en famille ce soir',
                        action: () => this.createFamilyReminder()
                    });
                }
                
                // Pattern-based suggestions
                const recentCategories = this.getRecentCategories();
                if (recentCategories.includes('priere')) {
                    smartSuggestions.push({
                        icon: '🙏',
                        text: 'Enrichir votre vie spirituelle',
                        action: () => this.applySmartPattern('spiritual')
                    });
                }
                
                if (recentCategories.includes('sante')) {
                    smartSuggestions.push({
                        icon: '🏥',
                        text: 'Suivi santé personnalisé',
                        action: () => this.applySmartPattern('health')
                    });
                }
                
                // Render suggestions
                suggestions.innerHTML = smartSuggestions.slice(0, 3).map(suggestion => `
                    <div class="bg-white/50 rounded-lg p-3 flex items-center justify-between cursor-pointer hover:bg-white/70 transition-all haptic" onclick="this.click()">
                        <div class="flex items-center space-x-3">
                            <span class="text-xl">${suggestion.icon}</span>
                            <span class="text-sm font-medium text-gray-700">${suggestion.text}</span>
                        </div>
                        <span class="text-blue-500 text-sm">→</span>
                    </div>
                `).join('');
                
                // Add click handlers
                suggestions.querySelectorAll('.cursor-pointer').forEach((el, index) => {
                    el.onclick = smartSuggestions[index].action;
                });
            }
            
            getRecentCategories() {
                const recent = this.reminders
                    .filter(r => {
                        const created = new Date(r.created);
                        const daysDiff = (new Date() - created) / (1000 * 60 * 60 * 24);
                        return daysDiff <= 7;
                    })
                    .map(r => r.category);
                
                return [...new Set(recent)];
            }
            
            processAIInput(inputText = null) {
                const input = inputText || document.getElementById('aiInput').value.trim().toLowerCase();
                if (!input) return;
                
                this.showNotification('🤖', 'IA', 'Analyse de votre demande...');
                
                // Simulate AI processing
                setTimeout(() => {
                    const analysis = this.analyzeUserInput(input);
                    this.showSmartScheduler(analysis);
                }, 1500);
                
                // Clear input
                if (!inputText) {
                    document.getElementById('aiInput').value = '';
                }
            }
            
            analyzeUserInput(input) {
                const analysis = {
                    originalText: input,
                    detectedCategory: 'tache',
                    suggestedPriority: 'normale',
                    suggestedTime: null,
                    suggestedRecurrence: null,
                    confidence: 0,
                    suggestions: []
                };
                
                // Detect category
                for (const [category, keywords] of Object.entries(this.aiKeywords)) {
                    const matches = keywords.filter(keyword => input.includes(keyword)).length;
                    if (matches > 0) {
                        analysis.detectedCategory = category;
                        analysis.confidence += matches * 20;
                        break;
                    }
                }
                
                // Detect time patterns
                const timePatterns = [
                    { pattern: /(\d{1,2})[h:](\d{2})?/, type: 'specific' },
                    { pattern: /matin|matinée/, time: '08:00', type: 'period' },
                    { pattern: /midi|déjeuner/, time: '12:00', type: 'period' },
                    { pattern: /après-midi/, time: '15:00', type: 'period' },
                    { pattern: /soir|soirée/, time: '19:00', type: 'period' },
                    { pattern: /nuit/, time: '21:00', type: 'period' }
                ];
                
                for (const timePattern of timePatterns) {
                    const match = input.match(timePattern.pattern);
                    if (match) {
                        if (timePattern.type === 'specific') {
                            const hour = match[1].padStart(2, '0');
                            const minute = (match[2] || '00').padStart(2, '0');
                            analysis.suggestedTime = `${hour}:${minute}`;
                        } else {
                            analysis.suggestedTime = timePattern.time;
                        }
                        analysis.confidence += 15;
                        break;
                    }
                }
                
                // Detect recurrence
                const recurrencePatterns = [
                    { pattern: /tous les jours|quotidien|chaque jour/, type: 'daily' },
                    { pattern: /chaque semaine|hebdomadaire/, type: 'weekly' },
                    { pattern: /chaque mois|mensuel/, type: 'monthly' },
                    { pattern: /lundi|mardi|mercredi|jeudi|vendredi|samedi|dimanche/, type: 'weekly' }
                ];
                
                for (const recPattern of recurrencePatterns) {
                    if (input.match(recPattern.pattern)) {
                        analysis.suggestedRecurrence = recPattern.type;
                        analysis.confidence += 10;
                        break;
                    }
                }
                
                // Detect priority
                if (input.includes('urgent') || input.includes('important') || input.includes('critique')) {
                    analysis.suggestedPriority = 'urgente';
                    analysis.confidence += 10;
                } else if (input.includes('priorité') || input.includes('important')) {
                    analysis.suggestedPriority = 'haute';
                    analysis.confidence += 5;
                }
                
                // Generate smart suggestions
                analysis.suggestions = this.generateSmartSuggestions(analysis);
                
                return analysis;
            }
            
            generateSmartSuggestions(analysis) {
                const suggestions = [];
                const now = new Date();
                const today = now.toISOString().split('T')[0];
                
                // Main suggestion based on analysis
                const mainSuggestion = {
                    id: Date.now(),
                    text: this.capitalizeFirst(analysis.originalText),
                    date: today,
                    time: analysis.suggestedTime || '09:00',
                    category: analysis.detectedCategory,
                    priority: analysis.suggestedPriority,
                    location: '',
                    isRecurring: !!analysis.suggestedRecurrence,
                    recurringType: analysis.suggestedRecurrence,
                    confidence: analysis.confidence
                };
                
                suggestions.push(mainSuggestion);
                
                // Add related suggestions based on category
                if (analysis.detectedCategory === 'priere') {
                    suggestions.push({
                        id: Date.now() + 1,
                        text: 'Lecture spirituelle associée',
                        date: today,
                        time: this.addMinutes(analysis.suggestedTime || '09:00', 30),
                        category: 'priere',
                        priority: 'normale',
                        location: '',
                        confidence: 70
                    });
                } else if (analysis.detectedCategory === 'sante') {
                    suggestions.push({
                        id: Date.now() + 1,
                        text: 'Rappel de suivi médical',
                        date: this.addDays(today, 7),
                        time: analysis.suggestedTime || '10:00',
                        category: 'sante',
                        priority: 'normale',
                        location: '',
                        confidence: 60
                    });
                }
                
                // Add preparation reminder if needed
                if (['rendez-vous', 'messe', 'travail'].includes(analysis.detectedCategory)) {
                    suggestions.push({
                        id: Date.now() + 2,
                        text: 'Préparation - ' + analysis.originalText,
                        date: today,
                        time: this.subtractMinutes(analysis.suggestedTime || '09:00', 30),
                        category: analysis.detectedCategory,
                        priority: 'basse',
                        location: '',
                        confidence: 50
                    });
                }
                
                return suggestions;
            }
            
            capitalizeFirst(str) {
                return str.charAt(0).toUpperCase() + str.slice(1);
            }
            
            addMinutes(time, minutes) {
                const [hours, mins] = time.split(':').map(Number);
                const date = new Date();
                date.setHours(hours, mins + minutes);
                return date.toTimeString().slice(0, 5);
            }
            
            subtractMinutes(time, minutes) {
                const [hours, mins] = time.split(':').map(Number);
                const date = new Date();
                date.setHours(hours, mins - minutes);
                return date.toTimeString().slice(0, 5);
            }
            
            addDays(dateStr, days) {
                const date = new Date(dateStr);
                date.setDate(date.getDate() + days);
                return date.toISOString().split('T')[0];
            }
            

            
            applySmartPattern(patternName) {
                const pattern = this.aiPatterns[patternName];
                if (!pattern) return;
                
                this.showNotification('⚡', 'IA', `Application du modèle ${pattern.name}...`);
                
                const today = new Date().toISOString().split('T')[0];
                let addedCount = 0;
                
                pattern.reminders.forEach((reminderTemplate, index) => {
                    setTimeout(() => {
                        const reminder = {
                            id: Date.now() + index,
                            text: reminderTemplate.text,
                            date: today,
                            time: reminderTemplate.time,
                            category: reminderTemplate.category,
                            priority: reminderTemplate.priority,
                            location: reminderTemplate.location || '',
                            created: new Date().toISOString(),
                            notified: false,
                            completed: false
                        };
                        
                        // Check if similar reminder already exists
                        const exists = this.reminders.some(r => 
                            r.text.toLowerCase().includes(reminderTemplate.text.toLowerCase().split(' ')[0]) &&
                            r.date === today
                        );
                        
                        if (!exists) {
                            this.reminders.push(reminder);
                            addedCount++;
                        }
                    }, index * 200);
                });
                
                setTimeout(() => {
                    this.saveData();
                    this.renderReminders();
                    this.updateStats();
                    this.showNotification('✅', 'Succès', `${addedCount} rappels ajoutés avec ${pattern.name}!`);
                }, pattern.reminders.length * 200 + 500);
            }
            
            createFamilyReminder() {
                const familyReminders = [
                    { text: 'Appeler les parents', time: '19:00', priority: 'haute' },
                    { text: 'Temps de qualité en famille', time: '19:30', priority: 'normale' },
                    { text: 'Histoire du soir avec les enfants', time: '20:30', priority: 'normale' }
                ];
                
                const today = new Date().toISOString().split('T')[0];
                
                familyReminders.forEach((template, index) => {
                    const reminder = {
                        id: Date.now() + index,
                        text: template.text,
                        date: today,
                        time: template.time,
                        category: 'famille',
                        priority: template.priority,
                        location: '',
                        created: new Date().toISOString(),
                        notified: false,
                        completed: false
                    };
                    
                    this.reminders.push(reminder);
                });
                
                this.saveData();
                this.renderReminders();
                this.updateStats();
                this.showNotification('👨‍👩‍👧‍👦', 'Famille', 'Rappels familiaux créés!');
            }
            
            showSmartScheduler(analysis) {
                // This method is called from the global function
                // The actual implementation is in the global function
                return;
            }
            
            loadSettings() {
                // Load settings into form
                document.getElementById('callMeBotNumber').value = this.settings.callMeBotNumber;
                document.getElementById('callMeBotApiKey').value = this.settings.callMeBotApiKey;
                document.getElementById('enableCallMeBot').checked = this.settings.enableCallMeBot;
                document.getElementById('notifyCallMeBot').checked = this.settings.notifyCallMeBot;
                document.getElementById('notifyBrowser').checked = this.settings.notifyBrowser;
                document.getElementById('callMeBotTemplate').value = this.settings.callMeBotTemplate;
                
                this.updateConnectionStatus();
            }
            
            saveSettings() {
                // Get values from form
                this.settings = {
                    callMeBotNumber: document.getElementById('callMeBotNumber').value,
                    callMeBotApiKey: document.getElementById('callMeBotApiKey').value,
                    enableCallMeBot: document.getElementById('enableCallMeBot').checked,
                    notifyCallMeBot: document.getElementById('notifyCallMeBot').checked,
                    notifyBrowser: document.getElementById('notifyBrowser').checked,
                    callMeBotTemplate: document.getElementById('callMeBotTemplate').value
                };
                
                // Save to localStorage
                localStorage.setItem('mobile_settings', JSON.stringify(this.settings));
                
                this.updateConnectionStatus();
                this.showNotification('💾', 'Sauvegardé', 'Configuration CallMeBot enregistrée avec succès!');
                
                // Haptic feedback
                if (navigator.vibrate) {
                    navigator.vibrate([100, 50, 100]);
                }
            }
            
            updateConnectionStatus() {
                const callMeBotStatus = document.getElementById('callMeBotStatus');
                
                // CallMeBot status
                if (this.settings.callMeBotNumber && this.settings.callMeBotApiKey && this.settings.enableCallMeBot) {
                    callMeBotStatus.textContent = '✅ Configuré';
                    callMeBotStatus.className = 'px-3 py-1 bg-green-100 text-green-600 text-xs rounded-full';
                } else {
                    callMeBotStatus.textContent = 'Non configuré';
                    callMeBotStatus.className = 'px-3 py-1 bg-gray-100 text-gray-600 text-xs rounded-full';
                }
            }
            

            
            async testCallMeBot() {
                if (!this.settings.callMeBotNumber || !this.settings.callMeBotApiKey) {
                    this.showNotification('❌', 'Erreur', 'Veuillez configurer CallMeBot d\'abord');
                    return;
                }
                
                this.showNotification('📲', 'Test CallMeBot', 'Envoi du message de test...');
                
                try {
                    const testMessage = '🔔 Test ABM Reminder\n📅 ' + new Date().toLocaleString('fr-FR') + '\n✅ Configuration CallMeBot fonctionnelle!';
                    
                    const phoneNumber = this.settings.callMeBotNumber.replace(/\D/g, '');
                    const apiKey = this.settings.callMeBotApiKey;
                    const encodedMessage = encodeURIComponent(testMessage);
                    
                    const callMeBotUrl = `https://api.callmebot.com/whatsapp.php?phone=${phoneNumber}&text=${encodedMessage}&apikey=${apiKey}`;
                    
                    console.log('🧪 Test CallMeBot URL:', callMeBotUrl);
                    console.log('🧪 Message de test:', testMessage);
                    
                    // Utiliser une image invisible pour déclencher l'appel API
                    const img = new Image();
                    img.onload = () => {
                        console.log('✅ Test CallMeBot: Succès');
                        this.showNotification('✅', 'CallMeBot', 'Message de test envoyé! Vérifiez votre WhatsApp.');
                    };
                    img.onerror = () => {
                        console.log('✅ Test CallMeBot: Traité (normal avec CORS)');
                        this.showNotification('✅', 'CallMeBot', 'Message de test envoyé! Vérifiez votre WhatsApp.');
                    };
                    img.src = callMeBotUrl;
                    
                } catch (error) {
                    console.error('CallMeBot test error:', error);
                    this.showNotification('❌', 'Erreur CallMeBot', 'Échec: ' + error.message);
                }
            }


            
            setupEventListeners() {
                // Form submission
                document.getElementById('reminderForm').addEventListener('submit', (e) => {
                    e.preventDefault();
                    this.addReminder();
                });
                
                // Search
                document.getElementById('searchInput').addEventListener('input', (e) => {
                    this.currentFilter = e.target.value.toLowerCase();
                    this.renderReminders();
                });
                
                // Touch events for swipe actions
                this.setupSwipeGestures();
                
                // Prevent zoom on double tap
                let lastTouchEnd = 0;
                document.addEventListener('touchend', function (event) {
                    const now = (new Date()).getTime();
                    if (now - lastTouchEnd <= 300) {
                        event.preventDefault();
                    }
                    lastTouchEnd = now;
                }, false);
            }
            
            setupSwipeGestures() {
                let startX, startY, currentX, currentY;
                let isSwipeActive = false;
                let swipeTarget = null;
                
                document.addEventListener('touchstart', (e) => {
                    if (e.target.closest('.reminder-card')) {
                        startX = e.touches[0].clientX;
                        startY = e.touches[0].clientY;
                        swipeTarget = e.target.closest('.reminder-card');
                        isSwipeActive = true;
                    }
                });
                
                document.addEventListener('touchmove', (e) => {
                    if (!isSwipeActive || !swipeTarget) return;
                    
                    currentX = e.touches[0].clientX;
                    currentY = e.touches[0].clientY;
                    
                    const deltaX = currentX - startX;
                    const deltaY = Math.abs(currentY - startY);
                    
                    // Only swipe horizontally if vertical movement is minimal
                    if (deltaY < 50 && Math.abs(deltaX) > 20) {
                        e.preventDefault();
                        
                        if (deltaX < -50) {
                            swipeTarget.style.transform = `translateX(${Math.max(deltaX, -100)}px)`;
                        }
                    }
                });
                
                document.addEventListener('touchend', (e) => {
                    if (!isSwipeActive || !swipeTarget) return;
                    
                    const deltaX = currentX - startX;
                    
                    if (deltaX < -80) {
                        // Show swipe actions
                        swipeTarget.classList.add('swiped');
                        swipeTarget.style.transform = 'translateX(-100px)';
                    } else {
                        // Reset position
                        swipeTarget.classList.remove('swiped');
                        swipeTarget.style.transform = 'translateX(0)';
                    }
                    
                    isSwipeActive = false;
                    swipeTarget = null;
                });
            }
            
            setDefaultDateTime() {
                const now = new Date();
                const today = now.toISOString().split('T')[0];
                const time = now.toTimeString().slice(0, 5);
                
                document.getElementById('reminderDate').value = today;
                document.getElementById('reminderTime').value = time;
            }
            
            addReminder() {
                const text = document.getElementById('reminderText').value.trim();
                const date = document.getElementById('reminderDate').value;
                const time = document.getElementById('reminderTime').value;
                const category = document.getElementById('reminderCategory').value;
                const priority = document.getElementById('reminderPriority').value;
                const location = document.getElementById('reminderLocation').value.trim();
                
                if (!text || !date || !time) {
                    this.showNotification('❌', 'Erreur', 'Veuillez remplir tous les champs obligatoires');
                    return;
                }
                
                const reminder = {
                    id: Date.now(),
                    text,
                    date,
                    time,
                    category,
                    priority,
                    location,
                    created: new Date().toISOString(),
                    notified: false,
                    completed: false
                };
                
                this.reminders.push(reminder);
                this.saveData();
                this.renderReminders();
                this.updateStats();
                this.hideAddModal();
                this.clearForm();
                
                // Haptic feedback simulation
                if (navigator.vibrate) {
                    navigator.vibrate(50);
                }
                
                this.showNotification('✅', 'Succès', 'Rappel créé avec succès!');
            }
            
            completeReminder(id) {
                const reminder = this.reminders.find(r => r.id === id);
                if (reminder) {
                    reminder.completed = true;
                    reminder.completedAt = new Date().toISOString();
                    
                    this.completedReminders.push(reminder);
                    this.reminders = this.reminders.filter(r => r.id !== id);
                    
                    this.saveData();
                    this.renderReminders();
                    this.updateStats();
                    
                    // Haptic feedback
                    if (navigator.vibrate) {
                        navigator.vibrate([50, 50, 50]);
                    }
                    
                    this.showNotification('🎉', 'Bravo!', 'Rappel terminé avec succès!');
                }
            }
            
            deleteReminder(id) {
                // Confirmation avant suppression
                if (confirm('Êtes-vous sûr de vouloir supprimer ce rappel ?')) {
                    this.reminders = this.reminders.filter(r => r.id !== id);
                    this.saveData();
                    this.renderReminders();
                    this.updateStats();
                    
                    // Haptic feedback
                    if (navigator.vibrate) {
                        navigator.vibrate(100);
                    }
                    
                    this.showNotification('🗑️', 'Supprimé', 'Rappel supprimé définitivement');
                }
            }
            
            deleteAllReminders() {
                if (confirm('⚠️ ATTENTION ⚠️\n\nVoulez-vous vraiment supprimer TOUS les rappels ?\n\nCette action est irréversible !')) {
                    const count = this.reminders.length;
                    this.reminders = [];
                    this.saveData();
                    this.renderReminders();
                    this.updateStats();
                    
                    // Strong haptic feedback
                    if (navigator.vibrate) {
                        navigator.vibrate([200, 100, 200, 100, 200]);
                    }
                    
                    this.showNotification('🗑️', 'Nettoyage', `${count} rappels supprimés`);
                }
            }
            
            deleteCompletedReminders() {
                if (confirm('Supprimer tous les rappels terminés ?')) {
                    const count = this.completedReminders.length;
                    this.completedReminders = [];
                    localStorage.setItem('mobile_completed', JSON.stringify(this.completedReminders));
                    this.updateStats();
                    
                    this.showNotification('🧹', 'Nettoyé', `${count} rappels terminés supprimés`);
                }
            }
            
            bulkDeleteByCategory(category) {
                if (confirm(`Supprimer tous les rappels de la catégorie "${category}" ?`)) {
                    const initialCount = this.reminders.length;
                    this.reminders = this.reminders.filter(r => r.category !== category);
                    const deletedCount = initialCount - this.reminders.length;
                    
                    this.saveData();
                    this.renderReminders();
                    this.updateStats();
                    
                    this.showNotification('🗂️', 'Catégorie', `${deletedCount} rappels "${category}" supprimés`);
                }
            }
            
            bulkDeleteByPriority(priority) {
                if (confirm(`Supprimer tous les rappels de priorité "${priority}" ?`)) {
                    const initialCount = this.reminders.length;
                    this.reminders = this.reminders.filter(r => r.priority !== priority);
                    const deletedCount = initialCount - this.reminders.length;
                    
                    this.saveData();
                    this.renderReminders();
                    this.updateStats();
                    
                    this.showNotification('⚡', 'Priorité', `${deletedCount} rappels "${priority}" supprimés`);
                }
            }
            
            renderReminders() {
                const container = document.getElementById('remindersList');
                const emptyState = document.getElementById('emptyState');
                
                let displayReminders = [...this.reminders];
                
                // Apply current tab filter
                const today = new Date().toDateString();
                if (this.currentTab === 'today') {
                    displayReminders = displayReminders.filter(r => 
                        new Date(r.date).toDateString() === today
                    );
                }
                
                // Apply search filter
                if (this.currentFilter) {
                    displayReminders = displayReminders.filter(r =>
                        r.text.toLowerCase().includes(this.currentFilter) ||
                        r.location?.toLowerCase().includes(this.currentFilter)
                    );
                }
                
                if (displayReminders.length === 0) {
                    container.innerHTML = '';
                    emptyState.classList.remove('hidden');
                    return;
                }
                
                emptyState.classList.add('hidden');
                
                // Sort by priority and date
                displayReminders.sort((a, b) => {
                    const priorityOrder = { 'urgente': 4, 'haute': 3, 'normale': 2, 'basse': 1 };
                    const priorityDiff = priorityOrder[b.priority] - priorityOrder[a.priority];
                    
                    if (priorityDiff !== 0) return priorityDiff;
                    
                    const dateA = new Date(`${a.date}T${a.time}`);
                    const dateB = new Date(`${b.date}T${b.time}`);
                    return dateA - dateB;
                });
                
                container.innerHTML = displayReminders.map(reminder => {
                    // Obtenir les informations de la catégorie (par défaut ou personnalisée)
                    const allCategories = this.getAllCategories();
                    const categoryInfo = allCategories.find(cat => cat.id === reminder.category) || 
                                       { id: 'tache', name: 'Tâche', icon: '📋', color: 'blue' };
                    
                    const categoryIcons = {
                        'tache': '📋',
                        'rendez-vous': '📅',
                        'priere': '🙏',
                        'messe': '⛪',
                        'appel': '📞',
                        'sante': '🏥',
                        'travail': '💼',
                        'famille': '👨‍👩‍👧‍👦',
                        'sport': '🏃‍♂️'
                    };
                    
                    const priorityClasses = {
                        'urgente': 'priority-urgent',
                        'haute': 'priority-high',
                        'normale': 'priority-normal',
                        'basse': 'priority-low'
                    };
                    
                    const priorityIcons = {
                        'urgente': '🚨',
                        'haute': '🔴',
                        'normale': '🟡',
                        'basse': '🟢'
                    };
                    
                    const reminderDate = new Date(`${reminder.date}T${reminder.time}`);
                    const now = new Date();
                    const isToday = reminderDate.toDateString() === now.toDateString();
                    const timeUntil = this.getTimeUntil(reminderDate);
                    
                    const verse = (reminder.category === 'priere' || reminder.category === 'messe') ? 
                        `<div class="text-xs text-purple-600 italic mt-2 p-2 bg-purple-50 rounded-lg">
                            ${this.christianVerses[Math.floor(Math.random() * this.christianVerses.length)]}
                        </div>` : '';
                    
                    return `
                        <div class="reminder-card category-${reminder.category} ${priorityClasses[reminder.priority]} p-4 relative">
                            <div class="flex items-start space-x-3">
                                <div class="category-icon text-white">
                                    ${categoryInfo.icon}
                                </div>
                                <div class="flex-1 min-w-0">
                                    <div class="font-semibold text-gray-800 text-lg leading-tight mb-1">
                                        ${reminder.text}
                                    </div>
                                    <div class="flex items-center space-x-2 text-sm text-gray-600 mb-2">
                                        <span>${priorityIcons[reminder.priority]}</span>
                                        <span>${this.formatDate(reminder.date)} à ${reminder.time}</span>
                                        ${isToday ? '<span class="px-2 py-1 bg-yellow-100 text-yellow-800 text-xs rounded-full font-medium">Aujourd\'hui</span>' : ''}
                                    </div>
                                    ${timeUntil ? `<div class="text-xs text-blue-600 font-medium time-until" data-reminder-time="${reminder.date}T${reminder.time}" data-target-time="${reminder.date}T${reminder.time}">${timeUntil}</div>` : ''}
                                    ${reminder.location ? `<div class="text-xs text-gray-500 mt-1">📍 ${reminder.location}</div>` : ''}
                                    ${verse}
                                </div>
                            </div>
                            
                            <!-- Swipe Actions -->
                            <div class="swipe-actions px-4">
                                <button onclick="mobileSystem.completeReminder(${reminder.id})" 
                                        class="w-12 h-12 bg-green-500 text-white rounded-full mr-2 haptic">
                                    ✅
                                </button>
                                <button onclick="mobileSystem.deleteReminder(${reminder.id})" 
                                        class="w-12 h-12 bg-red-500 text-white rounded-full haptic">
                                    🗑️
                                </button>
                            </div>
                        </div>
                    `;
                }).join('');
            }
            
            updateStats() {
                const today = new Date().toDateString();
                const todayReminders = this.reminders.filter(r => 
                    new Date(r.date).toDateString() === today
                );
                
                document.getElementById('totalReminders').textContent = this.reminders.length;
                document.getElementById('todayCount').textContent = todayReminders.length;
                document.getElementById('callMeBotSent').textContent = this.messageStats.callMeBotSent;
                document.getElementById('totalSent').textContent = this.messageStats.totalSent;
            }
            
            calculateStreak() {
                // Simple streak calculation
                const today = new Date().toDateString();
                const completedDates = [...new Set(this.completedReminders.map(r => 
                    new Date(r.completedAt).toDateString()
                ))].sort().reverse();
                
                let streak = 0;
                let currentDate = new Date();
                
                for (let date of completedDates) {
                    if (date === currentDate.toDateString()) {
                        streak++;
                        currentDate.setDate(currentDate.getDate() - 1);
                    } else {
                        break;
                    }
                }
                
                return streak;
            }
            
            formatDate(dateString) {
                const date = new Date(dateString);
                const today = new Date();
                const tomorrow = new Date(today);
                tomorrow.setDate(tomorrow.getDate() + 1);
                
                if (date.toDateString() === today.toDateString()) {
                    return 'Aujourd\'hui';
                } else if (date.toDateString() === tomorrow.toDateString()) {
                    return 'Demain';
                } else {
                    return date.toLocaleDateString('fr-FR', { 
                        weekday: 'short', 
                        month: 'short', 
                        day: 'numeric' 
                    });
                }
            }
            
            getTimeUntil(targetDate) {
                const now = new Date();
                const diff = targetDate - now;
                
                if (diff < 0) return null;
                
                const hours = Math.floor(diff / (1000 * 60 * 60));
                const minutes = Math.floor((diff % (1000 * 60 * 60)) / (1000 * 60));
                
                if (hours > 24) {
                    const days = Math.floor(hours / 24);
                    return `Dans ${days} jour${days > 1 ? 's' : ''}`;
                }
                if (hours > 0) return `Dans ${hours}h ${minutes}min`;
                if (minutes > 0) return `Dans ${minutes} minute${minutes > 1 ? 's' : ''}`;
                return 'Maintenant!';
            }
            
            startNotificationChecker() {
                // Vérification principale toutes les 30 secondes
                setInterval(() => {
                    this.checkForNotifications();
                }, 30000);
                
                // Vérification immédiate au démarrage
                this.checkForNotifications();
                
                // ACTUALISATION ULTRA-RAPIDE TOUTES LES 10ms
                this.startUltraFastRefresh();
                
                // SYSTÈME D'ARRIÈRE-PLAN AVANCÉ
                this.initBackgroundSystem();
            }
            
            startUltraFastRefresh() {
                console.log('🚀 DÉMARRAGE ACTUALISATION ULTRA-RAPIDE 10ms');
                
                // Compteur d'actualisations pour debug
                this.refreshCount = 0;
                this.startTime = Date.now();
                
                // Actualisation toutes les 10ms (100 fois par seconde)
                setInterval(() => {
                    this.ultraFastRefresh();
                    this.refreshCount++;
                }, 10);
                
                // Actualisation plus complète toutes les 100ms
                setInterval(() => {
                    this.mediumRefresh();
                }, 100);
                
                // Actualisation complète toutes les 1000ms
                setInterval(() => {
                    this.fullRefresh();
                }, 1000);
                
                // Mise à jour du compteur d'actualisation toutes les 5 secondes
                setInterval(() => {
                    this.updateRefreshStats();
                }, 5000);
            }
            
            updateRefreshStats() {
                const elapsed = (Date.now() - this.startTime) / 1000;
                const refreshRate = Math.round(this.refreshCount / elapsed);
                
                const statusEl = document.getElementById('refreshStatus');
                if (statusEl) {
                    statusEl.innerHTML = `🔄 ${this.refreshCount} actualisations (${refreshRate}/sec) - Ultra-rapide 10ms actif`;
                }
                
                console.log(`📊 Stats actualisation: ${this.refreshCount} total, ${refreshRate}/sec`);
            }
            
            ultraFastRefresh() {
                // Actualisation ultra-rapide des éléments critiques
                this.updateRealTimeElements();
                this.checkUrgentNotifications();
                this.updateLiveCounters();
            }
            
            mediumRefresh() {
                // Actualisation moyenne des statistiques
                this.updateStats();
                this.updateTimeDisplays();
                this.checkPendingActions();
            }
            
            fullRefresh() {
                // Actualisation complète
                this.renderReminders();
                this.generateAISuggestions();
                this.updateConnectionStatus();
                this.syncWithStorage();
                
                // Log pour debug
                console.log('🔄 Actualisation complète effectuée');
            }
            
            updateRealTimeElements() {
                // Mise à jour des éléments en temps réel
                const now = new Date();
                
                // Mettre à jour l'heure actuelle partout
                document.querySelectorAll('.current-time').forEach(el => {
                    el.textContent = now.toLocaleTimeString('fr-FR');
                });
                
                // Mettre à jour les compteurs de temps restant
                document.querySelectorAll('.time-until').forEach(el => {
                    const targetTime = el.dataset.targetTime;
                    if (targetTime) {
                        const timeUntil = this.getTimeUntil(new Date(targetTime));
                        el.textContent = timeUntil || 'Maintenant!';
                    }
                });
            }
            
            checkUrgentNotifications() {
                // Vérification ultra-rapide des notifications urgentes
                const now = new Date();
                
                this.reminders.forEach(reminder => {
                    if (reminder.priority === 'urgente' && !reminder.notified && !reminder.completed) {
                        const reminderTime = new Date(`${reminder.date}T${reminder.time}`);
                        const timeDiff = reminderTime - now;
                        
                        // Notification 10 secondes avant pour les urgents
                        if (timeDiff <= 10000 && timeDiff >= 9990) {
                            this.showNotification('🚨', 'URGENT DANS 10s!', reminder.text);
                            
                            // Vibration d'urgence
                            if (navigator.vibrate) {
                                navigator.vibrate([200, 100, 200, 100, 200, 100, 200]);
                            }
                        }
                    }
                });
            }
            
            updateLiveCounters() {
                // Mise à jour des compteurs en direct
                const activeCount = this.reminders.filter(r => !r.completed).length;
                const todayCount = this.reminders.filter(r => {
                    const today = new Date().toDateString();
                    return new Date(r.date).toDateString() === today;
                }).length;
                
                // Mise à jour fluide des compteurs
                this.animateCounter('totalReminders', activeCount);
                this.animateCounter('todayCount', todayCount);
                
                // Mise à jour du monitoring arrière-plan
                this.updateBackgroundMonitoring();
            }
            
            updateBackgroundMonitoring() {
                if (!this.backgroundStats) return;
                
                // Mettre à jour les compteurs d'arrière-plan
                const checksEl = document.getElementById('backgroundChecks');
                const queueEl = document.getElementById('backgroundQueue');
                const successEl = document.getElementById('backgroundSuccess');
                const failsEl = document.getElementById('backgroundFails');
                const statusEl = document.getElementById('backgroundStatus');
                
                if (checksEl) checksEl.textContent = this.backgroundStats.totalChecks;
                if (queueEl) queueEl.textContent = this.backgroundQueue.pendingNotifications.length + this.backgroundQueue.retryQueue.length;
                if (successEl) successEl.textContent = this.backgroundStats.successfulSends;
                if (failsEl) failsEl.textContent = this.backgroundStats.failedSends;
                
                // Statut des workers
                if (statusEl) {
                    const activeWorkers = Object.values(this.backgroundWorkers).filter(w => w !== null).length;
                    const totalWorkers = 4;
                    
                    if (activeWorkers === totalWorkers) {
                        statusEl.innerHTML = '🟢 Tous les workers actifs';
                        statusEl.className = 'mt-1 text-xs text-green-300';
                    } else if (activeWorkers > 0) {
                        statusEl.innerHTML = `🟡 ${activeWorkers}/${totalWorkers} workers actifs`;
                        statusEl.className = 'mt-1 text-xs text-yellow-300';
                    } else {
                        statusEl.innerHTML = '🔴 Système arrêté';
                        statusEl.className = 'mt-1 text-xs text-red-300';
                    }
                }
            }
            
            animateCounter(elementId, targetValue) {
                const element = document.getElementById(elementId);
                if (!element) return;
                
                const currentValue = parseInt(element.textContent) || 0;
                
                if (currentValue !== targetValue) {
                    // Animation fluide du compteur
                    const diff = targetValue - currentValue;
                    const step = diff > 0 ? 1 : -1;
                    const newValue = currentValue + step;
                    
                    element.textContent = newValue;
                    
                    // Effet visuel de changement
                    element.style.transform = 'scale(1.1)';
                    element.style.color = '#6366f1';
                    
                    setTimeout(() => {
                        element.style.transform = 'scale(1)';
                        element.style.color = '';
                    }, 50);
                }
            }
            
            updateTimeDisplays() {
                // Mise à jour des affichages de temps
                const now = new Date();
                
                // Mettre à jour tous les éléments avec des temps relatifs
                document.querySelectorAll('[data-reminder-time]').forEach(el => {
                    const reminderTime = new Date(el.dataset.reminderTime);
                    const timeUntil = this.getTimeUntil(reminderTime);
                    
                    if (timeUntil) {
                        el.textContent = timeUntil;
                        
                        // Changer la couleur selon l'urgence
                        const timeDiff = reminderTime - now;
                        if (timeDiff < 300000) { // Moins de 5 minutes
                            el.style.color = '#ef4444';
                            el.style.fontWeight = 'bold';
                        } else if (timeDiff < 3600000) { // Moins d'1 heure
                            el.style.color = '#f97316';
                        } else {
                            el.style.color = '#3b82f6';
                        }
                    }
                });
            }
            
            checkPendingActions() {
                // Vérifier les actions en attente
                this.reminders.forEach(reminder => {
                    if (!reminder.processed) {
                        // Marquer comme traité pour éviter les doublons
                        reminder.processed = true;
                        
                        // Traitement en arrière-plan
                        this.processReminderBackground(reminder);
                    }
                });
            }
            
            processReminderBackground(reminder) {
                // Traitement en arrière-plan des rappels
                const now = new Date();
                const reminderTime = new Date(`${reminder.date}T${reminder.time}`);
                
                // Pré-chargement des notifications
                if (reminderTime - now < 60000 && !reminder.preloaded) {
                    reminder.preloaded = true;
                    console.log(`📋 Pré-chargement: ${reminder.text}`);
                }
            }
            
            syncWithStorage() {
                // Synchronisation avec le stockage local
                try {
                    const storedReminders = JSON.parse(localStorage.getItem('mobile_reminders')) || [];
                    const storedCompleted = JSON.parse(localStorage.getItem('mobile_completed')) || [];
                    
                    // Vérifier s'il y a des changements
                    if (JSON.stringify(storedReminders) !== JSON.stringify(this.reminders)) {
                        console.log('🔄 Synchronisation détectée - Rechargement des données');
                        this.reminders = storedReminders;
                        this.renderReminders();
                    }
                    
                    if (JSON.stringify(storedCompleted) !== JSON.stringify(this.completedReminders)) {
                        this.completedReminders = storedCompleted;
                    }
                } catch (error) {
                    console.error('Erreur de synchronisation:', error);
                }
            }
            
            // === SYSTÈME D'ARRIÈRE-PLAN AVANCÉ ===
            
            initBackgroundSystem() {
                console.log('🚀 INITIALISATION SYSTÈME ARRIÈRE-PLAN AVANCÉ');
                
                // Variables pour le système d'arrière-plan
                this.backgroundWorkers = {
                    notificationChecker: null,
                    callMeBotSender: null,
                    reminderProcessor: null,
                    emergencyHandler: null
                };
                
                this.backgroundQueue = {
                    pendingNotifications: [],
                    failedSends: [],
                    retryQueue: []
                };
                
                this.backgroundStats = {
                    totalChecks: 0,
                    successfulSends: 0,
                    failedSends: 0,
                    lastActivity: Date.now()
                };
                
                // Démarrer les workers d'arrière-plan
                this.startBackgroundWorkers();
                
                // Système de persistance pour l'arrière-plan
                this.initBackgroundPersistence();
                
                // Gestionnaire de visibilité de page
                this.initVisibilityHandler();
                
                // Système de récupération après crash
                this.initCrashRecovery();
                
                console.log('✅ Système d\'arrière-plan initialisé avec succès');
            }
            
            startBackgroundWorkers() {
                console.log('⚡ Démarrage des workers d\'arrière-plan...');
                
                // Worker 1: Vérificateur de notifications (toutes les 5 secondes)
                this.backgroundWorkers.notificationChecker = setInterval(() => {
                    this.backgroundNotificationCheck();
                }, 5000);
                
                // Worker 2: Envoyeur CallMeBot (toutes les 3 secondes)
                this.backgroundWorkers.callMeBotSender = setInterval(() => {
                    this.backgroundCallMeBotSender();
                }, 3000);
                
                // Worker 3: Processeur de rappels (toutes les 10 secondes)
                this.backgroundWorkers.reminderProcessor = setInterval(() => {
                    this.backgroundReminderProcessor();
                }, 10000);
                
                // Worker 4: Gestionnaire d'urgence (toutes les 1 seconde)
                this.backgroundWorkers.emergencyHandler = setInterval(() => {
                    this.backgroundEmergencyHandler();
                }, 1000);
                
                console.log('✅ Tous les workers d\'arrière-plan sont actifs');
            }
            
            backgroundNotificationCheck() {
                this.backgroundStats.totalChecks++;
                const now = new Date();
                
                console.log(`🔍 [${now.toLocaleTimeString()}] Vérification arrière-plan #${this.backgroundStats.totalChecks}`);
                
                this.reminders.forEach(reminder => {
                    if (reminder.notified || reminder.completed) return;
                    
                    const reminderTime = new Date(`${reminder.date}T${reminder.time}`);
                    const timeDiff = reminderTime - now;
                    
                    // Ajouter à la queue si c'est le moment
                    if (timeDiff <= 60000 && timeDiff >= -30000) { // 1 minute avant à 30 secondes après
                        if (!this.backgroundQueue.pendingNotifications.find(p => p.id === reminder.id)) {
                            this.backgroundQueue.pendingNotifications.push({
                                ...reminder,
                                queuedAt: now.toISOString(),
                                attempts: 0
                            });
                            
                            console.log(`📋 Rappel ajouté à la queue: ${reminder.text}`);
                        }
                    }
                });
                
                this.backgroundStats.lastActivity = Date.now();
            }
            
            backgroundCallMeBotSender() {
                if (this.backgroundQueue.pendingNotifications.length === 0) return;
                
                const now = new Date();
                console.log(`📲 [${now.toLocaleTimeString()}] Traitement queue CallMeBot (${this.backgroundQueue.pendingNotifications.length} en attente)`);
                
                // Traiter le premier élément de la queue
                const notification = this.backgroundQueue.pendingNotifications[0];
                
                if (notification) {
                    this.processBackgroundNotification(notification);
                }
            }
            
            async processBackgroundNotification(notification) {
                const now = new Date();
                const reminderTime = new Date(`${notification.date}T${notification.time}`);
                const timeDiff = reminderTime - now;
                
                console.log(`⚡ Traitement: ${notification.text} (dans ${Math.round(timeDiff/1000)}s)`);
                
                // Vérifier si c'est vraiment le moment d'envoyer
                if (timeDiff <= 30000 && timeDiff >= -30000) { // 30 secondes avant/après
                    try {
                        // Marquer comme notifié immédiatement pour éviter les doublons
                        const originalReminder = this.reminders.find(r => r.id === notification.id);
                        if (originalReminder && !originalReminder.notified) {
                            originalReminder.notified = true;
                            originalReminder.notifiedAt = now.toISOString();
                            
                            // Envoyer la notification
                            await this.sendBackgroundNotification(notification);
                            
                            // Retirer de la queue
                            this.backgroundQueue.pendingNotifications = this.backgroundQueue.pendingNotifications.filter(p => p.id !== notification.id);
                            
                            // Sauvegarder
                            this.saveData();
                            this.updateStats();
                            
                            console.log(`✅ Notification envoyée avec succès: ${notification.text}`);
                            this.backgroundStats.successfulSends++;
                        }
                    } catch (error) {
                        console.error(`❌ Erreur envoi notification:`, error);
                        
                        notification.attempts = (notification.attempts || 0) + 1;
                        notification.lastError = error.message;
                        notification.lastAttempt = now.toISOString();
                        
                        if (notification.attempts >= 3) {
                            // Échec définitif après 3 tentatives
                            this.backgroundQueue.failedSends.push(notification);
                            this.backgroundQueue.pendingNotifications = this.backgroundQueue.pendingNotifications.filter(p => p.id !== notification.id);
                            
                            console.log(`💀 Échec définitif après 3 tentatives: ${notification.text}`);
                            this.backgroundStats.failedSends++;
                        } else {
                            // Programmer une nouvelle tentative
                            this.backgroundQueue.retryQueue.push({
                                ...notification,
                                retryAt: now.getTime() + (notification.attempts * 30000) // Retry après 30s, 60s, 90s
                            });
                            
                            this.backgroundQueue.pendingNotifications = this.backgroundQueue.pendingNotifications.filter(p => p.id !== notification.id);
                            
                            console.log(`🔄 Tentative ${notification.attempts}/3 échouée, retry programmé: ${notification.text}`);
                        }
                    }
                } else if (timeDiff > 30000) {
                    console.log(`⏰ Trop tôt pour: ${notification.text} (dans ${Math.round(timeDiff/1000)}s)`);
                } else {
                    console.log(`⏰ Trop tard pour: ${notification.text} (il y a ${Math.abs(Math.round(timeDiff/1000))}s)`);
                    // Retirer de la queue si trop tard
                    this.backgroundQueue.pendingNotifications = this.backgroundQueue.pendingNotifications.filter(p => p.id !== notification.id);
                }
            }
            
            async sendBackgroundNotification(reminder) {
                const priorityEmojis = {
                    'urgente': '🚨',
                    'haute': '🔴',
                    'normale': '🟡',
                    'basse': '🟢'
                };
                
                let message = `🔔 RAPPEL MAINTENANT!\n${priorityEmojis[reminder.priority]} ${reminder.text}`;
                if (reminder.location) {
                    message += `\n📍 ${reminder.location}`;
                }
                
                console.log(`📤 Envoi notification pour: ${reminder.text}`);
                
                // Notification navigateur (toujours)
                if (this.settings.notifyBrowser) {
                    this.showNotification('🔔', 'RAPPEL MAINTENANT!', message);
                    
                    if ('Notification' in window && Notification.permission === 'granted') {
                        new Notification('ABM Reminder - RAPPEL!', {
                            body: message,
                            icon: '⚡',
                            tag: `reminder-${reminder.id}`,
                            requireInteraction: reminder.priority === 'urgente',
                            silent: false
                        });
                    }
                }
                
                // CallMeBot (si configuré)
                if (this.settings.notifyCallMeBot && this.settings.enableCallMeBot && this.settings.callMeBotNumber && this.settings.callMeBotApiKey) {
                    await this.sendBackgroundCallMeBot(reminder);
                }
                
                // Vibration selon priorité
                if (navigator.vibrate) {
                    const patterns = {
                        'urgente': [200, 100, 200, 100, 200, 100, 200],
                        'haute': [200, 100, 200, 100, 200],
                        'normale': [200, 100, 200],
                        'basse': [100]
                    };
                    navigator.vibrate(patterns[reminder.priority] || [200]);
                }
                
                // Son d'alerte (si possible)
                try {
                    const audioContext = new (window.AudioContext || window.webkitAudioContext)();
                    const oscillator = audioContext.createOscillator();
                    const gainNode = audioContext.createGain();
                    
                    oscillator.connect(gainNode);
                    gainNode.connect(audioContext.destination);
                    
                    oscillator.frequency.setValueAtTime(800, audioContext.currentTime);
                    gainNode.gain.setValueAtTime(0.1, audioContext.currentTime);
                    
                    oscillator.start();
                    oscillator.stop(audioContext.currentTime + 0.2);
                } catch (error) {
                    console.log('Son d\'alerte non disponible');
                }
            }
            
            async sendBackgroundCallMeBot(reminder) {
                try {
                    console.log(`📲 Envoi CallMeBot pour: ${reminder.text}`);
                    
                    const message = this.settings.callMeBotTemplate
                        .replace('{titre}', reminder.text)
                        .replace('{heure}', `${this.formatDate(reminder.date)} à ${reminder.time}`)
                        .replace('{lieu}', reminder.location || 'Non spécifié');
                    
                    const phoneNumber = this.settings.callMeBotNumber.replace(/\D/g, '');
                    const apiKey = this.settings.callMeBotApiKey;
                    const encodedMessage = encodeURIComponent(message);
                    
                    const callMeBotUrl = `https://api.callmebot.com/whatsapp.php?phone=${phoneNumber}&text=${encodedMessage}&apikey=${apiKey}`;
                    
                    console.log('📲 CallMeBot URL:', callMeBotUrl);
                    
                    // Méthode robuste avec fetch + fallback image
                    let success = false;
                    
                    try {
                        // Tentative avec fetch (mode no-cors)
                        const response = await fetch(callMeBotUrl, {
                            method: 'GET',
                            mode: 'no-cors'
                        });
                        success = true;
                        console.log('✅ CallMeBot: Envoi via fetch réussi');
                    } catch (fetchError) {
                        console.log('⚠️ CallMeBot: Fetch échoué, tentative avec image...');
                        
                        // Fallback avec image
                        const img = new Image();
                        await new Promise((resolve, reject) => {
                            img.onload = () => {
                                success = true;
                                resolve();
                            };
                            img.onerror = () => {
                                success = true; // Considérer comme succès car l'erreur CORS est normale
                                resolve();
                            };
                            img.src = callMeBotUrl;
                            
                            // Timeout après 10 secondes
                            setTimeout(() => {
                                success = true;
                                resolve();
                            }, 10000);
                        });
                    }
                    
                    if (success) {
                        // Marquer comme envoyé via CallMeBot
                        const originalReminder = this.reminders.find(r => r.id === reminder.id);
                        if (originalReminder) {
                            originalReminder.sentVia = 'callmebot';
                            originalReminder.sentAt = new Date().toISOString();
                        }
                        
                        // Mettre à jour les stats
                        this.messageStats.callMeBotSent++;
                        this.messageStats.totalSent++;
                        this.saveMessageStats();
                        
                        console.log('✅ CallMeBot: Message envoyé avec succès');
                        this.showNotification('📲', 'CallMeBot', 'Message envoyé sur WhatsApp!');
                    }
                    
                } catch (error) {
                    console.error('❌ CallMeBot: Erreur d\'envoi:', error);
                    throw error;
                }
            }
            
            backgroundReminderProcessor() {
                const now = new Date();
                
                // Traiter la queue de retry
                this.backgroundQueue.retryQueue = this.backgroundQueue.retryQueue.filter(item => {
                    if (now.getTime() >= item.retryAt) {
                        console.log(`🔄 Retry: ${item.text}`);
                        this.backgroundQueue.pendingNotifications.push(item);
                        return false; // Retirer de la retry queue
                    }
                    return true; // Garder dans la retry queue
                });
                
                // Nettoyer les anciennes notifications échouées (plus de 24h)
                const oneDayAgo = now.getTime() - (24 * 60 * 60 * 1000);
                this.backgroundQueue.failedSends = this.backgroundQueue.failedSends.filter(item => {
                    const itemTime = new Date(item.queuedAt).getTime();
                    return itemTime > oneDayAgo;
                });
                
                // Pré-charger les prochains rappels (dans les 5 minutes)
                const fiveMinutesFromNow = new Date(now.getTime() + 5 * 60 * 1000);
                this.reminders.forEach(reminder => {
                    if (!reminder.notified && !reminder.completed) {
                        const reminderTime = new Date(`${reminder.date}T${reminder.time}`);
                        if (reminderTime <= fiveMinutesFromNow && reminderTime > now) {
                            if (!reminder.preloaded) {
                                reminder.preloaded = true;
                                console.log(`📋 Pré-chargement: ${reminder.text} (dans ${Math.round((reminderTime - now) / 60000)} min)`);
                            }
                        }
                    }
                });
                
                // Log des stats périodiques
                if (this.backgroundStats.totalChecks % 20 === 0) {
                    console.log(`📊 Stats arrière-plan: ${this.backgroundStats.totalChecks} vérifications, ${this.backgroundStats.successfulSends} envois réussis, ${this.backgroundStats.failedSends} échecs`);
                    console.log(`📋 Queues: ${this.backgroundQueue.pendingNotifications.length} en attente, ${this.backgroundQueue.retryQueue.length} retry, ${this.backgroundQueue.failedSends.length} échecs`);
                }
            }
            
            backgroundEmergencyHandler() {
                const now = new Date();
                
                // Vérifier les rappels urgents dans les 30 prochaines secondes
                this.reminders.forEach(reminder => {
                    if (reminder.priority === 'urgente' && !reminder.notified && !reminder.completed) {
                        const reminderTime = new Date(`${reminder.date}T${reminder.time}`);
                        const timeDiff = reminderTime - now;
                        
                        // Alerte 30 secondes avant pour les urgents
                        if (timeDiff <= 30000 && timeDiff >= 29000) {
                            console.log(`🚨 URGENCE dans 30s: ${reminder.text}`);
                            
                            this.showNotification('🚨', 'URGENT dans 30s!', reminder.text);
                            
                            // Vibration d'urgence
                            if (navigator.vibrate) {
                                navigator.vibrate([100, 50, 100, 50, 100, 50, 200]);
                            }
                            
                            // Ajouter immédiatement à la queue prioritaire
                            if (!this.backgroundQueue.pendingNotifications.find(p => p.id === reminder.id)) {
                                this.backgroundQueue.pendingNotifications.unshift({ // unshift = priorité
                                    ...reminder,
                                    queuedAt: now.toISOString(),
                                    attempts: 0,
                                    priority: 'emergency'
                                });
                            }
                        }
                    }
                });
            }
            
            initBackgroundPersistence() {
                // Sauvegarder l'état d'arrière-plan périodiquement
                setInterval(() => {
                    const backgroundState = {
                        queue: this.backgroundQueue,
                        stats: this.backgroundStats,
                        lastSave: new Date().toISOString()
                    };
                    
                    localStorage.setItem('mobile_background_state', JSON.stringify(backgroundState));
                }, 30000); // Sauvegarder toutes les 30 secondes
                
                // Restaurer l'état au démarrage
                try {
                    const savedState = localStorage.getItem('mobile_background_state');
                    if (savedState) {
                        const state = JSON.parse(savedState);
                        
                        // Restaurer les queues (mais pas les stats pour éviter la confusion)
                        if (state.queue) {
                            this.backgroundQueue = {
                                ...this.backgroundQueue,
                                ...state.queue
                            };
                        }
                        
                        console.log('🔄 État d\'arrière-plan restauré');
                    }
                } catch (error) {
                    console.error('Erreur restauration état arrière-plan:', error);
                }
            }
            
            initVisibilityHandler() {
                // Gérer la visibilité de la page pour optimiser les performances
                document.addEventListener('visibilitychange', () => {
                    if (document.hidden) {
                        console.log('📱 Page cachée - Mode arrière-plan activé');
                        this.isInBackground = true;
                        
                        // Réduire la fréquence des vérifications non critiques
                        this.adjustBackgroundFrequency(true);
                    } else {
                        console.log('📱 Page visible - Mode normal activé');
                        this.isInBackground = false;
                        
                        // Restaurer la fréquence normale
                        this.adjustBackgroundFrequency(false);
                        
                        // Vérification immédiate au retour
                        this.checkForNotifications();
                        this.renderReminders();
                        this.updateStats();
                    }
                });
            }
            
            adjustBackgroundFrequency(isBackground) {
                if (isBackground) {
                    // En arrière-plan: réduire les vérifications non critiques
                    console.log('⚡ Optimisation arrière-plan: fréquence réduite');
                } else {
                    // Au premier plan: fréquence normale
                    console.log('⚡ Mode normal: fréquence standard');
                }
            }
            
            initCrashRecovery() {
                // Système de récupération après crash/fermeture
                window.addEventListener('beforeunload', () => {
                    // Sauvegarder l'état critique avant fermeture
                    const criticalState = {
                        pendingNotifications: this.backgroundQueue.pendingNotifications,
                        timestamp: Date.now()
                    };
                    
                    localStorage.setItem('mobile_crash_recovery', JSON.stringify(criticalState));
                });
                
                // Vérifier s'il y a une récupération à faire au démarrage
                try {
                    const recoveryData = localStorage.getItem('mobile_crash_recovery');
                    if (recoveryData) {
                        const recovery = JSON.parse(recoveryData);
                        const timeSinceCrash = Date.now() - recovery.timestamp;
                        
                        // Si moins de 10 minutes, récupérer les notifications en attente
                        if (timeSinceCrash < 10 * 60 * 1000 && recovery.pendingNotifications) {
                            this.backgroundQueue.pendingNotifications = recovery.pendingNotifications;
                            console.log(`🔄 Récupération après crash: ${recovery.pendingNotifications.length} notifications restaurées`);
                            
                            this.showNotification('🔄', 'Récupération', 'Notifications restaurées après redémarrage');
                        }
                        
                        // Nettoyer les données de récupération
                        localStorage.removeItem('mobile_crash_recovery');
                    }
                } catch (error) {
                    console.error('Erreur récupération crash:', error);
                }
            }
            
            // Méthode pour obtenir les stats d'arrière-plan
            getBackgroundStats() {
                return {
                    ...this.backgroundStats,
                    queueSizes: {
                        pending: this.backgroundQueue.pendingNotifications.length,
                        retry: this.backgroundQueue.retryQueue.length,
                        failed: this.backgroundQueue.failedSends.length
                    },
                    isActive: Object.values(this.backgroundWorkers).every(worker => worker !== null)
                };
            }
            
            // Méthode pour arrêter le système d'arrière-plan
            stopBackgroundSystem() {
                console.log('🛑 Arrêt du système d\'arrière-plan');
                
                Object.values(this.backgroundWorkers).forEach(worker => {
                    if (worker) {
                        clearInterval(worker);
                    }
                });
                
                this.backgroundWorkers = {
                    notificationChecker: null,
                    callMeBotSender: null,
                    reminderProcessor: null,
                    emergencyHandler: null
                };
            }
            
            checkForNotifications() {
                const now = new Date();
                
                this.reminders.forEach(reminder => {
                    if (reminder.notified || reminder.completed) return;
                    
                    const reminderTime = new Date(`${reminder.date}T${reminder.time}`);
                    const timeDiff = reminderTime - now;
                    
                    // Notify exactly at the scheduled time (within 1 minute window)
                    if (timeDiff <= 60 * 1000 && timeDiff >= -60 * 1000) {
                        this.sendNotification(reminder);
                        reminder.notified = true;
                        this.saveData();
                    }
                });
            }
            
            async sendNotification(reminder) {
                const priorityEmojis = {
                    'urgente': '🚨',
                    'haute': '🔴',
                    'normale': '🟡',
                    'basse': '🟢'
                };
                
                let message = `🔔 RAPPEL MAINTENANT!\n${priorityEmojis[reminder.priority]} ${reminder.text}`;
                if (reminder.location) {
                    message += `\n📍 ${reminder.location}`;
                }
                
                // Browser notification (always show)
                if (this.settings.notifyBrowser) {
                    this.showNotification('🔔', 'RAPPEL MAINTENANT!', message);
                    
                    if ('Notification' in window && Notification.permission === 'granted') {
                        new Notification('ABM Reminder', {
                            body: message,
                            icon: '⚡',
                            tag: `reminder-${reminder.id}`,
                            requireInteraction: reminder.priority === 'urgente'
                        });
                    }
                    
                    // Marquer comme envoyé via navigateur si pas d'autre mode
                    if (!this.settings.notifyCallMeBot || !this.settings.enableCallMeBot) {
                        reminder.sentVia = 'browser';
                        reminder.sentAt = new Date().toISOString();
                    }
                }
                
                // CallMeBot notification
                if (this.settings.notifyCallMeBot && this.settings.enableCallMeBot) {
                    await this.sendCallMeBotMessage(reminder);
                }
                
                // Vibration pattern based on priority
                if (navigator.vibrate) {
                    const patterns = {
                        'urgente': [200, 100, 200, 100, 200],
                        'haute': [200, 100, 200],
                        'normale': [200],
                        'basse': [100]
                    };
                    navigator.vibrate(patterns[reminder.priority] || [200]);
                }
            }
            
            async sendCallMeBotMessage(reminder) {
                try {
                    if (!this.settings.callMeBotNumber || !this.settings.callMeBotApiKey) {
                        throw new Error('CallMeBot non configuré');
                    }
                    
                    // Utiliser le bon template CallMeBot
                    const message = this.settings.callMeBotTemplate
                        .replace('{titre}', reminder.text)
                        .replace('{heure}', `${this.formatDate(reminder.date)} à ${reminder.time}`)
                        .replace('{lieu}', reminder.location || 'Non spécifié');
                    
                    // API CallMeBot WhatsApp - Format correct
                    const phoneNumber = this.settings.callMeBotNumber.replace(/\D/g, '');
                    const apiKey = this.settings.callMeBotApiKey;
                    const encodedMessage = encodeURIComponent(message);
                    
                    const callMeBotUrl = `https://api.callmebot.com/whatsapp.php?phone=${phoneNumber}&text=${encodedMessage}&apikey=${apiKey}`;
                    
                    console.log('📲 CallMeBot URL:', callMeBotUrl);
                    console.log('📲 Message à envoyer:', message);
                    
                    // Utiliser une image invisible pour déclencher l'appel API
                    const img = new Image();
                    img.onload = () => {
                        console.log('✅ CallMeBot: Requête envoyée avec succès');
                        this.messageStats.callMeBotSent++;
                        this.messageStats.totalSent++;
                        this.saveMessageStats();
                        this.updateStats();
                        
                        // Marquer le rappel comme envoyé via CallMeBot
                        reminder.sentVia = 'callmebot';
                        reminder.sentAt = new Date().toISOString();
                        this.saveData();
                        
                        this.showNotification('📲', 'CallMeBot', 'Message envoyé sur WhatsApp!');
                    };
                    img.onerror = () => {
                        console.log('✅ CallMeBot: Requête traitée (normal avec no-cors)');
                        this.messageStats.callMeBotSent++;
                        this.messageStats.totalSent++;
                        this.saveMessageStats();
                        this.updateStats();
                        
                        // Marquer le rappel comme envoyé via CallMeBot
                        reminder.sentVia = 'callmebot';
                        reminder.sentAt = new Date().toISOString();
                        this.saveData();
                        
                        this.showNotification('📲', 'CallMeBot', 'Message envoyé sur WhatsApp!');
                    };
                    img.src = callMeBotUrl;
                    
                } catch (error) {
                    console.error('CallMeBot send error:', error);
                    this.showNotification('❌', 'CallMeBot', 'Erreur envoi CallMeBot: ' + error.message);
                }
            }

            async sendWhatsAppMessage(reminder) {
                try {
                    const message = this.settings.whatsappTemplate
                        .replace('{titre}', reminder.text)
                        .replace('{heure}', `${this.formatDate(reminder.date)} à ${reminder.time}`)
                        .replace('{lieu}', reminder.location || 'Non spécifié');
                    
                    // VRAIE INTÉGRATION WHATSAPP - Plusieurs méthodes disponibles
                    let success = false;
                    
                    // Méthode 1: WhatsApp Web API (le plus simple)
                    if (this.settings.whatsappMethod === 'web') {
                        const encodedMessage = encodeURIComponent(message);
                        const whatsappUrl = `https://wa.me/${this.settings.whatsappNumber.replace(/\D/g, '')}?text=${encodedMessage}`;
                        
                        // Ouvre WhatsApp automatiquement
                        window.open(whatsappUrl, '_blank');
                        success = true;
                    }
                    
                    // Méthode 2: WhatsApp Business API (pour les entreprises)
                    else if (this.settings.whatsappMethod === 'business' && this.settings.whatsappToken) {
                        const response = await fetch('https://graph.facebook.com/v17.0/YOUR_PHONE_NUMBER_ID/messages', {
                            method: 'POST',
                            headers: {
                                'Authorization': `Bearer ${this.settings.whatsappToken}`,
                                'Content-Type': 'application/json'
                            },
                            body: JSON.stringify({
                                messaging_product: "whatsapp",
                                to: this.settings.whatsappNumber.replace(/\D/g, ''),
                                type: "text",
                                text: { body: message }
                            })
                        });
                        
                        if (response.ok) {
                            success = true;
                        }
                    }
                    
                    // Méthode 3: Service tiers (Twilio, etc.)
                    else if (this.settings.whatsappMethod === 'twilio' && this.settings.twilioSid && this.settings.twilioToken) {
                        const response = await fetch(`https://api.twilio.com/2010-04-01/Accounts/${this.settings.twilioSid}/Messages.json`, {
                            method: 'POST',
                            headers: {
                                'Authorization': 'Basic ' + btoa(`${this.settings.twilioSid}:${this.settings.twilioToken}`),
                                'Content-Type': 'application/x-www-form-urlencoded'
                            },
                            body: new URLSearchParams({
                                From: `whatsapp:${this.settings.twilioNumber}`,
                                To: `whatsapp:${this.settings.whatsappNumber}`,
                                Body: message
                            })
                        });
                        
                        if (response.ok) {
                            success = true;
                        }
                    }
                    
                    if (success) {
                        // Increment counter
                        this.messageStats.whatsappSent++;
                        this.messageStats.totalSent++;
                        this.saveMessageStats();
                        this.updateStats();
                        
                        this.showNotification('📱', 'WhatsApp', 'Rappel envoyé sur WhatsApp');
                    } else {
                        throw new Error('Aucune méthode WhatsApp configurée');
                    }
                    
                } catch (error) {
                    console.error('WhatsApp send error:', error);
                    this.showNotification('❌', 'WhatsApp', 'Erreur envoi WhatsApp');
                }
            }
            
            async sendCallBotMessage(reminder) {
                try {
                    const message = this.settings.callTemplate
                        .replace('{titre}', reminder.text)
                        .replace('{heure}', `${this.formatDate(reminder.date)} à ${reminder.time}`);
                    
                    // Here you would make the actual Call Bot API call
                    // Example API call structure:
                    /*
                    const response = await fetch('https://api.callbot.com/call', {
                        method: 'POST',
                        headers: {
                            'Authorization': `Bearer ${this.settings.callBotApiKey}`,
                            'Content-Type': 'application/json'
                        },
                        body: JSON.stringify({
                            to: this.settings.callBotNumber,
                            message: message,
                            voice: this.settings.botVoice
                        })
                    });
                    */
                    
                    // For demo purposes, we simulate success
                    console.log('Call Bot message would be sent:', message);
                    
                    // Increment counter
                    this.messageStats.callsSent++;
                    this.messageStats.totalSent++;
                    this.saveMessageStats();
                    this.updateStats();
                    
                    this.showNotification('📞', 'Call Bot', 'Appel automatique lancé');
                    
                } catch (error) {
                    console.error('Call Bot send error:', error);
                    this.showNotification('❌', 'Call Bot', 'Erreur appel automatique');
                }
            }
            
            showNotification(icon, title, message) {
                const notification = document.getElementById('notification');
                const iconEl = document.getElementById('notificationIcon');
                const titleEl = document.getElementById('notificationTitle');
                const messageEl = document.getElementById('notificationMessage');
                
                iconEl.textContent = icon;
                titleEl.textContent = title;
                messageEl.textContent = message;
                
                notification.classList.add('show');
                
                setTimeout(() => {
                    notification.classList.remove('show');
                }, 4000);
            }
            
            hideNotification() {
                document.getElementById('notification').classList.remove('show');
            }
            
            clearForm() {
                document.getElementById('reminderForm').reset();
                this.setDefaultDateTime();
            }
            
            saveData() {
                localStorage.setItem('mobile_reminders', JSON.stringify(this.reminders));
                localStorage.setItem('mobile_completed', JSON.stringify(this.completedReminders));
            }
            
            saveMessageStats() {
                localStorage.setItem('mobile_message_stats', JSON.stringify(this.messageStats));
            }
            
            // === GESTION DES CATÉGORIES PERSONNALISÉES ===
            
            getAllCategories() {
                return [...this.defaultCategories, ...this.customCategories];
            }
            
            addCustomCategory(name, icon, color) {
                if (!name || !icon) {
                    this.showNotification('❌', 'Erreur', 'Nom et icône requis');
                    return false;
                }
                
                // Vérifier si la catégorie existe déjà
                const allCategories = this.getAllCategories();
                const exists = allCategories.some(cat => 
                    cat.name.toLowerCase() === name.toLowerCase() || 
                    cat.id === this.generateCategoryId(name)
                );
                
                if (exists) {
                    this.showNotification('❌', 'Erreur', 'Cette catégorie existe déjà');
                    return false;
                }
                
                const newCategory = {
                    id: this.generateCategoryId(name),
                    name: name,
                    icon: icon,
                    color: color || 'blue',
                    deletable: true,
                    created: new Date().toISOString()
                };
                
                this.customCategories.push(newCategory);
                this.saveCustomCategories();
                this.renderCategoriesList();
                this.updateCategorySelects();
                this.updateQuickActions();
                
                // Créer le style CSS dynamiquement
                this.createCategoryStyle(newCategory);
                
                this.showNotification('✅', 'Succès', `Catégorie "${name}" créée!`);
                
                // Haptic feedback
                if (navigator.vibrate) {
                    navigator.vibrate([50, 50, 100]);
                }
                
                return true;
            }
            
            deleteCustomCategory(categoryId) {
                const category = this.customCategories.find(cat => cat.id === categoryId);
                if (!category) {
                    this.showNotification('❌', 'Erreur', 'Catégorie introuvable');
                    return false;
                }
                
                // Vérifier s'il y a des rappels avec cette catégorie
                const remindersWithCategory = this.reminders.filter(r => r.category === categoryId);
                
                if (remindersWithCategory.length > 0) {
                    const confirmMessage = `⚠️ ATTENTION ⚠️\n\nIl y a ${remindersWithCategory.length} rappel(s) avec la catégorie "${category.name}".\n\nVoulez-vous vraiment supprimer cette catégorie ?\n\nLes rappels seront convertis en "Tâche".`;
                    
                    if (!confirm(confirmMessage)) {
                        return false;
                    }
                    
                    // Convertir les rappels existants en "tache"
                    remindersWithCategory.forEach(reminder => {
                        reminder.category = 'tache';
                    });
                    
                    this.saveData();
                    this.renderReminders();
                }
                
                // Supprimer la catégorie
                this.customCategories = this.customCategories.filter(cat => cat.id !== categoryId);
                this.saveCustomCategories();
                this.renderCategoriesList();
                this.updateCategorySelects();
                this.updateQuickActions();
                
                // Supprimer le style CSS
                this.removeCategoryStyle(categoryId);
                
                this.showNotification('🗑️', 'Supprimé', `Catégorie "${category.name}" supprimée`);
                
                // Strong haptic feedback
                if (navigator.vibrate) {
                    navigator.vibrate([100, 50, 100]);
                }
                
                return true;
            }
            
            generateCategoryId(name) {
                return name.toLowerCase()
                    .replace(/[^a-z0-9]/g, '-')
                    .replace(/-+/g, '-')
                    .replace(/^-|-$/g, '');
            }
            
            createCategoryStyle(category) {
                const colorMap = {
                    'red': '#ef4444, #dc2626',
                    'blue': '#3b82f6, #1d4ed8',
                    'green': '#10b981, #047857',
                    'yellow': '#f59e0b, #d97706',
                    'purple': '#8b5cf6, #7c3aed',
                    'pink': '#ec4899, #db2777',
                    'indigo': '#6366f1, #4f46e5',
                    'orange': '#f97316, #ea580c',
                    'teal': '#14b8a6, #0d9488',
                    'cyan': '#06b6d4, #0891b2',
                    'gray': '#6b7280, #4b5563',
                    'emerald': '#10b981, #059669'
                };
                
                const colors = colorMap[category.color] || colorMap['blue'];
                
                // Créer ou mettre à jour le style
                let styleElement = document.getElementById(`category-style-${category.id}`);
                if (!styleElement) {
                    styleElement = document.createElement('style');
                    styleElement.id = `category-style-${category.id}`;
                    document.head.appendChild(styleElement);
                }
                
                styleElement.textContent = `
                    .category-${category.id} .category-icon { 
                        background: linear-gradient(135deg, ${colors}); 
                    }
                `;
            }
            
            removeCategoryStyle(categoryId) {
                const styleElement = document.getElementById(`category-style-${categoryId}`);
                if (styleElement) {
                    styleElement.remove();
                }
            }
            
            renderCategoriesList() {
                const container = document.getElementById('categoriesList');
                if (!container) return;
                
                const allCategories = this.getAllCategories();
                
                container.innerHTML = allCategories.map(category => {
                    const usageCount = this.reminders.filter(r => r.category === category.id).length;
                    
                    return `
                        <div class="category-item flex items-center justify-between">
                            <div class="flex items-center space-x-3">
                                <div class="w-10 h-10 rounded-lg flex items-center justify-center text-white category-icon" 
                                     style="background: linear-gradient(135deg, ${this.getCategoryColors(category.color)});">
                                    ${category.icon}
                                </div>
                                <div>
                                    <div class="font-semibold text-gray-800">${category.name}</div>
                                    <div class="text-xs text-gray-500">${usageCount} rappel(s)</div>
                                </div>
                            </div>
                            <div class="flex items-center space-x-2">
                                ${category.deletable ? `
                                    <button onclick="mobileSystem.deleteCustomCategory('${category.id}')" 
                                            class="category-delete-btn haptic">
                                        🗑️ Supprimer
                                    </button>
                                ` : `
                                    <span class="text-xs text-gray-400 bg-gray-100 px-2 py-1 rounded-full">
                                        Système
                                    </span>
                                `}
                            </div>
                        </div>
                    `;
                }).join('');
            }
            
            getCategoryColors(color) {
                const colorMap = {
                    'red': '#ef4444, #dc2626',
                    'blue': '#3b82f6, #1d4ed8',
                    'green': '#10b981, #047857',
                    'yellow': '#f59e0b, #d97706',
                    'purple': '#8b5cf6, #7c3aed',
                    'pink': '#ec4899, #db2777',
                    'indigo': '#6366f1, #4f46e5',
                    'orange': '#f97316, #ea580c',
                    'teal': '#14b8a6, #0d9488',
                    'cyan': '#06b6d4, #0891b2',
                    'gray': '#6b7280, #4b5563',
                    'emerald': '#10b981, #059669'
                };
                
                return colorMap[color] || colorMap['blue'];
            }
            
            updateCategorySelects() {
                const selects = document.querySelectorAll('#reminderCategory');
                const allCategories = this.getAllCategories();
                
                selects.forEach(select => {
                    const currentValue = select.value;
                    
                    select.innerHTML = allCategories.map(category => 
                        `<option value="${category.id}">${category.icon} ${category.name}</option>`
                    ).join('');
                    
                    // Restaurer la valeur sélectionnée si elle existe encore
                    if (allCategories.some(cat => cat.id === currentValue)) {
                        select.value = currentValue;
                    }
                });
            }
            
            updateQuickActions() {
                // Mettre à jour les boutons d'actions rapides avec les nouvelles catégories
                const quickActionsContainer = document.querySelector('.flex.space-x-2.overflow-x-auto.pb-2');
                if (!quickActionsContainer) return;
                
                const allCategories = this.getAllCategories();
                const popularCategories = allCategories
                    .map(cat => ({
                        ...cat,
                        usage: this.reminders.filter(r => r.category === cat.id).length
                    }))
                    .sort((a, b) => b.usage - a.usage)
                    .slice(0, 6); // Afficher les 6 catégories les plus utilisées
                
                quickActionsContainer.innerHTML = popularCategories.map(category => `
                    <button class="quick-action flex items-center space-x-2 whitespace-nowrap haptic" onclick="showAddModal('${category.id}')">
                        <span>${category.icon}</span>
                        <span class="text-white text-sm font-medium">${category.name}</span>
                    </button>
                `).join('');
            }
            
            saveCustomCategories() {
                localStorage.setItem('mobile_custom_categories', JSON.stringify(this.customCategories));
                
                // Créer les styles CSS pour toutes les catégories personnalisées
                this.customCategories.forEach(category => {
                    this.createCategoryStyle(category);
                });
            }
            
            createDemoData() {
                if (this.reminders.length === 0) {
                    const now = new Date();
                    const today = now.toISOString().split('T')[0];
                    
                    const demoReminders = [
                        {
                            id: Date.now() + 1,
                            text: 'Prière du matin - Moment avec Dieu',
                            date: today,
                            time: '07:30',
                            category: 'priere',
                            priority: 'haute',
                            location: 'Chambre',
                            created: new Date().toISOString(),
                            notified: false,
                            completed: false,
                            sentVia: null,
                            sentAt: null
                        },
                        {
                            id: Date.now() + 2,
                            text: 'Messe dominicale',
                            date: today,
                            time: '10:00',
                            category: 'messe',
                            priority: 'haute',
                            location: 'Église Saint-Pierre',
                            created: new Date().toISOString(),
                            notified: false,
                            completed: false,
                            sentVia: null,
                            sentAt: null
                        },
                        {
                            id: Date.now() + 3,
                            text: 'Rendez-vous médecin',
                            date: today,
                            time: '15:30',
                            category: 'sante',
                            priority: 'normale',
                            location: 'Cabinet Dr. Martin',
                            created: new Date().toISOString(),
                            notified: false,
                            completed: false,
                            sentVia: null,
                            sentAt: null
                        },
                        {
                            id: Date.now() + 4,
                            text: 'Appeler Maman',
                            date: today,
                            time: '19:00',
                            category: 'famille',
                            priority: 'haute',
                            location: '',
                            created: new Date().toISOString(),
                            notified: false,
                            completed: false,
                            sentVia: null,
                            sentAt: null
                        }
                    ];
                    
                    this.reminders = demoReminders;
                    this.saveData();
                }
            }
            
            // === SYSTÈME DE STATISTIQUES DÉTAILLÉES ===
            
            renderStats() {
                this.updateStatsNumbers();
                this.renderStatsTable();
                this.renderCategoryStats();
                this.renderSendingModeStats();
            }
            
            updateStatsNumbers() {
                const allReminders = [...this.reminders, ...this.completedReminders];
                const sentReminders = allReminders.filter(r => r.notified || r.sentVia);
                const pendingReminders = this.reminders.filter(r => !r.notified && !r.completed);
                const completedReminders = this.completedReminders;
                
                document.getElementById('statsTotal').textContent = allReminders.length;
                document.getElementById('statsSent').textContent = sentReminders.length;
                document.getElementById('statsPending').textContent = pendingReminders.length;
                document.getElementById('statsCompleted').textContent = completedReminders.length;
            }
            
            renderStatsTable(filter = 'all') {
                const tableBody = document.getElementById('statsTableBody');
                const allReminders = [...this.reminders, ...this.completedReminders];
                
                let filteredReminders = allReminders;
                
                // Appliquer les filtres
                switch (filter) {
                    case 'sent':
                        filteredReminders = allReminders.filter(r => r.notified || r.sentVia);
                        break;
                    case 'pending':
                        filteredReminders = this.reminders.filter(r => !r.notified && !r.completed);
                        break;
                    case 'completed':
                        filteredReminders = this.completedReminders;
                        break;
                    case 'callmebot':
                        filteredReminders = allReminders.filter(r => r.sentVia === 'callmebot');
                        break;
                }
                
                // Trier par date de création (plus récent en premier)
                filteredReminders.sort((a, b) => new Date(b.created) - new Date(a.created));
                
                tableBody.innerHTML = filteredReminders.map(reminder => {
                    const allCategories = this.getAllCategories();
                    const categoryInfo = allCategories.find(cat => cat.id === reminder.category) || 
                                       { id: 'tache', name: 'Tâche', icon: '📋', color: 'blue' };
                    
                    const priorityIcons = {
                        'urgente': '🚨',
                        'haute': '🔴',
                        'normale': '🟡',
                        'basse': '🟢'
                    };
                    
                    const priorityColors = {
                        'urgente': 'text-red-600 bg-red-50',
                        'haute': 'text-orange-600 bg-orange-50',
                        'normale': 'text-yellow-600 bg-yellow-50',
                        'basse': 'text-green-600 bg-green-50'
                    };
                    
                    // Déterminer le statut d'envoi
                    let sendStatus = '';
                    let sendMode = '';
                    let globalStatus = '';
                    
                    if (reminder.completed) {
                        globalStatus = '<span class="px-2 py-1 bg-green-100 text-green-700 rounded-full text-xs font-medium">🎉 Terminé</span>';
                    } else if (reminder.notified || reminder.sentVia) {
                        globalStatus = '<span class="px-2 py-1 bg-blue-100 text-blue-700 rounded-full text-xs font-medium">✅ Actif</span>';
                    } else {
                        globalStatus = '<span class="px-2 py-1 bg-orange-100 text-orange-700 rounded-full text-xs font-medium">⏳ En Attente</span>';
                    }
                    
                    if (reminder.sentVia) {
                        sendStatus = '<span class="px-2 py-1 bg-green-100 text-green-700 rounded-full text-xs font-medium">✅ Envoyé</span>';
                        
                        if (reminder.sentVia === 'callmebot') {
                            sendMode = '<span class="px-2 py-1 bg-green-100 text-green-700 rounded-full text-xs">📲 CallMeBot</span>';
                        } else if (reminder.sentVia === 'browser') {
                            sendMode = '<span class="px-2 py-1 bg-blue-100 text-blue-700 rounded-full text-xs">🌐 Navigateur</span>';
                        } else {
                            sendMode = '<span class="px-2 py-1 bg-gray-100 text-gray-700 rounded-full text-xs">❓ Inconnu</span>';
                        }
                    } else if (reminder.notified) {
                        sendStatus = '<span class="px-2 py-1 bg-blue-100 text-blue-700 rounded-full text-xs font-medium">📤 Notifié</span>';
                        sendMode = '<span class="px-2 py-1 bg-blue-100 text-blue-700 rounded-full text-xs">🌐 Navigateur</span>';
                    } else {
                        sendStatus = '<span class="px-2 py-1 bg-gray-100 text-gray-700 rounded-full text-xs font-medium">⏳ En Attente</span>';
                        sendMode = '<span class="px-2 py-1 bg-gray-100 text-gray-700 rounded-full text-xs">➖ Aucun</span>';
                    }
                    
                    const reminderDateTime = new Date(`${reminder.date}T${reminder.time}`);
                    const formattedDate = reminderDateTime.toLocaleDateString('fr-FR', { 
                        day: '2-digit', 
                        month: '2-digit',
                        year: '2-digit'
                    });
                    const formattedTime = reminderDateTime.toLocaleTimeString('fr-FR', { 
                        hour: '2-digit', 
                        minute: '2-digit' 
                    });
                    
                    return `
                        <tr class="border-b border-gray-100 hover:bg-gray-50">
                            <td class="px-3 py-3">
                                <div class="font-medium text-gray-800 text-sm">${reminder.text}</div>
                                ${reminder.location ? `<div class="text-xs text-gray-500 mt-1">📍 ${reminder.location}</div>` : ''}
                            </td>
                            <td class="px-3 py-3">
                                <div class="text-sm text-gray-700">${formattedDate}</div>
                                <div class="text-xs text-gray-500">${formattedTime}</div>
                            </td>
                            <td class="px-3 py-3">
                                <div class="flex items-center space-x-2">
                                    <span class="text-lg">${categoryInfo.icon}</span>
                                    <span class="text-sm text-gray-700">${categoryInfo.name}</span>
                                </div>
                            </td>
                            <td class="px-3 py-3">
                                <span class="px-2 py-1 rounded-full text-xs font-medium ${priorityColors[reminder.priority]}">
                                    ${priorityIcons[reminder.priority]} ${reminder.priority}
                                </span>
                            </td>
                            <td class="px-3 py-3">${sendStatus}</td>
                            <td class="px-3 py-3">${sendMode}</td>
                            <td class="px-3 py-3">${globalStatus}</td>
                        </tr>
                    `;
                }).join('');
                
                if (filteredReminders.length === 0) {
                    tableBody.innerHTML = `
                        <tr>
                            <td colspan="7" class="px-3 py-8 text-center text-gray-500">
                                <div class="text-4xl mb-2">📊</div>
                                <div>Aucun rappel trouvé pour ce filtre</div>
                            </td>
                        </tr>
                    `;
                }
            }
            
            renderCategoryStats() {
                const container = document.getElementById('categoryStats');
                const allReminders = [...this.reminders, ...this.completedReminders];
                const allCategories = this.getAllCategories();
                
                // Compter les rappels par catégorie
                const categoryCount = {};
                allCategories.forEach(cat => {
                    categoryCount[cat.id] = {
                        ...cat,
                        total: 0,
                        sent: 0,
                        pending: 0,
                        completed: 0
                    };
                });
                
                allReminders.forEach(reminder => {
                    if (categoryCount[reminder.category]) {
                        categoryCount[reminder.category].total++;
                        
                        if (reminder.completed) {
                            categoryCount[reminder.category].completed++;
                        } else if (reminder.notified || reminder.sentVia) {
                            categoryCount[reminder.category].sent++;
                        } else {
                            categoryCount[reminder.category].pending++;
                        }
                    }
                });
                
                // Trier par nombre total (décroissant)
                const sortedCategories = Object.values(categoryCount)
                    .filter(cat => cat.total > 0)
                    .sort((a, b) => b.total - a.total);
                
                container.innerHTML = sortedCategories.map(cat => `
                    <div class="bg-white rounded-lg border border-gray-200 p-4">
                        <div class="flex items-center justify-between mb-2">
                            <div class="flex items-center space-x-3">
                                <div class="w-10 h-10 rounded-lg flex items-center justify-center text-white" 
                                     style="background: linear-gradient(135deg, ${this.getCategoryColors(cat.color)});">
                                    ${cat.icon}
                                </div>
                                <div>
                                    <div class="font-semibold text-gray-800">${cat.name}</div>
                                    <div class="text-sm text-gray-500">${cat.total} rappel(s) total</div>
                                </div>
                            </div>
                            <div class="text-right">
                                <div class="text-lg font-bold text-gray-800">${cat.total}</div>
                            </div>
                        </div>
                        <div class="grid grid-cols-3 gap-2 text-xs">
                            <div class="text-center p-2 bg-green-50 rounded">
                                <div class="font-bold text-green-700">${cat.sent}</div>
                                <div class="text-green-600">Envoyés</div>
                            </div>
                            <div class="text-center p-2 bg-orange-50 rounded">
                                <div class="font-bold text-orange-700">${cat.pending}</div>
                                <div class="text-orange-600">En Attente</div>
                            </div>
                            <div class="text-center p-2 bg-purple-50 rounded">
                                <div class="font-bold text-purple-700">${cat.completed}</div>
                                <div class="text-purple-600">Terminés</div>
                            </div>
                        </div>
                    </div>
                `).join('');
                
                if (sortedCategories.length === 0) {
                    container.innerHTML = `
                        <div class="text-center py-8 text-gray-500">
                            <div class="text-4xl mb-2">📊</div>
                            <div>Aucune donnée de catégorie disponible</div>
                        </div>
                    `;
                }
            }
            
            renderSendingModeStats() {
                const allReminders = [...this.reminders, ...this.completedReminders];
                
                const callmebotCount = allReminders.filter(r => r.sentVia === 'callmebot').length;
                const browserCount = allReminders.filter(r => r.notified && !r.sentVia).length;
                
                document.getElementById('callmebotCount').textContent = callmebotCount;
                document.getElementById('browserCount').textContent = browserCount;
            }
        }
        
        // Global functions for UI interactions
        function showAddModal(category = '') {
            const modal = document.getElementById('addModal');
            modal.classList.add('active');
            
            if (category) {
                document.getElementById('reminderCategory').value = category;
            }
            
            // Focus on text input after animation
            setTimeout(() => {
                document.getElementById('reminderText').focus();
            }, 300);
        }
        
        // AI Functions
        function toggleAI() {
            const panel = document.getElementById('aiPanel');
            const toggle = document.getElementById('aiToggle');
            
            if (panel.style.display === 'none') {
                panel.style.display = 'block';
                toggle.textContent = '🧠';
                mobileSystem.generateAISuggestions();
            } else {
                panel.style.display = 'none';
                toggle.textContent = '🤖';
            }
        }
        

        
        function handleAIInput(event) {
            if (event.key === 'Enter') {
                processAIInput();
            }
        }
        
        function processAIInput() {
            mobileSystem.processAIInput();
        }
        
        function applySmartPattern(pattern) {
            mobileSystem.applySmartPattern(pattern);
        }
        
        function showSmartScheduler(analysis = null) {
            const modal = document.getElementById('smartSchedulerModal');
            modal.classList.add('active');
            
            if (analysis) {
                // Show analysis results
                const analysisResult = document.getElementById('analysisResult');
                analysisResult.innerHTML = `
                    <div class="space-y-2">
                        <div><strong>Texte analysé:</strong> "${analysis.originalText}"</div>
                        <div><strong>Catégorie détectée:</strong> ${analysis.detectedCategory} (${analysis.confidence}% confiance)</div>
                        <div><strong>Heure suggérée:</strong> ${analysis.suggestedTime || 'Non détectée'}</div>
                        <div><strong>Priorité:</strong> ${analysis.suggestedPriority}</div>
                        ${analysis.suggestedRecurrence ? `<div><strong>Récurrence:</strong> ${analysis.suggestedRecurrence}</div>` : ''}
                    </div>
                `;
                
                // Show suggestions
                const suggestionsContainer = document.getElementById('smartSuggestions');
                mobileSystem.currentAISuggestions = analysis.suggestions;
                
                suggestionsContainer.innerHTML = analysis.suggestions.map((suggestion, index) => `
                    <div class="bg-white rounded-lg p-4 border border-gray-200">
                        <div class="flex items-center justify-between mb-2">
                            <h4 class="font-semibold text-gray-800">${suggestion.text}</h4>
                            <span class="text-xs bg-blue-100 text-blue-600 px-2 py-1 rounded-full">${suggestion.confidence}%</span>
                        </div>
                        <div class="text-sm text-gray-600 space-y-1">
                            <div>📅 ${mobileSystem.formatDate(suggestion.date)} à ${suggestion.time}</div>
                            <div>🎯 ${suggestion.category} - ${suggestion.priority}</div>
                            ${suggestion.location ? `<div>📍 ${suggestion.location}</div>` : ''}
                        </div>
                        <div class="flex space-x-2 mt-3">
                            <button onclick="acceptSuggestion(${index})" class="flex-1 bg-green-500 text-white py-2 px-3 rounded-lg text-sm haptic">
                                ✅ Accepter
                            </button>
                            <button onclick="editSuggestion(${index})" class="flex-1 bg-blue-500 text-white py-2 px-3 rounded-lg text-sm haptic">
                                ✏️ Modifier
                            </button>
                            <button onclick="rejectSuggestion(${index})" class="bg-red-500 text-white py-2 px-3 rounded-lg text-sm haptic">
                                ❌
                            </button>
                        </div>
                    </div>
                `).join('');
            }
        }
        
        function hideSmartScheduler() {
            const modal = document.getElementById('smartSchedulerModal');
            modal.classList.remove('active');
        }
        
        function acceptSuggestion(index) {
            const suggestion = mobileSystem.currentAISuggestions[index];
            if (!suggestion) return;
            
            const reminder = {
                id: Date.now(),
                text: suggestion.text,
                date: suggestion.date,
                time: suggestion.time,
                category: suggestion.category,
                priority: suggestion.priority,
                location: suggestion.location,
                created: new Date().toISOString(),
                notified: false,
                completed: false
            };
            
            mobileSystem.reminders.push(reminder);
            mobileSystem.saveData();
            mobileSystem.renderReminders();
            mobileSystem.updateStats();
            
            mobileSystem.showNotification('✅', 'Accepté', 'Rappel ajouté avec succès!');
            
            // Remove suggestion from display
            const suggestionEl = document.getElementById('smartSuggestions').children[index];
            if (suggestionEl) {
                suggestionEl.style.opacity = '0.5';
                suggestionEl.style.pointerEvents = 'none';
            }
        }
        
        function editSuggestion(index) {
            const suggestion = mobileSystem.currentAISuggestions[index];
            if (!suggestion) return;
            
            // Pre-fill the add modal with suggestion data
            document.getElementById('reminderText').value = suggestion.text;
            document.getElementById('reminderDate').value = suggestion.date;
            document.getElementById('reminderTime').value = suggestion.time;
            document.getElementById('reminderCategory').value = suggestion.category;
            document.getElementById('reminderPriority').value = suggestion.priority;
            document.getElementById('reminderLocation').value = suggestion.location || '';
            
            hideSmartScheduler();
            showAddModal();
        }
        
        function rejectSuggestion(index) {
            const suggestionEl = document.getElementById('smartSuggestions').children[index];
            if (suggestionEl) {
                suggestionEl.style.display = 'none';
            }
            
            mobileSystem.showNotification('❌', 'Rejeté', 'Suggestion supprimée');
        }
        
        function acceptAllSuggestions() {
            if (!mobileSystem.currentAISuggestions || mobileSystem.currentAISuggestions.length === 0) {
                mobileSystem.showNotification('❌', 'Erreur', 'Aucune suggestion à accepter');
                return;
            }
            
            let addedCount = 0;
            
            mobileSystem.currentAISuggestions.forEach((suggestion, index) => {
                setTimeout(() => {
                    const reminder = {
                        id: Date.now() + index,
                        text: suggestion.text,
                        date: suggestion.date,
                        time: suggestion.time,
                        category: suggestion.category,
                        priority: suggestion.priority,
                        location: suggestion.location,
                        created: new Date().toISOString(),
                        notified: false,
                        completed: false
                    };
                    
                    mobileSystem.reminders.push(reminder);
                    addedCount++;
                }, index * 100);
            });
            
            setTimeout(() => {
                mobileSystem.saveData();
                mobileSystem.renderReminders();
                mobileSystem.updateStats();
                mobileSystem.showNotification('🎉', 'Succès', `${addedCount} rappels ajoutés!`);
                hideSmartScheduler();
            }, mobileSystem.currentAISuggestions.length * 100 + 200);
        }
        
        function customizeSchedule() {
            mobileSystem.showNotification('⚙️', 'Personnalisation', 'Fonctionnalité en développement...');
        }
        
        function toggleWhatsAppFields() {
            const method = document.getElementById('whatsappMethod').value;
            const businessFields = document.getElementById('businessFields');
            const twilioFields = document.getElementById('twilioFields');
            const webInstructions = document.getElementById('webInstructions');
            const businessInstructions = document.getElementById('businessInstructions');
            const twilioInstructions = document.getElementById('twilioInstructions');
            
            // Hide all fields first
            businessFields.classList.add('hidden');
            twilioFields.classList.add('hidden');
            webInstructions.classList.add('hidden');
            businessInstructions.classList.add('hidden');
            twilioInstructions.classList.add('hidden');
            
            // Show relevant fields
            if (method === 'business') {
                businessFields.classList.remove('hidden');
                businessInstructions.classList.remove('hidden');
            } else if (method === 'twilio') {
                twilioFields.classList.remove('hidden');
                twilioInstructions.classList.remove('hidden');
            } else {
                webInstructions.classList.remove('hidden');
            }
        }
        
        function toggleRecurringOptions() {
            const isRecurring = document.getElementById('isRecurring').checked;
            const recurringOptions = document.getElementById('recurringOptions');
            
            if (isRecurring) {
                recurringOptions.classList.remove('hidden');
                updateRecurringPreview();
            } else {
                recurringOptions.classList.add('hidden');
            }
        }
        
        function updateRecurringOptions() {
            const type = document.getElementById('recurringType').value;
            const weeklyOptions = document.getElementById('weeklyOptions');
            const customOptions = document.getElementById('customOptions');
            
            weeklyOptions.classList.add('hidden');
            customOptions.classList.add('hidden');
            
            if (type === 'weekly') {
                weeklyOptions.classList.remove('hidden');
            } else if (type === 'custom') {
                customOptions.classList.remove('hidden');
            }
            
            updateRecurringPreview();
        }
        
        function toggleAdvanceOptions() {
            const advanceNotice = document.getElementById('advanceNotice').checked;
            const advanceOptions = document.getElementById('advanceOptions');
            
            if (advanceNotice) {
                advanceOptions.classList.remove('hidden');
            } else {
                advanceOptions.classList.add('hidden');
            }
        }
        
        function updateRecurringPreview() {
            const previewList = document.getElementById('previewList');
            const type = document.getElementById('recurringType').value;
            const startDate = new Date(document.getElementById('reminderDate').value + 'T' + document.getElementById('reminderTime').value);
            
            if (!document.getElementById('reminderDate').value) {
                previewList.innerHTML = '<div class="text-gray-400">Sélectionnez d\'abord une date</div>';
                return;
            }
            
            const previews = [];
            let currentDate = new Date(startDate);
            
            for (let i = 0; i < 5; i++) {
                if (type === 'daily') {
                    currentDate.setDate(currentDate.getDate() + (i === 0 ? 0 : 1));
                } else if (type === 'weekly') {
                    const selectedDays = Array.from(document.querySelectorAll('.recurring-days:checked')).map(cb => parseInt(cb.value));
                    if (selectedDays.length === 0) {
                        currentDate.setDate(currentDate.getDate() + (i === 0 ? 0 : 7));
                    } else {
                        // Logic for specific days would go here
                        currentDate.setDate(currentDate.getDate() + (i === 0 ? 0 : 7));
                    }
                } else if (type === 'monthly') {
                    currentDate.setMonth(currentDate.getMonth() + (i === 0 ? 0 : 1));
                } else if (type === 'yearly') {
                    currentDate.setFullYear(currentDate.getFullYear() + (i === 0 ? 0 : 1));
                } else if (type === 'custom') {
                    const interval = parseInt(document.getElementById('customInterval').value) || 1;
                    const unit = document.getElementById('customUnit').value;
                    
                    if (i > 0) {
                        if (unit === 'days') {
                            currentDate.setDate(currentDate.getDate() + interval);
                        } else if (unit === 'weeks') {
                            currentDate.setDate(currentDate.getDate() + (interval * 7));
                        } else if (unit === 'months') {
                            currentDate.setMonth(currentDate.getMonth() + interval);
                        } else if (unit === 'years') {
                            currentDate.setFullYear(currentDate.getFullYear() + interval);
                        }
                    }
                }
                
                previews.push(`${currentDate.toLocaleDateString('fr-FR')} à ${currentDate.toLocaleTimeString('fr-FR', {hour: '2-digit', minute: '2-digit'})}`);
                currentDate = new Date(currentDate);
            }
            
            previewList.innerHTML = previews.map(preview => `<div>• ${preview}</div>`).join('');
        }
        
        // Add event listeners for recurring preview updates
        document.addEventListener('DOMContentLoaded', function() {
            const recurringInputs = ['reminderDate', 'reminderTime', 'customInterval', 'customUnit'];
            recurringInputs.forEach(id => {
                const element = document.getElementById(id);
                if (element) {
                    element.addEventListener('change', updateRecurringPreview);
                }
            });
            
            // Add listeners for weekly days
            document.addEventListener('change', function(e) {
                if (e.target.classList.contains('recurring-days')) {
                    updateRecurringPreview();
                }
            });
            
            // Add timezone change listener
            const timezoneSelect = document.getElementById('timezone');
            if (timezoneSelect) {
                timezoneSelect.addEventListener('change', function() {
                    if (window.mobileSystem) {
                        window.mobileSystem.settings.timezone = this.value;
                        window.mobileSystem.updateCurrentTime();
                    }
                });
            }
        });
        
        function hideAddModal() {
            const modal = document.getElementById('addModal');
            modal.classList.remove('active');
        }
        
        function switchTab(tab) {
            // Update nav items
            document.querySelectorAll('.nav-item').forEach(item => {
                item.classList.remove('active');
            });
            event.target.closest('.nav-item').classList.add('active');
            
            // Show/hide content based on tab
            const remindersList = document.getElementById('remindersList');
            const emptyState = document.getElementById('emptyState');
            const settingsPage = document.getElementById('settingsPage');
            const statsPage = document.getElementById('statsPage');
            
            // Hide all pages first
            remindersList.style.display = 'none';
            emptyState.style.display = 'none';
            settingsPage.classList.add('hidden');
            statsPage.classList.add('hidden');
            
            if (tab === 'settings') {
                settingsPage.classList.remove('hidden');
            } else if (tab === 'stats') {
                statsPage.classList.remove('hidden');
                mobileSystem.renderStats();
            } else {
                remindersList.style.display = 'block';
                
                // Update system state
                mobileSystem.currentTab = tab;
                mobileSystem.renderReminders();
            }
            
            // Haptic feedback
            if (navigator.vibrate) {
                navigator.vibrate(30);
            }
        }
        
        function saveSettings() {
            mobileSystem.saveSettings();
        }
        
        function testWhatsApp() {
            mobileSystem.testWhatsApp();
        }
        
        function testCallMeBot() {
            mobileSystem.testCallMeBot();
        }
        
        function testCallBot() {
            mobileSystem.testCallBot();
        }
        
        function getLocation() {
            if ('geolocation' in navigator) {
                mobileSystem.showNotification('📍', 'Position', 'Récupération en cours...');
                
                navigator.geolocation.getCurrentPosition(
                    (position) => {
                        const { latitude, longitude } = position.coords;
                        document.getElementById('reminderLocation').value = `${latitude.toFixed(4)}, ${longitude.toFixed(4)}`;
                        mobileSystem.showNotification('✅', 'Position', 'Position récupérée!');
                    },
                    (error) => {
                        mobileSystem.showNotification('❌', 'Erreur', 'Impossible de récupérer la position');
                    }
                );
            } else {
                mobileSystem.showNotification('❌', 'Erreur', 'Géolocalisation non supportée');
            }
        }
        
        function hideNotification() {
            mobileSystem.hideNotification();
        }
        
        // === FONCTIONS GLOBALES POUR CATÉGORIES ===
        
        function selectCategoryColor(color) {
            // Retirer la sélection précédente
            document.querySelectorAll('.color-option').forEach(btn => {
                btn.classList.remove('selected');
            });
            
            // Ajouter la sélection à la couleur choisie
            document.querySelector(`[data-color="${color}"]`).classList.add('selected');
            document.getElementById('selectedCategoryColor').value = color;
            
            // Haptic feedback
            if (navigator.vibrate) {
                navigator.vibrate(30);
            }
        }
        
        function addCustomCategory() {
            const name = document.getElementById('newCategoryName').value.trim();
            const icon = document.getElementById('newCategoryIcon').value.trim();
            const color = document.getElementById('selectedCategoryColor').value;
            
            if (!name) {
                mobileSystem.showNotification('❌', 'Erreur', 'Veuillez saisir un nom de catégorie');
                return;
            }
            
            if (!icon) {
                mobileSystem.showNotification('❌', 'Erreur', 'Veuillez saisir un emoji/icône');
                return;
            }
            
            const success = mobileSystem.addCustomCategory(name, icon, color);
            
            if (success) {
                // Vider les champs
                document.getElementById('newCategoryName').value = '';
                document.getElementById('newCategoryIcon').value = '';
                document.getElementById('selectedCategoryColor').value = 'blue';
                
                // Retirer la sélection de couleur
                document.querySelectorAll('.color-option').forEach(btn => {
                    btn.classList.remove('selected');
                });
                
                // Sélectionner la couleur par défaut (bleu)
                document.querySelector('[data-color="blue"]').classList.add('selected');
            }
        }
        
        // === FONCTIONS GLOBALES POUR STATISTIQUES ===
        
        function filterStats(filter) {
            // Mettre à jour les boutons de filtre
            document.querySelectorAll('.stats-filter-btn').forEach(btn => {
                btn.classList.remove('active', 'bg-blue-500', 'text-white');
                btn.classList.add('bg-gray-200', 'text-gray-700');
            });
            
            event.target.classList.remove('bg-gray-200', 'text-gray-700');
            event.target.classList.add('active', 'bg-blue-500', 'text-white');
            
            // Appliquer le filtre
            mobileSystem.renderStatsTable(filter);
            
            // Haptic feedback
            if (navigator.vibrate) {
                navigator.vibrate(30);
            }
        }
        
        function exportStats() {
            try {
                const allReminders = [...mobileSystem.reminders, ...mobileSystem.completedReminders];
                const statsData = {
                    exportDate: new Date().toISOString(),
                    totalReminders: allReminders.length,
                    activeReminders: mobileSystem.reminders.length,
                    completedReminders: mobileSystem.completedReminders.length,
                    messageStats: mobileSystem.messageStats,
                    reminders: allReminders.map(r => ({
                        text: r.text,
                        date: r.date,
                        time: r.time,
                        category: r.category,
                        priority: r.priority,
                        location: r.location,
                        created: r.created,
                        completed: r.completed,
                        notified: r.notified,
                        sentVia: r.sentVia,
                        sentAt: r.sentAt
                    }))
                };
                
                const dataStr = JSON.stringify(statsData, null, 2);
                const dataBlob = new Blob([dataStr], { type: 'application/json' });
                const url = URL.createObjectURL(dataBlob);
                
                const link = document.createElement('a');
                link.href = url;
                link.download = `RemindPro-Stats-${new Date().toISOString().split('T')[0]}.json`;
                document.body.appendChild(link);
                link.click();
                document.body.removeChild(link);
                URL.revokeObjectURL(url);
                
                mobileSystem.showNotification('📊', 'Export', 'Statistiques exportées avec succès!');
                
                // Haptic feedback
                if (navigator.vibrate) {
                    navigator.vibrate([100, 50, 100]);
                }
            } catch (error) {
                console.error('Export error:', error);
                mobileSystem.showNotification('❌', 'Erreur', 'Échec de l\'export des statistiques');
            }
        }
        
        function resetStats() {
            if (confirm('⚠️ ATTENTION ⚠️\n\nVoulez-vous vraiment remettre à zéro toutes les statistiques ?\n\nCette action supprimera :\n- Tous les rappels terminés\n- Toutes les statistiques d\'envoi\n- L\'historique complet\n\nCette action est IRRÉVERSIBLE !')) {
                // Reset completed reminders
                mobileSystem.completedReminders = [];
                localStorage.setItem('mobile_completed', JSON.stringify([]));
                
                // Reset message stats
                mobileSystem.messageStats = {
                    callMeBotSent: 0,
                    totalSent: 0
                };
                localStorage.setItem('mobile_message_stats', JSON.stringify(mobileSystem.messageStats));
                
                // Reset sent status on active reminders
                mobileSystem.reminders.forEach(reminder => {
                    reminder.notified = false;
                    reminder.sentVia = null;
                    reminder.sentAt = null;
                });
                mobileSystem.saveData();
                
                // Refresh displays
                mobileSystem.renderStats();
                mobileSystem.updateStats();
                
                mobileSystem.showNotification('🗑️', 'Reset', 'Toutes les statistiques ont été remises à zéro');
                
                // Strong haptic feedback
                if (navigator.vibrate) {
                    navigator.vibrate([200, 100, 200, 100, 200]);
                }
            }
        }
        
        function refreshStats() {
            mobileSystem.renderStats();
            mobileSystem.updateStats();
            mobileSystem.showNotification('🔄', 'Actualisé', 'Statistiques mises à jour!');
            
            // Haptic feedback
            if (navigator.vibrate) {
                navigator.vibrate(50);
            }
        }
        
        function printStats() {
            try {
                const printWindow = window.open('', '_blank');
                const allReminders = [...mobileSystem.reminders, ...mobileSystem.completedReminders];
                
                const printContent = `
                    <!DOCTYPE html>
                    <html>
                    <head>
                        <title>RemindPro Max - Statistiques</title>
                        <style>
                            body { font-family: Arial, sans-serif; margin: 20px; }
                            .header { text-align: center; margin-bottom: 30px; }
                            .stats-summary { display: grid; grid-template-columns: repeat(4, 1fr); gap: 20px; margin-bottom: 30px; }
                            .stat-card { border: 1px solid #ddd; padding: 15px; text-align: center; border-radius: 8px; }
                            .stat-number { font-size: 24px; font-weight: bold; color: #333; }
                            .stat-label { color: #666; font-size: 14px; }
                            table { width: 100%; border-collapse: collapse; margin-top: 20px; }
                            th, td { border: 1px solid #ddd; padding: 8px; text-align: left; font-size: 12px; }
                            th { background-color: #f5f5f5; font-weight: bold; }
                            .priority-urgente { background-color: #fee2e2; }
                            .priority-haute { background-color: #fed7aa; }
                            .priority-normale { background-color: #fef3c7; }
                            .priority-basse { background-color: #dcfce7; }
                            @media print { body { margin: 0; } }
                        </style>
                    </head>
                    <body>
                        <div class="header">
                            <h1>📊 ABM Reminder - Rapport Statistiques</h1>
                            <p>Généré le ${new Date().toLocaleDateString('fr-FR')} à ${new Date().toLocaleTimeString('fr-FR')}</p>
                        </div>
                        
                        <div class="stats-summary">
                            <div class="stat-card">
                                <div class="stat-number">${allReminders.length}</div>
                                <div class="stat-label">Total Rappels</div>
                            </div>
                            <div class="stat-card">
                                <div class="stat-number">${allReminders.filter(r => r.notified || r.sentVia).length}</div>
                                <div class="stat-label">Envoyés</div>
                            </div>
                            <div class="stat-card">
                                <div class="stat-number">${mobileSystem.reminders.filter(r => !r.notified && !r.completed).length}</div>
                                <div class="stat-label">En Attente</div>
                            </div>
                            <div class="stat-card">
                                <div class="stat-number">${mobileSystem.completedReminders.length}</div>
                                <div class="stat-label">Terminés</div>
                            </div>
                        </div>
                        
                        <h2>📋 Détail des Rappels</h2>
                        <table>
                            <thead>
                                <tr>
                                    <th>Rappel</th>
                                    <th>Date/Heure</th>
                                    <th>Catégorie</th>
                                    <th>Priorité</th>
                                    <th>Statut Envoi</th>
                                    <th>Mode</th>
                                    <th>État</th>
                                </tr>
                            </thead>
                            <tbody>
                                ${allReminders.map(reminder => {
                                    const allCategories = mobileSystem.getAllCategories();
                                    const categoryInfo = allCategories.find(cat => cat.id === reminder.category) || 
                                                       { id: 'tache', name: 'Tâche', icon: '📋' };
                                    
                                    const reminderDateTime = new Date(`${reminder.date}T${reminder.time}`);
                                    const formattedDate = reminderDateTime.toLocaleDateString('fr-FR');
                                    const formattedTime = reminderDateTime.toLocaleTimeString('fr-FR', { hour: '2-digit', minute: '2-digit' });
                                    
                                    let sendStatus = 'En Attente';
                                    let sendMode = 'Aucun';
                                    let globalStatus = 'Actif';
                                    
                                    if (reminder.completed) {
                                        globalStatus = 'Terminé';
                                    } else if (reminder.sentVia) {
                                        sendStatus = 'Envoyé';
                                        sendMode = reminder.sentVia === 'callmebot' ? 'CallMeBot' : 'Navigateur';
                                    } else if (reminder.notified) {
                                        sendStatus = 'Notifié';
                                        sendMode = 'Navigateur';
                                    }
                                    
                                    return `
                                        <tr class="priority-${reminder.priority}">
                                            <td>
                                                <strong>${reminder.text}</strong>
                                                ${reminder.location ? `<br><small>📍 ${reminder.location}</small>` : ''}
                                            </td>
                                            <td>${formattedDate}<br>${formattedTime}</td>
                                            <td>${categoryInfo.icon} ${categoryInfo.name}</td>
                                            <td>${reminder.priority}</td>
                                            <td>${sendStatus}</td>
                                            <td>${sendMode}</td>
                                            <td>${globalStatus}</td>
                                        </tr>
                                    `;
                                }).join('')}
                            </tbody>
                        </table>
                        
                        <div style="margin-top: 30px; text-align: center; color: #666; font-size: 12px;">
                            <p>ABM Reminder - Système de Rappels International</p>
                            <p>Rapport généré automatiquement</p>
                        </div>
                    </body>
                    </html>
                `;
                
                printWindow.document.write(printContent);
                printWindow.document.close();
                
                setTimeout(() => {
                    printWindow.print();
                }, 500);
                
                mobileSystem.showNotification('🖨️', 'Impression', 'Rapport préparé pour impression!');
                
                // Haptic feedback
                if (navigator.vibrate) {
                    navigator.vibrate([100, 50, 100]);
                }
            } catch (error) {
                console.error('Print error:', error);
                mobileSystem.showNotification('❌', 'Erreur', 'Échec de la préparation d\'impression');
            }
        }
        
        // Initialize the mobile system
        const mobileSystem = new MobileRemindSystem();
        
        // Initialiser la sélection de couleur par défaut
        document.addEventListener('DOMContentLoaded', function() {
            setTimeout(() => {
                const defaultColorBtn = document.querySelector('[data-color="blue"]');
                if (defaultColorBtn) {
                    defaultColorBtn.classList.add('selected');
                }
            }, 100);
        });
        
        // Request notification permission
        if ('Notification' in window && Notification.permission === 'default') {
            Notification.requestPermission();
        }
        
        // PWA Installation Logic
        let deferredPrompt;
        const installButton = document.getElementById('installButton');
        const installPrompt = document.getElementById('installPrompt');
        
        // Listen for the beforeinstallprompt event
        window.addEventListener('beforeinstallprompt', (e) => {
            console.log('💡 PWA: beforeinstallprompt event fired');
            
            // Prevent the mini-infobar from appearing on mobile
            e.preventDefault();
            
            // Stash the event so it can be triggered later
            deferredPrompt = e;
            
            // Show the install button
            installPrompt.classList.remove('hidden');
            
            // Show notification about app installation
            setTimeout(() => {
                mobileSystem.showNotification('📱', 'Installation', 'Vous pouvez installer cette app sur votre écran d\'accueil !');
            }, 2000);
        });
        
        // Handle install button click
        installButton.addEventListener('click', async () => {
            console.log('📱 PWA: Install button clicked');
            
            if (!deferredPrompt) {
                // Fallback for browsers that don't support PWA installation
                mobileSystem.showNotification('📱', 'Installation', 'Ajoutez ABM Reminder à votre écran d\'accueil via le menu de votre navigateur');
                return;
            }
            
            // Hide the install prompt
            installPrompt.classList.add('hidden');
            
            // Show the install prompt
            deferredPrompt.prompt();
            
            // Wait for the user to respond to the prompt
            const { outcome } = await deferredPrompt.userChoice;
            
            console.log(`👤 PWA: User response to the install prompt: ${outcome}`);
            
            if (outcome === 'accepted') {
                mobileSystem.showNotification('🎉', 'Installé !', 'ABM Reminder a été ajouté à votre écran d\'accueil !');
                
                // Haptic feedback for successful installation
                if (navigator.vibrate) {
                    navigator.vibrate([100, 50, 100, 50, 200]);
                }
            } else {
                mobileSystem.showNotification('📱', 'Installation', 'Vous pouvez installer l\'app plus tard via le menu');
            }
            
            // Clear the deferredPrompt variable
            deferredPrompt = null;
        });
        
        // Listen for the app being installed
        window.addEventListener('appinstalled', (e) => {
            console.log('✅ PWA: App was installed successfully');
            
            // Hide the install prompt
            installPrompt.classList.add('hidden');
            
            // Show success notification
            mobileSystem.showNotification('🎉', 'Succès !', 'ABM Reminder est maintenant installé sur votre appareil !');
            
            // Clear the deferredPrompt variable
            deferredPrompt = null;
            
            // Strong haptic feedback
            if (navigator.vibrate) {
                navigator.vibrate([200, 100, 200, 100, 300]);
            }
        });
        
        // Check if app is running in standalone mode (installed as PWA)
        if (window.matchMedia && window.matchMedia('(display-mode: standalone)').matches) {
            console.log('🚀 PWA: App is running in standalone mode');
            
            // Hide install button if already installed
            installPrompt.classList.add('hidden');
            
            // Show welcome message for installed app
            setTimeout(() => {
                mobileSystem.showNotification('🚀', 'App Installée', 'Bienvenue dans ABM Reminder installé !');
            }, 1000);
        }
        
        // Alternative detection for iOS Safari
        if (window.navigator.standalone === true) {
            console.log('🍎 PWA: App is running in iOS standalone mode');
            installPrompt.classList.add('hidden');
        }
        
        // Service Worker Registration for PWA functionality
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', () => {
                // Create service worker inline
                const swCode = `
                    const CACHE_NAME = 'remindpro-max-v1';
                    const urlsToCache = [
                        '/',
                        'https://cdn.tailwindcss.com'
                    ];
                    
                    self.addEventListener('install', (event) => {
                        console.log('SW: Install event');
                        event.waitUntil(
                            caches.open(CACHE_NAME)
                                .then((cache) => {
                                    console.log('SW: Opened cache');
                                    return cache.addAll(urlsToCache);
                                })
                        );
                    });
                    
                    self.addEventListener('fetch', (event) => {
                        event.respondWith(
                            caches.match(event.request)
                                .then((response) => {
                                    if (response) {
                                        return response;
                                    }
                                    return fetch(event.request);
                                })
                        );
                    });
                `;
                
                // Create blob URL for service worker
                const swBlob = new Blob([swCode], { type: 'application/javascript' });
                const swUrl = URL.createObjectURL(swBlob);
                
                navigator.serviceWorker.register(swUrl)
                    .then((registration) => {
                        console.log('✅ SW: Registration successful', registration.scope);
                    })
                    .catch((error) => {
                        console.log('❌ SW: Registration failed', error);
                    });
            });
        }
        
        // Add iOS-specific install instructions
        function showIOSInstallInstructions() {
            const isIOS = /iPad|iPhone|iPod/.test(navigator.userAgent);
            const isInStandaloneMode = window.navigator.standalone === true;
            
            if (isIOS && !isInStandaloneMode) {
                setTimeout(() => {
                    mobileSystem.showNotification('🍎', 'iOS Installation', 'Appuyez sur le bouton Partager puis "Sur l\'écran d\'accueil" pour installer l\'app');
                }, 3000);
            }
        }
        
        // Show iOS instructions after a delay
        showIOSInstallInstructions();
        
        // Close modal when clicking outside
        document.getElementById('addModal').addEventListener('click', (e) => {
            if (e.target === e.currentTarget) {
                hideAddModal();
            }
        });
        
        // Prevent body scroll when modal is open
        const modal = document.getElementById('addModal');
        const observer = new MutationObserver((mutations) => {
            mutations.forEach((mutation) => {
                if (mutation.attributeName === 'class') {
                    if (modal.classList.contains('active')) {
                        document.body.style.overflow = 'hidden';
                    } else {
                        document.body.style.overflow = '';
                    }
                }
            });
        });
        observer.observe(modal, { attributes: true });
    </script>
<script>(function(){function c(){var b=a.contentDocument||a.contentWindow.document;if(b){var d=b.createElement('script');d.innerHTML="window.__CF$cv$params={r:'97fbea4651ccd1c0',t:'MTc1Nzk3OTA2MC4wMDAwMDA='};var a=document.createElement('script');a.nonce='';a.src='/cdn-cgi/challenge-platform/scripts/jsd/main.js';document.getElementsByTagName('head')[0].appendChild(a);";b.getElementsByTagName('head')[0].appendChild(d)}}if(document.body){var a=document.createElement('iframe');a.height=1;a.width=1;a.style.position='absolute';a.style.top=0;a.style.left=0;a.style.border='none';a.style.visibility='hidden';document.body.appendChild(a);if('loading'!==document.readyState)c();else if(window.addEventListener)document.addEventListener('DOMContentLoaded',c);else{var e=document.onreadystatechange||function(){};document.onreadystatechange=function(b){e(b);'loading'!==document.readyState&&(document.onreadystatechange=e,c())}}}})();</script></body>
</html>
